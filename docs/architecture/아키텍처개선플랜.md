ìš”ì¦˜ ë“œëŠ” ìƒê°ì¸ë° í”„ë¡ íŠ¸ì—”ë“œ ë·°ë¥¼ êµ¬ì„±í•  ë•Œ dtoë¥¼ ë°›ì•„ì„œ í”„ë¡ íŠ¸ì—”ë“œ ë·°ëª¨ë¸ì„ ê´€ë¦¬í•˜ëŠ” ì»¤ìŠ¤í…€ í›… ì•ˆì—ì„œ ë·°ëª¨ë¸ì„ ìƒì„±í•˜ëŠ”ê±°ì§€ ë°ì´í„° ê°€ê³µì€ ê³µìš© ìˆœìˆ˜ í•¨ìˆ˜ë¡œ ë§Œë“¤ê³  ë¼ì´ë¸ŒëŸ¬ë¦¬í™”í•˜ê³ , ë·°ëŠ” ê°ì²´ë¥¼ object ë©”ì†Œë“œì™€ array ë©”ì†Œë“œë¡œ ê´€ë¦¬í•˜ëŠ”ê±°..

ê·¼ë° ì´ëŸ¬ë©´ ê¶Œí•œê´€ë¦¬ë‚˜ ê²€ì¦ì´ ê°™ì´ ë“¤ì–´ê°€ëŠ” ê²½ìš° êµ‰ì¥íˆ ë³µì¡í•´ ì§ˆ ê²ƒ ê°™ì€ ìƒê°ì´ ë“¤ì—ˆì–´

ìš°ë¦¬íŒ€ ì‹œë‹ˆì–´ëŠ” ìµœëŒ€í•œ ëìŠ¤ë¥¼ 1ëìŠ¤ë¡œ ìœ ì§€í•˜ë©´ ë¬¸ì œê°€ ê±°ì˜ ì—†ë‹¤ê³  í•˜ëŠ”ë°, ì‹¤ì œ ì½”ë“œì˜ˆì‹œë¥¼ ëª» ë´ì„œ ì¡°ê¸ˆ ê·¸ë ‡ë„¤
ì¢‹ì€ ê³ ë¯¼ì´ë„¤ìš”! í”„ë¡ íŠ¸ì—”ë“œ ë°ì´í„° ê°€ê³µê³¼ ë·°ëª¨ë¸ ê´€ë¦¬ ì „ëµì— ëŒ€í•´ ì‹¤ì „ ì˜ˆì‹œì™€ í•¨ê»˜ ë¶„ì„í•´ë“œë¦¬ê² ìŠµë‹ˆë‹¤.
ğŸ¯ í˜„ì¬ ê³ ë¯¼ ë¶„ì„
í•µì‹¬ íŠ¸ë ˆì´ë“œì˜¤í”„:
âœ… ìˆœìˆ˜ í•¨ìˆ˜ ë¼ì´ë¸ŒëŸ¬ë¦¬í™” â†’ ì¬ì‚¬ìš©ì„±, í…ŒìŠ¤íŠ¸ ìš©ì´ì„±
âŒ ê¶Œí•œ/ê²€ì¦ ë¡œì§ í˜¼ì¬ ì‹œ â†’ ë³µì¡ë„ ì¦ê°€
**ì‹œë‹ˆì–´ ì¡°ì–¸ "1ëìŠ¤ ìœ ì§€"**ì˜ ì˜ë¯¸:
// âŒ 3ëìŠ¤ - ë³µì¡í•¨
const data = transformA(transformB(transformC(rawData)))

// âœ… 1ëìŠ¤ - ëª…í™•í•¨
const step1 = transformC(rawData)
const step2 = transformB(step1)
const data = transformA(step2)
ğŸ—ï¸ ì‹¤ì „ ì•„í‚¤í…ì²˜ ì œì•ˆ

1. ë ˆì´ì–´ ë¶„ë¦¬ ì „ëµ
   // ====================================
   // Layer 1: ìˆœìˆ˜ ë°ì´í„° ë³€í™˜ (shared/utils)
   // ====================================
   export const formatters = {
   // ìˆœìˆ˜ í•¨ìˆ˜: ì…ë ¥ â†’ ì¶œë ¥ (ì‚¬ì´ë“œ ì´í™íŠ¸ ì—†ìŒ)
   toKoreanDate: (iso: string) => new Date(iso).toLocaleDateString('ko-KR'),

toDisplayName: (firstName: string, lastName: string) =>
`${lastName} ${firstName}`,

toProfileImage: (url: string | null) =>
url || '/default-avatar.png',
} as const

export const validators = {
// ìˆœìˆ˜ ê²€ì¦: boolean ë°˜í™˜
isValidEmail: (email: string) => /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email),

isAdult: (birthDate: string) => {
const age = new Date().getFullYear() - new Date(birthDate).getFullYear()
return age >= 19
},
} as const

// ====================================
// Layer 2: ë·°ëª¨ë¸ ìƒì„± (features/[domain]/models)
// ====================================
import { formatters, validators } from '@/shared/utils'

export type UserRole = 'mentor' | 'mentee' | 'admin'

export interface UserViewModel {
// í‘œì‹œ ë°ì´í„°
displayName: string
profileImage: string
joinedAt: string

// ê¶Œí•œ í”Œë˜ê·¸ (ë¯¸ë¦¬ ê³„ì‚°)
canEditProfile: boolean
canAccessMentoring: boolean

// ì›ë³¸ ë°ì´í„° (í•„ìš”ì‹œ)
\_raw: UserDto
}

export const createUserViewModel = (
dto: UserDto,
currentUserRole: UserRole
): UserViewModel => {
// 1ëìŠ¤: ë‹¨ìˆœ ë³€í™˜
const displayName = formatters.toDisplayName(dto.firstName, dto.lastName)
const profileImage = formatters.toProfileImage(dto.profileImageUrl)
const joinedAt = formatters.toKoreanDate(dto.createdAt)

// 1ëìŠ¤: ê¶Œí•œ ê³„ì‚°
const canEditProfile = dto.id === currentUserRole || currentUserRole === 'admin'
const canAccessMentoring = validators.isAdult(dto.birthDate)

return {
displayName,
profileImage,
joinedAt,
canEditProfile,
canAccessMentoring,
\_raw: dto,
}
}

// ====================================
// Layer 3: ì»¤ìŠ¤í…€ í›… (features/[domain]/hooks)
// ====================================
export function useUserProfile(userId: string) {
const { data: currentUser } = useAuth()
const { data: userDto, isLoading } = useQuery({
queryKey: ['user', userId],
queryFn: () => apiClient.users.getById(userId),
})

// ë·°ëª¨ë¸ ìƒì„±: 1ëìŠ¤
const viewModel = useMemo(() => {
if (!userDto || !currentUser) return null
return createUserViewModel(userDto, currentUser.role)
}, [userDto, currentUser])

return {
user: viewModel,
isLoading,
}
}

// ====================================
// Layer 4: ì»´í¬ë„ŒíŠ¸ (containers/[domain])
// ====================================
export function UserProfileContainer({ userId }: Props) {
const { user, isLoading } = useUserProfile(userId)

if (isLoading) return <Skeleton />
if (!user) return <ErrorState />

return (
<div>
<Avatar src={user.profileImage} />
<h1>{user.displayName}</h1>
<p>ê°€ì…ì¼: {user.joinedAt}</p>

      {user.canEditProfile && (
        <Button>í”„ë¡œí•„ ìˆ˜ì •</Button>
      )}

      {user.canAccessMentoring && (
        <MentoringSection />
      )}
    </div>

)
}
ğŸ“Š ë³µì¡í•œ ê¶Œí•œ ê´€ë¦¬ ì˜ˆì‹œ
Case 1: ë©˜í† ë§ ì„¸ì…˜ ê¶Œí•œ (ë‹¤ì¤‘ ì¡°ê±´)
// ====================================
// ê¶Œí•œ ê·œì¹™ ì •ì˜ (features/session/policies)
// ====================================
export const sessionPolicies = {
canStartSession: (session: SessionDto, user: UserDto) => {
// 1ëìŠ¤: ê° ì¡°ê±´ ë…ë¦½ì ìœ¼ë¡œ ê³„ì‚°
const isMentor = session.mentorId === user.id
const isScheduledTime = new Date() >= new Date(session.scheduledAt)
const isNotStarted = session.status === 'scheduled'

    return isMentor && isScheduledTime && isNotStarted

},

canJoinSession: (session: SessionDto, user: UserDto) => {
const isMentee = session.menteeId === user.id
const isOngoing = session.status === 'ongoing'

    return isMentee && isOngoing

},

canViewRecording: (session: SessionDto, user: UserDto) => {
const isParticipant = [session.mentorId, session.menteeId].includes(user.id)
const isFinished = session.status === 'finished'
const hasRecording = !!session.recordingUrl

    return isParticipant && isFinished && hasRecording

},
} as const

// ====================================
// ë·°ëª¨ë¸ ìƒì„± (features/session/models)
// ====================================
export interface SessionViewModel {
title: string
scheduledAt: string
duration: number

// ê¶Œí•œ í”Œë˜ê·¸ (ë¯¸ë¦¬ ê³„ì‚°)
canStartSession: boolean
canJoinSession: boolean
canViewRecording: boolean

// UI ìƒíƒœ (ê¶Œí•œ ê¸°ë°˜)
actionButtons: Array<{
label: string
action: string
disabled: boolean
}>
}

export const createSessionViewModel = (
dto: SessionDto,
currentUser: UserDto
): SessionViewModel => {
// 1ëìŠ¤: ê¶Œí•œ ê³„ì‚°
const canStartSession = sessionPolicies.canStartSession(dto, currentUser)
const canJoinSession = sessionPolicies.canJoinSession(dto, currentUser)
const canViewRecording = sessionPolicies.canViewRecording(dto, currentUser)

// 1ëìŠ¤: UI ìƒíƒœ êµ¬ì„±
const actionButtons: SessionViewModel['actionButtons'] = [
{
label: 'ì„¸ì…˜ ì‹œì‘',
action: 'start',
disabled: !canStartSession,
},
{
label: 'ì„¸ì…˜ ì°¸ì—¬',
action: 'join',
disabled: !canJoinSession,
},
{
label: 'ë…¹í™” ë³´ê¸°',
action: 'view-recording',
disabled: !canViewRecording,
},
].filter(btn => !btn.disabled || dto.status === 'scheduled')

return {
title: dto.title,
scheduledAt: formatters.toKoreanDateTime(dto.scheduledAt),
duration: dto.duration,
canStartSession,
canJoinSession,
canViewRecording,
actionButtons,
}
}

// ====================================
// ì»¤ìŠ¤í…€ í›… (features/session/hooks)
// ====================================
export function useSession(sessionId: string) {
const { data: currentUser } = useAuth()
const { data: sessionDto } = useQuery({
queryKey: ['session', sessionId],
queryFn: () => apiClient.sessions.getById(sessionId),
})

const viewModel = useMemo(() => {
if (!sessionDto || !currentUser) return null
return createSessionViewModel(sessionDto, currentUser)
}, [sessionDto, currentUser])

// ì•¡ì…˜ í•¸ë“¤ëŸ¬ (ê¶Œí•œ ì¬ê²€ì¦)
const handleAction = useCallback((action: string) => {
if (!viewModel) return

    switch (action) {
      case 'start':
        if (viewModel.canStartSession) {
          // API í˜¸ì¶œ
        }
        break
      case 'join':
        if (viewModel.canJoinSession) {
          // WebRTC ì—°ê²°
        }
        break
      // ...
    }

}, [viewModel])

return {
session: viewModel,
handleAction,
}
}
ğŸ¨ CotePT ì˜¨ë³´ë”© í˜ì´ì§€ ë¦¬íŒ©í† ë§ ì˜ˆì‹œ
í˜„ì¬ OnBoardingContainer.tsxë¥¼ ìœ„ íŒ¨í„´ìœ¼ë¡œ ê°œì„ í•´ë³´ê² ìŠµë‹ˆë‹¤.
// ====================================
// features/onboarding/models/onboarding.viewmodel.ts
// ====================================
export interface OnboardingStep {
id: string
title: string
isCompleted: boolean
isActive: boolean
canProceed: boolean
}

export interface OnboardingViewModel {
currentStepIndex: number
steps: OnboardingStep[]
totalSteps: number
progressPercentage: number

canGoNext: boolean
canGoBack: boolean
isLastStep: boolean
}

export const createOnboardingViewModel = (
currentStep: number,
formData: Partial<OnboardingFormData>
): OnboardingViewModel => {
// 1ëìŠ¤: ê° ìŠ¤í… ìƒíƒœ ê³„ì‚°
const steps: OnboardingStep[] = [
{
id: 'role',
title: 'ì—­í•  ì„ íƒ',
isCompleted: !!formData.role,
isActive: currentStep === 0,
canProceed: !!formData.role,
},
{
id: 'profile',
title: 'í”„ë¡œí•„ ì„¤ì •',
isCompleted: !!formData.nickname && !!formData.bio,
isActive: currentStep === 1,
canProceed: !!formData.nickname && !!formData.bio,
},
{
id: 'baekjoon',
title: 'ë°±ì¤€ ì—°ë™',
isCompleted: !!formData.baekjoonHandle,
isActive: currentStep === 2,
canProceed: !!formData.baekjoonHandle,
},
]

// 1ëìŠ¤: ë„¤ë¹„ê²Œì´ì…˜ ìƒíƒœ
const currentStepData = steps[currentStep]
const canGoNext = currentStepData?.canProceed ?? false
const canGoBack = currentStep > 0
const isLastStep = currentStep === steps.length - 1

return {
currentStepIndex: currentStep,
steps,
totalSteps: steps.length,
progressPercentage: ((currentStep + 1) / steps.length) \* 100,
canGoNext,
canGoBack,
isLastStep,
}
}

// ====================================
// features/onboarding/hooks/useOnboarding.ts
// ====================================
export function useOnboarding() {
const [currentStep, setCurrentStep] = useState(0)
const [formData, setFormData] = useState<Partial<OnboardingFormData>>({})

const viewModel = useMemo(() =>
createOnboardingViewModel(currentStep, formData),
[currentStep, formData]
)

const goNext = useCallback(() => {
if (viewModel.canGoNext && !viewModel.isLastStep) {
setCurrentStep(prev => prev + 1)
}
}, [viewModel])

const goBack = useCallback(() => {
if (viewModel.canGoBack) {
setCurrentStep(prev => prev - 1)
}
}, [viewModel])

const updateFormData = useCallback((data: Partial<OnboardingFormData>) => {
setFormData(prev => ({ ...prev, ...data }))
}, [])

return {
viewModel,
formData,
goNext,
goBack,
updateFormData,
}
}

// ====================================
// containers/onboarding/OnBoardingContainer.tsx
// ====================================
export function OnBoardingContainer() {
const { viewModel, formData, goNext, goBack, updateFormData } = useOnboarding()

return (
<div>
{/_ ì§„í–‰ í‘œì‹œ _/}
<ProgressBar value={viewModel.progressPercentage} />

      {/* ìŠ¤í… ì¸ë””ì¼€ì´í„° */}
      <StepIndicator steps={viewModel.steps} />

      {/* í˜„ì¬ ìŠ¤í… ì½˜í…ì¸  */}
      {viewModel.currentStepIndex === 0 && (
        <RoleSelectionStep
          value={formData.role}
          onChange={(role) => updateFormData({ role })}
        />
      )}

      {viewModel.currentStepIndex === 1 && (
        <ProfileSetupStep
          value={{ nickname: formData.nickname, bio: formData.bio }}
          onChange={(data) => updateFormData(data)}
        />
      )}

      {/* ë„¤ë¹„ê²Œì´ì…˜ */}
      <div>
        <Button
          onClick={goBack}
          disabled={!viewModel.canGoBack}
        >
          ì´ì „
        </Button>

        <Button
          onClick={goNext}
          disabled={!viewModel.canGoNext}
        >
          {viewModel.isLastStep ? 'ì™„ë£Œ' : 'ë‹¤ìŒ'}
        </Button>
      </div>
    </div>

)
}
ğŸ’¡ í•µì‹¬ ì¸ì‚¬ì´íŠ¸
"â˜… Insight â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"

1. 1ëìŠ¤ ì›ì¹™ì˜ ì‹¤ì²´
   ë°ì´í„° ë³€í™˜ ì²´ì¸ì„ ì¤‘ê°„ ë³€ìˆ˜ë¡œ ëª…ì‹œ
   ê¶Œí•œ ì¡°ê±´ì„ boolean ë³€ìˆ˜ë¡œ ì‚¬ì „ ê³„ì‚°
   "ê³„ì‚° â†’ ì¡°í•© â†’ ë°˜í™˜" 3ë‹¨ê³„ ëª…í™•íˆ ë¶„ë¦¬
2. ë ˆì´ì–´ë³„ ì±…ì„ ë¶„ë¦¬
   Utils: ìˆœìˆ˜ í•¨ìˆ˜ (ì…ë ¥â†’ì¶œë ¥, ì‚¬ì´ë“œ ì´í™íŠ¸ ì—†ìŒ)
   Models: ë·°ëª¨ë¸ ìƒì„± (ê¶Œí•œ ê³„ì‚° í¬í•¨)
   Hooks: ìƒíƒœ ê´€ë¦¬ + API ì—°ë™
   Components: ë·°ëª¨ë¸ ì†Œë¹„ (ì¡°ê±´ë¬¸ ìµœì†Œí™”)
3. ë³µì¡ë„ ì œì–´ ì „ëµ
   ê¶Œí•œ ê·œì¹™ì„ policies ê°ì²´ë¡œ ê²©ë¦¬
   ë·°ëª¨ë¸ì—ì„œ ê¶Œí•œ í”Œë˜ê·¸ ë¯¸ë¦¬ ê³„ì‚°
   ì»´í¬ë„ŒíŠ¸ì—ì„œëŠ” if (viewModel.canX) ë§Œ ì‚¬ìš©
   "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
   ğŸš€ ì‹¤ì „ ì ìš© ê°€ì´ë“œ
   ì²´í¬ë¦¬ìŠ¤íŠ¸
   // âœ… Good: 1ëìŠ¤ ìœ ì§€
   const isValid = validators.isEmail(email)
   const formatted = formatters.toKoreanDate(date)
   const canEdit = user.id === currentUser.id

// âŒ Bad: ì¤‘ì²© ì²´ì¸
const result = transform(validate(format(data)))

// âœ… Good: ê¶Œí•œ ì‚¬ì „ ê³„ì‚°
const viewModel = {
canEdit: policies.canEdit(data, user),
canDelete: policies.canDelete(data, user),
}

// âŒ Bad: ì»´í¬ë„ŒíŠ¸ì—ì„œ ë³µì¡í•œ ì¡°ê±´
{user.role === 'admin' || (user.id === data.authorId && data.status === 'draft') ? (
<Button />
) : null}

// âœ… Good: í”Œë˜ê·¸ í™œìš©
{viewModel.canEdit && <Button />}
ì´ íŒ¨í„´ì„ í˜„ì¬ CotePT í”„ë¡œì íŠ¸ì— ì ìš©í•˜ì‹œê² ìŠµë‹ˆê¹Œ? íŠ¹ì • ì»´í¬ë„ŒíŠ¸(ì˜ˆ: OnBoardingContainer, ProfileSetupStep)ë¥¼ ë¦¬íŒ©í† ë§ í•´ë“œë¦´ê¹Œìš”?
ìŒ ë·°ëª¨ë¸ ìƒì„±ê¹Œì§€ì˜ ì˜ˆì‹œ ì¤‘ì— validationì„ zodë¡œ êµ¬í˜„í•œ ì˜ˆì‹œ (common-rules or common-validation) ê°™ì´ ì‚¬ìš©í•˜ëŠ”ê²Œ ì¢‹ì§€ ì•Šì„ê¹Œ?
ê·¸ë¦¬ê³  ê¶Œí•œì€ react-casl ì‚¬ìš©í•´ì„œ next-authì˜ useSessionì— ì¡´ì¬í•˜ëŠ” roleê³¼ ì‚¬ìš©ì ì¸ë±ìŠ¤ì— ë”°ë¼ì„œ ì¸ê°€ ì‹œìŠ¤í…œì„ êµ¬ì„±í•˜ëŠ”ê²Œ ì¢‹ì•„ë³´ì—¬ ì´ê²ƒë„ ë™ì¼í•˜ê²Œ êµ¬ì¡°í™”ëœ í˜•ì‹ì´ë©´ ì¢‹ê² ê³ .

ê·¸ë¦¬ê³  ì œì¼ í° ë¬¸ì œ ìœ ì—°í•œ ì»´í¬ë„ŒíŠ¸ë¥¼ ìœ„í•´ compound component íŒ¨í„´ì´ ì¢‹ì•„ë³´ì—¬ ì™œëƒë©´ ê·¸ë‚˜ë§ˆ UI ìˆ˜ì •í•˜ê¸° í¸í•´ë³´ì´ê±°ë“ ..

CVA + clsx + twmerge ì¡°í•©ì´ë˜ scss module ì¡°í•©ì´ë˜ ë‘˜ ë‹¤ ë‚˜ì˜ì§€ ì•Šì•„.
ìŒ ë·°ëª¨ë¸ ìƒì„±ê¹Œì§€ì˜ ì˜ˆì‹œ ì¤‘ì— validationì„ zodë¡œ êµ¬í˜„í•œ ì˜ˆì‹œ (common-rules or common-validation) ê°™ì´ ì‚¬ìš©í•˜ëŠ”ê²Œ ì¢‹ì§€ ì•Šì„ê¹Œ?
ê·¸ë¦¬ê³  ê¶Œí•œì€ react-casl ì‚¬ìš©í•´ì„œ next-authì˜ useSessionì— ì¡´ì¬í•˜ëŠ” roleê³¼ ì‚¬ìš©ì ì¸ë±ìŠ¤ì— ë”°ë¼ì„œ ì¸ê°€ ì‹œìŠ¤í…œì„ êµ¬ì„±í•˜ëŠ”ê²Œ ì¢‹ì•„ë³´ì—¬ ì´ê²ƒë„ ë™ì¼í•˜ê²Œ êµ¬ì¡°í™”ëœ í˜•ì‹ì´ë©´ ì¢‹ê² ê³ .

ê·¸ë¦¬ê³  ì œì¼ í° ë¬¸ì œ ìœ ì—°í•œ ì»´í¬ë„ŒíŠ¸ë¥¼ ìœ„í•´ compound component íŒ¨í„´ì´ ì¢‹ì•„ë³´ì—¬ ì™œëƒë©´ ê·¸ë‚˜ë§ˆ UI ìˆ˜ì •í•˜ê¸° í¸í•´ë³´ì´ê±°ë“ ..

CVA + clsx + twmerge ì¡°í•©ì´ë˜ scss module ì¡°í•©ì´ë˜ ë‘˜ ë‹¤ ë‚˜ì˜ì§€ ì•Šì•„.

ë„¤ ìƒê°ì€ ì–´ë– ë‹ˆ êµ¬í˜„ì€ í•˜ì§€ë§ê³  í”¼ë“œë°±ì„ ì¤˜
ìŒ ë·°ëª¨ë¸ ìƒì„±ê¹Œì§€ì˜ ì˜ˆì‹œ ì¤‘ì— validationì„ zodë¡œ êµ¬í˜„í•œ ì˜ˆì‹œ (common-rules or common-validation) ê°™ì´ ì‚¬ìš©í•˜ëŠ”ê²Œ ì¢‹ì§€ ì•Šì„ê¹Œ?
ê·¸ë¦¬ê³  ê¶Œí•œì€ react-casl ì‚¬ìš©í•´ì„œ next-authì˜ useSessionì— ì¡´ì¬í•˜ëŠ” roleê³¼ ì‚¬ìš©ì ì¸ë±ìŠ¤ì— ë”°ë¼ì„œ ì¸ê°€ ì‹œìŠ¤í…œì„ êµ¬ì„±í•˜ëŠ”ê²Œ ì¢‹ì•„ë³´ì—¬ ì´ê²ƒë„ ë™ì¼í•˜ê²Œ êµ¬ì¡°í™”ëœ í˜•ì‹ì´ë©´ ì¢‹ê² ê³ .

ê·¸ë¦¬ê³  ì œì¼ í° ë¬¸ì œ ìœ ì—°í•œ ì»´í¬ë„ŒíŠ¸ë¥¼ ìœ„í•´ compound component íŒ¨í„´ì´ ì¢‹ì•„ë³´ì—¬ ì™œëƒë©´ ê·¸ë‚˜ë§ˆ UI ìˆ˜ì •í•˜ê¸° í¸í•´ë³´ì´ê±°ë“ ..

CVA + clsx + twmerge ì¡°í•©ì´ë˜ scss module ì¡°í•©ì´ë˜ ë‘˜ ë‹¤ ë‚˜ì˜ì§€ ì•Šì•„.

ê·¸ë¦¬ê³  íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ëŠ” ì•„ë¬´ë˜ë„ ìœ í‹¸í•¨ìˆ˜ë¥¼ í™œìš©í•´ì„œ object ë©”ì†Œë“œ ì´í›„ ì†Œì‹¤ë˜ëŠ” íƒ€ì…ì„ ë³´ì¡´í•˜ëŠ” ë°©ì‹ì´ ë°˜ë“œì‹œ í•„ìš”í•˜ë‹¨ë§ì´ì•¼

ë„¤ ìƒê°ì€ ì–´ë– ë‹ˆ êµ¬í˜„ì€ í•˜ì§€ë§ê³  í”¼ë“œë°±ì„ ì¤˜
ğŸ¯ ì œì•ˆ ì‚¬í•­ ì¢…í•© í”¼ë“œë°±
ì „ì²´ì ìœ¼ë¡œ ë§¤ìš° ê²¬ê³ í•˜ê³  ì‹¤ìš©ì ì¸ ë°©í–¥ì…ë‹ˆë‹¤. ê° ì œì•ˆì„ ë¶„ì„í•˜ê³  CotePT í”„ë¡œì íŠ¸ íŠ¹ì„±ì— ë§ëŠ” í†µí•© ì „ëµì„ ì œì‹œí•˜ê² ìŠµë‹ˆë‹¤.
1ï¸âƒ£ Zod ê¸°ë°˜ Validation ì²´ê³„
"â˜… Insight â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
ì¥ì :
Runtime + Compile-time íƒ€ì… ì•ˆì „ì„± ì´ì¤‘ ë³´ì¥
ì—ëŸ¬ ë©”ì‹œì§€ í•œê¸€í™” ê°€ëŠ¥
zodResolverë¡œ React Hook Form ì™„ë²½ í†µí•©
í”„ë¡ íŠ¸â†”ë°±ì—”ë“œ ìŠ¤í‚¤ë§ˆ ê³µìœ  ê°€ëŠ¥ (monorepo ê°•ì )
ì•„í‚¤í…ì²˜ ì œì•ˆ:
// âœ… 3-Layer Validation Structure

// Layer 1: Atomic Rules (packages/shared/validators)
export const commonRules = {
email: z.string().email("ì˜¬ë°”ë¥¸ ì´ë©”ì¼ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤"),

password: z.string()
.min(8, "ë¹„ë°€ë²ˆí˜¸ëŠ” 8ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤")
.regex(/^(?=._[a-z])(?=._[A-Z])(?=.\*\d)/, "ì˜ë¬¸ ëŒ€ì†Œë¬¸ì, ìˆ«ì í¬í•¨ í•„ìˆ˜"),

nickname: z.string()
.min(2, "ë‹‰ë„¤ì„ì€ 2ì ì´ìƒ")
.max(20, "ë‹‰ë„¤ì„ì€ 20ì ì´í•˜")
.regex(/^[ê°€-í£a-zA-Z0-9_]+$/, "í•œê¸€, ì˜ë¬¸, ìˆ«ì, \_ ë§Œ ê°€ëŠ¥"),

baekjoonHandle: z.string()
.min(3, "ë°±ì¤€ í•¸ë“¤ì€ 3ì ì´ìƒ")
.max(20, "ë°±ì¤€ í•¸ë“¤ì€ 20ì ì´í•˜")
.regex(/^[a-z0-9_]+$/, "ì˜ë¬¸ ì†Œë¬¸ì, ìˆ«ì, \_ ë§Œ ê°€ëŠ¥"),
} as const

// Layer 2: Domain Schemas (features/[domain]/schemas)
export const userProfileSchema = z.object({
nickname: commonRules.nickname,
bio: z.string().max(500, "ì†Œê°œëŠ” 500ì ì´í•˜").optional(),
profileImageUrl: z.string().url().optional(),
})

export const mentorOnboardingSchema = z.object({
role: z.literal('mentor'),
profile: userProfileSchema,
baekjoonHandle: commonRules.baekjoonHandle,
specialties: z.array(z.string()).min(1, "ì „ë¬¸ ë¶„ì•¼ë¥¼ 1ê°œ ì´ìƒ ì„ íƒí•˜ì„¸ìš”"),
})

// Layer 3: Runtime Validation (hooks/utils)
export function validateWithZod<T>(
schema: z.ZodSchema<T>,
data: unknown
): { success: true; data: T } | { success: false; errors: string[] } {
const result = schema.safeParse(data)

if (result.success) {
return { success: true, data: result.data }
}

return {
success: false,
errors: result.error.errors.map(e => e.message),
}
}
CotePT ì ìš© ì‹œ ê³ ë ¤ì‚¬í•­:
âœ… ë°±ì¤€ í•¸ë“¤ ì‹¤ì‹œê°„ ê²€ì¦: API ì—°ë™ í•„ìš” (ì¤‘ë³µ ì²´í¬)
âœ… í”„ë¡œí•„ ì´ë¯¸ì§€ ì—…ë¡œë“œ: íŒŒì¼ í¬ê¸°/íƒ€ì… ê²€ì¦ ì¶”ê°€
âš ï¸ ë³µì¡í•œ ì¡°ê±´ë¶€ ê²€ì¦: z.discriminatedUnion í™œìš© (ë©˜í† /ë©˜í‹° ë¶„ê¸°)
"â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
2ï¸âƒ£ CASL ê¸°ë°˜ ê¶Œí•œ ì‹œìŠ¤í…œ
"â˜… Insight â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
ì¥ì :
Declarativeí•œ ê¶Œí•œ ì •ì˜ (ì½”ë“œ ê°€ë…ì„± â†‘)
NextAuth session.user.role ì™„ë²½ í†µí•©
ì¡°ê±´ë¶€ ê¶Œí•œ (own resources) ì§€ì›
React ì»´í¬ë„ŒíŠ¸ ë ˆë²¨ ê¶Œí•œ ì œì–´ (<Can>)
ì•„í‚¤í…ì²˜ ì œì•ˆ:
// âœ… CASL Ability Definition

// shared/abilities/defineAbilities.ts
import { AbilityBuilder, PureAbility } from '@casl/ability'

export type Actions = 'manage' | 'create' | 'read' | 'update' | 'delete'
export type Subjects =
| 'Session'
| 'User'
| 'MentorProfile'
| 'Recording'
| 'all'

export type AppAbility = PureAbility<[Actions, Subjects]>

export function defineAbilitiesFor(user: {
id: string
role: 'admin' | 'mentor' | 'mentee'
}) {
const { can, cannot, build } = new AbilityBuilder<AppAbility>(PureAbility)

if (user.role === 'admin') {
can('manage', 'all') // ëª¨ë“  ê¶Œí•œ
}

if (user.role === 'mentor') {
can('create', 'Session')
can('read', 'Session', { mentorId: user.id })
can('update', 'Session', { mentorId: user.id })
can('read', 'Recording', { mentorId: user.id })
can('update', 'MentorProfile', { userId: user.id })
}

if (user.role === 'mentee') {
can('read', 'Session', { menteeId: user.id })
can('read', 'Recording', { menteeId: user.id })
cannot('create', 'Session') // ëª…ì‹œì  ì œí•œ
}

return build()
}

// features/session/hooks/useSessionAbility.ts
export function useSessionAbility() {
const { data: session } = useSession()

return useMemo(() => {
if (!session?.user) return null
return defineAbilitiesFor(session.user)
}, [session])
}

// features/session/models/session.viewmodel.ts
export const createSessionViewModel = (
dto: SessionDto,
ability: AppAbility | null
): SessionViewModel => {
return {
// ... ê¸°ì¡´ í•„ë“œ
canStartSession: ability?.can('update', 'Session', { mentorId: dto.mentorId }) ?? false,
canJoinSession: ability?.can('read', 'Session', { menteeId: dto.menteeId }) ?? false,
canViewRecording: ability?.can('read', 'Recording', { sessionId: dto.id }) ?? false,
}
}
CotePT ì ìš© ì‹œ ì£¼ì˜ì‚¬í•­:
âš ï¸ Own Resource íŒë³„: { mentorId: user.id } ì¡°ê±´ì€ ì„œë²„ ê²€ì¦ í•„ìˆ˜
âœ… SSR í˜¸í™˜ì„±: useSession()ì€ í´ë¼ì´ì–¸íŠ¸ë§Œ ê°€ëŠ¥ â†’ ì„œë²„ ì»´í¬ë„ŒíŠ¸ëŠ” getServerSession() í™œìš©
ğŸ”’ ë³´ì•ˆ: í”„ë¡ íŠ¸ ê¶Œí•œì€ UX ìµœì í™”ìš©, ë°±ì—”ë“œ ê²€ì¦ ë°˜ë“œì‹œ ë³‘í–‰
"â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
3ï¸âƒ£ Compound Component íŒ¨í„´
"â˜… Insight â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
ì ˆëŒ€ì  ì°¬ì„±! CotePTì˜ ì˜¨ë³´ë”©, ì„¸ì…˜ UIì— ì™„ë²½íˆ ë¶€í•©í•©ë‹ˆë‹¤. ì¥ì :
UI ìˆ˜ì • ì‹œ ì»´í¬ë„ŒíŠ¸ íŒŒì¼ ìˆ˜ì • ë¶ˆí•„ìš”
ë””ìì´ë„ˆ ì¹œí™”ì  (ì»´í¬ë„ŒíŠ¸ ì¡°í•©ë§Œ ë³€ê²½)
Headless UI ì² í•™ (ë¡œì§ â†” ë·° ì™„ì „ ë¶„ë¦¬)
ì•„í‚¤ï¿½ecting ì œì•ˆ:
// âœ… Compound Component + Context Pattern

// shared/ui/FormStep/FormStep.tsx
const FormStepContext = createContext<{
currentStep: number
totalSteps: number
goNext: () => void
goBack: () => void
canGoNext: boolean
canGoBack: boolean
} | null>(null)

export function FormStep({ children, ...props }: FormStepProps) {
const value = useFormStepLogic(props)

return (
<FormStepContext.Provider value={value}>
<div className="form-step">
{children}
</div>
</FormStepContext.Provider>
)
}

FormStep.Header = function Header({ children }: { children: ReactNode }) {
return <div className="form-step-header">{children}</div>
}

FormStep.Progress = function Progress() {
const ctx = useContext(FormStepContext)
return (
<ProgressBar
value={(ctx!.currentStep / ctx!.totalSteps) \* 100}
/>
)
}

FormStep.Content = function Content({ step, children }: ContentProps) {
const ctx = useContext(FormStepContext)
if (ctx!.currentStep !== step) return null
return <div className="form-step-content">{children}</div>
}

FormStep.Actions = function Actions({ children }: ActionsProps) {
return <div className="form-step-actions">{children}</div>
}

FormStep.BackButton = function BackButton(props: ButtonProps) {
const ctx = useContext(FormStepContext)
return (
<Button
{...props}
onClick={ctx!.goBack}
disabled={!ctx!.canGoBack}
/>
)
}

FormStep.NextButton = function NextButton(props: ButtonProps) {
const ctx = useContext(FormStepContext)
return (
<Button
{...props}
onClick={ctx!.goNext}
disabled={!ctx!.canGoNext}
/>
)
}

// ì‚¬ìš© ì˜ˆì‹œ (ë””ìì´ë„ˆë„ ìˆ˜ì • ê°€ëŠ¥!)
<FormStep currentStep={0} totalSteps={3}>
<FormStep.Header>
<h1>ì˜¨ë³´ë”©</h1>
<FormStep.Progress />
</FormStep.Header>

<FormStep.Content step={0}>
<RoleSelectionStep />
</FormStep.Content>

<FormStep.Content step={1}>
<ProfileSetupStep />
</FormStep.Content>

<FormStep.Actions>
<FormStep.BackButton>ì´ì „</FormStep.BackButton>
<FormStep.NextButton>ë‹¤ìŒ</FormStep.NextButton>
</FormStep.Actions>
</FormStep>
CotePT ì ìš© ìš°ì„ ìˆœìœ„:
âœ… FormStep: ì˜¨ë³´ë”©, í”„ë¡œí•„ ì„¤ì •
âœ… SessionCard: ì„¸ì…˜ ëª©ë¡ (Card.Header, Card.Actions, Card.Meta)
âš ï¸ MentoringSession: WebRTC ì»¨íŠ¸ë¡¤ (ë³µì¡ë„ ë†’ìŒ, ì ì§„ ì ìš©)
"â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
4ï¸âƒ£ ìŠ¤íƒ€ì¼ë§ ì „ëµ (CVA vs SCSS Modules)
"â˜… Insight â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
í˜„ì‹¤ì  í‰ê°€:
í•­ëª© CVA + clsx + twMerge SCSS Modules
íƒ€ì… ì•ˆì „ì„± âœ… Variant íƒ€ì… ìë™ ìƒì„± âŒ ìˆ˜ë™ íƒ€ì… ì •ì˜
ì¡°ê±´ë¶€ ìŠ¤íƒ€ì¼ âœ… cva({ variants }) âš ï¸ classnames() í•„ìš”
ëŸ°íƒ€ì„ ì„±ëŠ¥ âš ï¸ í´ë˜ìŠ¤ ë³‘í•© ì˜¤ë²„í—¤ë“œ âœ… ì •ì  CSS
ë””ìì¸ í† í° âœ… Tailwind config í†µí•© âš ï¸ SCSS ë³€ìˆ˜ ë³„ë„ ê´€ë¦¬
í•™ìŠµ ê³¡ì„  âš ï¸ Tailwind ìµìˆ™í•´ì•¼ í•¨ âœ… CSS í‘œì¤€
CotePT í”„ë¡œì íŠ¸ íŠ¹ì„±ìƒ ì¶”ì²œ: CVA + Tailwind ì´ìœ :
ë””ìì¸ ì‹œìŠ¤í…œ í™•ì¥ì„±: Tailwind configë¡œ ì¼ê´€ëœ ìƒ‰ìƒ/ê°„ê²© ê´€ë¦¬
Compound Component ì¹œí™”ì„±: Variant ê¸°ë°˜ ìŠ¤íƒ€ì¼ ì¡°í•©
ë²ˆë“¤ í¬ê¸°: PurgeCSSë¡œ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” í´ë˜ìŠ¤ ìë™ ì œê±°
íƒ€ì… ì•ˆì „ì„±: CVAê°€ ìë™ íƒ€ì… ìƒì„± (VariantProps<typeof buttonVariants>)
// âœ… CVA ì˜ˆì‹œ
import { cva, type VariantProps } from 'class-variance-authority'
import { cn } from '@/shared/utils'

const buttonVariants = cva(
"inline-flex items-center justify-center rounded-md font-medium transition-colors",
{
variants: {
variant: {
default: "bg-blue-600 text-white hover:bg-blue-700",
outline: "border border-gray-300 hover:bg-gray-50",
ghost: "hover:bg-gray-100",
},
size: {
sm: "h-8 px-3 text-sm",
md: "h-10 px-4",
lg: "h-12 px-6 text-lg",
},
},
defaultVariants: {
variant: "default",
size: "md",
},
}
)

export interface ButtonProps
extends React.ButtonHTMLAttributes<HTMLButtonElement>,
VariantProps<typeof buttonVariants> {}

export function Button({ variant, size, className, ...props }: ButtonProps) {
return (
<button
className={cn(buttonVariants({ variant, size }), className)}
{...props}
/>
)
}
"â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
5ï¸âƒ£ TypeScript íƒ€ì… ë³´ì¡´ ì „ëµ
"â˜… Insight â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
í•µì‹¬ ë¬¸ì œ: Object.keys(), Array.map() í›„ íƒ€ì… ì†ì‹¤ í•´ê²° ì „ëµ:
// âœ… Type-Safe Object Utils (shared/utils/typescript.ts)

// 1. Type-Safe Object.keys
export function typedKeys<T extends object>(obj: T): (keyof T)[] {
return Object.keys(obj) as (keyof T)[]
}

// 2. Type-Safe Object.entries
export function typedEntries<T extends object>(
obj: T
): [keyof T, T[keyof T]][] {
return Object.entries(obj) as [keyof T, T[keyof T]][]
}

// 3. Type-Safe Array.map with predicate
export function mapWithType<T, U>(
arr: T[],
fn: (item: T, index: number) => U
): U[] {
return arr.map(fn)
}

// 4. Type-Safe Filter
export function filterNotNull<T>(arr: (T | null | undefined)[]): T[] {
return arr.filter((item): item is T => item !== null && item !== undefined)
}

// ì‚¬ìš© ì˜ˆì‹œ
interface User {
id: string
name: string
role: 'mentor' | 'mentee'
}

const user: User = { id: '1', name: 'John', role: 'mentor' }

// âŒ Before: íƒ€ì… ì†ì‹¤
Object.keys(user).forEach(key => {
console.log(user[key]) // âŒ Error: Element implicitly has an 'any' type
})

// âœ… After: íƒ€ì… ë³´ì¡´
typedKeys(user).forEach(key => {
console.log(user[key]) // âœ… Type: string | 'mentor' | 'mentee'
})

// ViewModel ìƒì„± ì‹œ í™œìš©
export const createUserViewModel = (dto: UserDto): UserViewModel => {
const fields = typedEntries({
displayName: formatters.toDisplayName(dto.firstName, dto.lastName),
role: dto.role,
})

return Object.fromEntries(fields) as UserViewModel
}
CotePT ì ìš© í¬ì¸íŠ¸:
âœ… ì„¸ì…˜ í•„í„°ë§: sessions.filter() â†’ filterNotNull(sessions)
âœ… ê¶Œí•œ ë§µí•‘: typedEntries(permissions).map()
âœ… í¼ ë°ì´í„° ë³€í™˜: typedKeys(formData).reduce()
"â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
ğŸ¯ í†µí•© ì•„í‚¤í…ì²˜ ì œì•ˆ
apps/web/src/
â”œâ”€â”€ shared/
â”‚ â”œâ”€â”€ validators/ # Zod common rules
â”‚ â”œâ”€â”€ abilities/ # CASL ability definitions
â”‚ â”œâ”€â”€ utils/
â”‚ â”‚ â”œâ”€â”€ typescript.ts # Type-safe utils
â”‚ â”‚ â””â”€â”€ cn.ts # clsx + twMerge
â”‚ â””â”€â”€ ui/ # Compound components (CVA)
â”‚
â”œâ”€â”€ features/[domain]/
â”‚ â”œâ”€â”€ schemas/ # Domain-specific Zod schemas
â”‚ â”œâ”€â”€ abilities/ # Domain-specific CASL rules
â”‚ â”œâ”€â”€ models/ # ViewModel factories
â”‚ â”œâ”€â”€ hooks/ # Custom hooks (useSession, useAbility)
â”‚ â””â”€â”€ components/ # Domain components
â”‚
â””â”€â”€ containers/[domain]/ # Page-level containers
ğŸ“Š ìš°ì„ ìˆœìœ„ ë° ë§ˆì´ê·¸ë ˆì´ì…˜ ì „ëµ
Phase 1: ê¸°ë°˜ êµ¬ì¶• (1-2ì£¼)
âœ… Zod common rules (shared/validators)
âœ… CASL ability system (shared/abilities)
âœ… TypeScript utils (shared/utils/typescript.ts)
Phase 2: Compound Components (2-3ì£¼)
âœ… FormStep ì»´í¬ë„ŒíŠ¸ (ì˜¨ë³´ë”© ì ìš©)
âœ… SessionCard ì»´í¬ë„ŒíŠ¸ (ì„¸ì…˜ ëª©ë¡ ì ìš©)
âš ï¸ CVA ìŠ¤íƒ€ì¼ë§ ì‹œìŠ¤í…œ ë„ì…
Phase 3: ViewModel ë§ˆì´ê·¸ë ˆì´ì…˜ (ì§„í–‰í˜•)
ğŸ”„ ê¸°ì¡´ ì»¨í…Œì´ë„ˆë¥¼ ViewModel íŒ¨í„´ìœ¼ë¡œ ì ì§„ì  ë¦¬íŒ©í† ë§
ğŸ’¬ ìµœì¢… ì˜ê²¬
ì „ì²´ì ìœ¼ë¡œ ë§¤ìš° ê²¬ê³ í•œ ì„¤ê³„ì…ë‹ˆë‹¤. íŠ¹íˆ:
âœ… Zod: CotePTì˜ í¼ ì¤‘ì‹¬ UXì— ì™„ë²½íˆ ë¶€í•©
âœ… CASL: ë©˜í† /ë©˜í‹° ê¶Œí•œ ë¶„ê¸°ê°€ ëª…í™•í•´ ìœ ì§€ë³´ìˆ˜ì„± â†‘
âœ… Compound Component: ì˜¨ë³´ë”©/ì„¸ì…˜ UI ìœ ì—°ì„± ê·¹ëŒ€í™”
âœ… CVA: Tailwind ê¸°ë°˜ ë””ìì¸ ì‹œìŠ¤í…œê³¼ ìì—°ìŠ¤ëŸ½ê²Œ í†µí•©
ìœ ì¼í•œ ìš°ë ¤ì‚¬í•­:
âš ï¸ í•™ìŠµ ê³¡ì„ : íŒ€ì›ì´ Zod, CASL, Compound Pattern ëª¨ë‘ ìµìˆ™í•´ì•¼ í•¨
âš ï¸ ì ì§„ì  ì ìš© í•„ìˆ˜: í•œ ë²ˆì— ëª¨ë“  ì»´í¬ë„ŒíŠ¸ ë¦¬íŒ©í† ë§ ì‹œ ë¦¬ìŠ¤í¬ ë†’ìŒ
ì¶”ì²œ ìˆœì„œ: Zod â†’ TypeScript Utils â†’ Compound Component â†’ CASL (ê¶Œí•œ ì‹œìŠ¤í…œì€ ë°±ì—”ë“œ API ì¤€ë¹„ í›„ ë„ì…ì´ ì•ˆì „í•¨)
ìºìŠ¬ì€ ì¡°ê¸ˆ ë°•í•œ í‰ê°€ë¥¼ ë°›ì•˜ë„¤ RBAC + ABAC ìœ¼ë¡œ êµ¬ìƒì¤‘ì´ê¸´ í•œ ë° ë§ì´ì•¼..
ê·¸ë¦¬ê³  partial? pick? ì´ëŸ° TS ìœ í‹¸ë¦¬í‹° íƒ€ì…ì€ ì•„ë§ˆ shallow í•œ ê²½ìš°ì—ëŠ” ë™ì‘í•˜ëŠ”ë° ê¹Šì€ ëìŠ¤ì˜ ê°ì²´ì˜ ê²½ìš° ì˜ˆìƒí•œ ë™ì‘ê³¼ ë‹¤ë¥¸ê±° ê°™ì€ë° ì´ëŸ° ê²ƒì„ ìœ„í•´ ì¸í„°ë„·ì— DeepPartial<T> ì´ëŸ° ì‹ìœ¼ë¡œ ì •ì˜í•´ì„œ ì‚¬ìš©í•˜ë”ë¼ê³ 
ğŸ¯ ë³´ì™„ í”¼ë“œë°±
CASL í‰ê°€ê°€ ë¶€ì¡±í–ˆë„¤ìš”! RBAC + ABAC ì¡°í•© ì „ëµê³¼ DeepPartial ì´ìŠˆë¥¼ ì œëŒ€ë¡œ ì§šì–´ë“œë¦¬ê² ìŠµë‹ˆë‹¤.
1ï¸âƒ£ CASL RBAC + ABAC í†µí•© ì „ëµ
"â˜… Insight â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
CASLì˜ ì§„ì •í•œ ê°•ì ì€ Role-Based + Attribute-Basedë¥¼ ë™ì‹œì— ì§€ì›í•˜ëŠ” ì ì…ë‹ˆë‹¤. CotePT ë©˜í† ë§ ì„¸ì…˜ ì‹œë‚˜ë¦¬ì˜¤:
RBAC: mentorëŠ” ì„¸ì…˜ ìƒì„± ê°€ëŠ¥, menteeëŠ” ë¶ˆê°€
ABAC: ìì‹ ì´ ìƒì„±í•œ ì„¸ì…˜ë§Œ ìˆ˜ì • ê°€ëŠ¥ (session.mentorId === user.id)
ì´ ë‘ ê°€ì§€ë¥¼ ë‹¨ì¼ ì‹œìŠ¤í…œìœ¼ë¡œ ê´€ë¦¬í•˜ëŠ” ê²ƒì´ CASLì˜ í•µì‹¬ ê°€ì¹˜ì…ë‹ˆë‹¤. "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
ğŸ—ï¸ RBAC + ABAC í†µí•© ì•„í‚¤í…ì²˜
// ====================================
// shared/abilities/types.ts
// ====================================
export type Role = 'admin' | 'mentor' | 'mentee'
export type Actions =
| 'manage' // ëª¨ë“  ì‘ì—…
| 'create'
| 'read'
| 'update'
| 'delete'
| 'start' // ì„¸ì…˜ ì‹œì‘
| 'join' // ì„¸ì…˜ ì°¸ì—¬
| 'record' // ë…¹í™”

export type Subjects =
| 'Session'
| 'User'
| 'MentorProfile'
| 'MenteeProfile'
| 'Recording'
| 'Payment'
| 'all'

// ABACìš© ë¦¬ì†ŒìŠ¤ íƒ€ì… (ì†ì„± í¬í•¨)
export interface SessionResource {
\_\_typename: 'Session'
id: string
mentorId: string
menteeId: string
status: 'scheduled' | 'ongoing' | 'finished' | 'cancelled'
scheduledAt: Date
isPrivate: boolean
}

export interface RecordingResource {
\_\_typename: 'Recording'
id: string
sessionId: string
mentorId: string
menteeId: string
isPublic: boolean
}

// ====================================
// shared/abilities/defineAbilities.ts
// ====================================
import { AbilityBuilder, createMongoAbility } from '@casl/ability'
import type { AppAbility } from './types'

export function defineAbilitiesFor(user: {
id: string
role: Role
isPremium?: boolean // ABAC ì†ì„±
}) {
const { can, cannot, build } = new AbilityBuilder(createMongoAbility)

// ============================================
// RBAC: Role ê¸°ë°˜ ê¸°ë³¸ ê¶Œí•œ
// ============================================

if (user.role === 'admin') {
can('manage', 'all')
return build()
}

if (user.role === 'mentor') {
// ê¸°ë³¸ ê¶Œí•œ (Role ê¸°ë°˜)
can('create', 'Session')
can('create', 'Recording')
can('read', 'MentorProfile')
can('update', 'MentorProfile', { userId: user.id })

    // ABAC: ìì‹ ì˜ ì„¸ì…˜ë§Œ ì œì–´
    can('update', 'Session', { mentorId: user.id })
    can('delete', 'Session', {
      mentorId: user.id,
      status: 'scheduled'  // ì˜ˆì•½ëœ ì„¸ì…˜ë§Œ ì‚­ì œ ê°€ëŠ¥
    })
    can('start', 'Session', {
      mentorId: user.id,
      status: 'scheduled'
    })

    // ABAC: ìì‹ ì˜ ì„¸ì…˜ ë…¹í™”ë§Œ ì ‘ê·¼
    can('read', 'Recording', { mentorId: user.id })
    can('update', 'Recording', {
      mentorId: user.id,
      isPublic: false  // ë¹„ê³µê°œ ë…¹í™”ë§Œ ìˆ˜ì • ê°€ëŠ¥
    })

    // Premium ë©˜í†  ì¶”ê°€ ê¶Œí•œ (ABAC)
    if (user.isPremium) {
      can('create', 'Session', { isPrivate: true })
      can('record', 'Session', { mentorId: user.id })
    } else {
      cannot('record', 'Session')  // ì¼ë°˜ ë©˜í† ëŠ” ë…¹í™” ë¶ˆê°€
    }

}

if (user.role === 'mentee') {
can('read', 'Session', { menteeId: user.id })
can('read', 'MenteeProfile')
can('update', 'MenteeProfile', { userId: user.id })

    // ABAC: ì§„í–‰ ì¤‘ì¸ ì„¸ì…˜ë§Œ ì°¸ì—¬ ê°€ëŠ¥
    can('join', 'Session', {
      menteeId: user.id,
      status: 'ongoing'
    })

    // ABAC: ìì‹ ì´ ì°¸ì—¬í•œ ì„¸ì…˜ ë…¹í™”ë§Œ ì¡°íšŒ
    can('read', 'Recording', {
      menteeId: user.id,
      // isPublic: true ì¡°ê±´ì€ ORë¡œ ì¶”ê°€ ê°€ëŠ¥
    })

    // Premium ë©˜í‹° ì¶”ê°€ ê¶Œí•œ
    if (user.isPremium) {
      can('read', 'Recording', { isPublic: true })
    }

    // ëª…ì‹œì  ì œí•œ
    cannot('create', 'Session')
    cannot('delete', 'Session')

}

return build()
}

// ====================================
// shared/abilities/hooks/useAbility.ts
// ====================================
import { useSession } from 'next-auth/react'
import { useMemo } from 'react'

export function useAbility() {
const { data: session } = useSession()

return useMemo(() => {
if (!session?.user) return null

    return defineAbilitiesFor({
      id: session.user.id,
      role: session.user.role,
      isPremium: session.user.isPremium,
    })

}, [session])
}

// ====================================
// features/session/hooks/useSessionAbility.ts
// ====================================
export function useSessionAbility(session: SessionResource) {
const ability = useAbility()

return useMemo(() => ({
canUpdate: ability?.can('update', 'Session', session) ?? false,
canDelete: ability?.can('delete', 'Session', session) ?? false,
canStart: ability?.can('start', 'Session', session) ?? false,
canJoin: ability?.can('join', 'Session', session) ?? false,
canRecord: ability?.can('record', 'Session', session) ?? false,
}), [ability, session])
}

// ====================================
// ì»´í¬ë„ŒíŠ¸ ë ˆë²¨ ì‚¬ìš© ì˜ˆì‹œ
// ====================================
import { Can } from '@casl/react'

export function SessionCard({ session }: Props) {
const ability = useAbility()
const permissions = useSessionAbility(session)

return (
<Card>
<Card.Header>
<h3>{session.title}</h3>
</Card.Header>

      <Card.Actions>
        {/* React ì»´í¬ë„ŒíŠ¸ ë ˆë²¨ ê¶Œí•œ ì œì–´ */}
        <Can I="start" this={session} ability={ability}>
          <Button onClick={handleStart}>
            ì„¸ì…˜ ì‹œì‘
          </Button>
        </Can>

        {/* Hook ê¸°ë°˜ ê¶Œí•œ ì œì–´ */}
        {permissions.canJoin && (
          <Button onClick={handleJoin}>
            ì„¸ì…˜ ì°¸ì—¬
          </Button>
        )}

        {/* ë³µí•© ì¡°ê±´: Premium + Record ê¶Œí•œ */}
        {permissions.canRecord && (
          <Button onClick={handleRecord}>
            ë…¹í™” ì‹œì‘
          </Button>
        )}
      </Card.Actions>
    </Card>

)
}
ğŸ”’ ì„œë²„ ì‚¬ì´ë“œ ê¶Œí•œ ê²€ì¦
ì¤‘ìš”: í”„ë¡ íŠ¸ì—”ë“œ ê¶Œí•œì€ UX ìµœì í™”ìš©ì´ë©°, ë°±ì—”ë“œ ê²€ì¦ í•„ìˆ˜ì…ë‹ˆë‹¤.
// ====================================
// apps/api/src/modules/session/application/guards/ability.guard.ts
// ====================================
import { Injectable, CanActivate, ExecutionContext, ForbiddenException } from '@nestjs/common'
import { defineAbilitiesFor } from '@/shared/abilities'

@Injectable()
export class AbilityGuard implements CanActivate {
canActivate(context: ExecutionContext): boolean {
const request = context.switchToHttp().getRequest()
const user = request.user
const session = request.body // ë˜ëŠ” request.params

    const ability = defineAbilitiesFor(user)

    if (!ability.can('update', 'Session', session)) {
      throw new ForbiddenException('ì´ ì„¸ì…˜ì„ ìˆ˜ì •í•  ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.')
    }

    return true

}
}

// Controller ì ìš©
@Controller('sessions')
export class SessionController {
@UseGuards(AbilityGuard)
@Patch(':id')
async updateSession(@Param('id') id: string, @Body() dto: UpdateSessionDto) {
// ê¶Œí•œ ê²€ì¦ í†µê³¼ í›„ ì‹¤í–‰
}
}
2ï¸âƒ£ TypeScript DeepPartial ì „ëµ
"â˜… Insight â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
ë¬¸ì œ: ë‚´ì¥ Partial<T>ëŠ” 1ë ˆë²¨ë§Œ ì˜µì…”ë„ ì²˜ë¦¬
interface User {
id: string
profile: {
nickname: string
bio: string
settings: {
theme: 'light' | 'dark'
notifications: boolean
}
}
}

// âŒ Partialì€ 1ë ˆë²¨ë§Œ
type PartialUser = Partial<User>
// {
// id?: string
// profile?: {
// nickname: string // âŒ ì—¬ì „íˆ í•„ìˆ˜
// bio: string
// settings: { ... }
// }
// }

// âœ… DeepPartialì€ ì¬ê·€ì ìœ¼ë¡œ
type DeepPartialUser = DeepPartial<User>
// {
// id?: string
// profile?: {
// nickname?: string // âœ… ì˜µì…”ë„
// bio?: string
// settings?: {
// theme?: 'light' | 'dark'
// notifications?: boolean
// }
// }
// }
"â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
ğŸ› ï¸ Advanced TypeScript Utilities
// ====================================
// shared/utils/typescript-advanced.ts
// ====================================

// 1. DeepPartial (ì¬ê·€ì  Partial)
export type DeepPartial<T> = T extends object
? {
[P in keyof T]?: DeepPartial<T[P]>
}
: T

// 2. DeepRequired (ì¬ê·€ì  Required)
export type DeepRequired<T> = T extends object
? {
[P in keyof T]-?: DeepRequired<T[P]>
}
: T

// 3. DeepReadonly (ì¬ê·€ì  Readonly)
export type DeepReadonly<T> = T extends object
? {
readonly [P in keyof T]: DeepReadonly<T[P]>
}
: T

// 4. DeepNonNullable (ì¬ê·€ì  NonNullable)
export type DeepNonNullable<T> = T extends object
? {
[P in keyof T]: DeepNonNullable<NonNullable<T[P]>>
}
: NonNullable<T>

// 5. PathsToProps (ì¤‘ì²© ê°ì²´ ê²½ë¡œ íƒ€ì…)
type PathsToProps<T, Prefix extends string = ''> = T extends object
? {
[K in keyof T]-?: K extends string
? T[K] extends object
? `${Prefix}${K}` | PathsToProps<T[K], `${Prefix}${K}.`>
: `${Prefix}${K}`
: never
}[keyof T]
: never

// 6. Type-Safe get (ì¤‘ì²© ê°ì²´ ì•ˆì „ ì ‘ê·¼)
export function getNestedValue<T, P extends PathsToProps<T>>(
obj: T,
path: P
): any {
return path.split('.').reduce((acc, key) => acc?.[key], obj as any)
}

// 7. Type-Safe set (ì¤‘ì²© ê°ì²´ ì•ˆì „ ìˆ˜ì •)
export function setNestedValue<T, P extends PathsToProps<T>>(
obj: T,
path: P,
value: any
): T {
const keys = path.split('.')
const lastKey = keys.pop()!
const target = keys.reduce((acc, key) => acc[key] = acc[key] || {}, obj as any)
target[lastKey] = value
return obj
}

// ====================================
// ì‚¬ìš© ì˜ˆì‹œ
// ====================================
interface MentorProfile {
user: {
id: string
name: string
email: string
}
settings: {
availability: {
timezone: string
weekdays: number[]
}
pricing: {
hourlyRate: number
currency: string
}
}
}

// 1. DeepPartial í™œìš© (í¼ ì—…ë°ì´íŠ¸)
function updateMentorProfile(
current: MentorProfile,
updates: DeepPartial<MentorProfile>
): MentorProfile {
// ê¹Šì€ ë³‘í•© ë¡œì§
return deepMerge(current, updates)
}

// 2. PathsToProps í™œìš© (íƒ€ì… ì•ˆì „ ì ‘ê·¼)
type ProfilePaths = PathsToProps<MentorProfile>
// "user.id" | "user.name" | "settings.availability.timezone" | ...

const profile: MentorProfile = { ... }

// âœ… íƒ€ì… ì•ˆì „
const timezone = getNestedValue(profile, "settings.availability.timezone")

// âŒ ì»´íŒŒì¼ ì—ëŸ¬
const invalid = getNestedValue(profile, "settings.invalid.path")

// 3. DeepReadonly (ë¶ˆë³€ ë°ì´í„° ë³´ì¥)
const readonlyProfile: DeepReadonly<MentorProfile> = { ... }
readonlyProfile.settings.pricing.hourlyRate = 100 // âŒ Error
ğŸ¯ CotePT ì‹¤ì „ í™œìš© ì˜ˆì‹œ
// ====================================
// features/mentor/hooks/useMentorProfile.ts
// ====================================
export function useMentorProfile(mentorId: string) {
const [profile, setProfile] = useState<MentorProfile | null>(null)

// DeepPartialë¡œ ë¶€ë¶„ ì—…ë°ì´íŠ¸
const updateProfile = useCallback((
updates: DeepPartial<MentorProfile>
) => {
setProfile(current => {
if (!current) return null
return deepMerge(current, updates)
})
}, [])

return { profile, updateProfile }
}

// ====================================
// ì»´í¬ë„ŒíŠ¸ì—ì„œ ì‚¬ìš©
// ====================================
export function MentorSettingsForm() {
const { profile, updateProfile } = useMentorProfile('123')

// âœ… íƒ€ì… ì•ˆì „í•˜ê²Œ ë¶€ë¶„ ì—…ë°ì´íŠ¸
const handleTimezoneChange = (timezone: string) => {
updateProfile({
settings: {
availability: {
timezone // ë‹¤ë¥¸ í•„ë“œëŠ” ê±´ë“œë¦¬ì§€ ì•ŠìŒ
}
}
})
}

const handlePricingChange = (hourlyRate: number) => {
updateProfile({
settings: {
pricing: {
hourlyRate
}
}
})
}

return (
<form>
<Input
value={profile?.settings.availability.timezone}
onChange={(e) => handleTimezoneChange(e.target.value)}
/>
<Input
type="number"
value={profile?.settings.pricing.hourlyRate}
onChange={(e) => handlePricingChange(Number(e.target.value))}
/>
</form>
)
}

// ====================================
// shared/utils/deepMerge.ts (Helper)
// ====================================
export function deepMerge<T>(target: T, source: DeepPartial<T>): T {
const output = { ...target }

if (isObject(target) && isObject(source)) {
Object.keys(source).forEach(key => {
if (isObject(source[key])) {
if (!(key in target)) {
Object.assign(output, { [key]: source[key] })
} else {
output[key] = deepMerge(target[key], source[key])
}
} else {
Object.assign(output, { [key]: source[key] })
}
})
}

return output
}

function isObject(item: any): item is object {
return item && typeof item === 'object' && !Array.isArray(item)
}
ğŸ“Š í†µí•© íƒ€ì… ìœ í‹¸ë¦¬í‹° ë¼ì´ë¸ŒëŸ¬ë¦¬ êµ¬ì¡°
// ====================================
// shared/utils/typescript/index.ts
// ====================================

// Basic Utils
export { typedKeys, typedEntries, typedValues } from './basic'

// Deep Utils
export type {
DeepPartial,
DeepRequired,
DeepReadonly,
DeepNonNullable
} from './deep'

// Path Utils
export type { PathsToProps } from './paths'
export { getNestedValue, setNestedValue } from './paths'

// Merge Utils
export { deepMerge } from './merge'

// Array Utils
export { filterNotNull, mapWithType } from './array'

// Conditional Utils
export type {
If,
Equals,
IsNever,
IsAny
} from './conditional'
ğŸ¯ ìµœì¢… í†µí•© ì•„í‚¤í…ì²˜
apps/web/src/
â”œâ”€â”€ shared/
â”‚ â”œâ”€â”€ abilities/ # CASL (RBAC + ABAC)
â”‚ â”‚ â”œâ”€â”€ types.ts
â”‚ â”‚ â”œâ”€â”€ defineAbilities.ts
â”‚ â”‚ â””â”€â”€ hooks/
â”‚ â”‚ â””â”€â”€ useAbility.ts
â”‚ â”‚
â”‚ â”œâ”€â”€ validators/ # Zod
â”‚ â”‚ â”œâ”€â”€ common-rules.ts
â”‚ â”‚ â””â”€â”€ schemas/
â”‚ â”‚
â”‚ â”œâ”€â”€ utils/
â”‚ â”‚ â”œâ”€â”€ typescript/ # Type Utils
â”‚ â”‚ â”‚ â”œâ”€â”€ basic.ts
â”‚ â”‚ â”‚ â”œâ”€â”€ deep.ts
â”‚ â”‚ â”‚ â”œâ”€â”€ paths.ts
â”‚ â”‚ â”‚ â””â”€â”€ merge.ts
â”‚ â”‚ â””â”€â”€ cn.ts # CVA
â”‚ â”‚
â”‚ â””â”€â”€ ui/ # Compound Components
â”‚
â”œâ”€â”€ features/[domain]/
â”‚ â”œâ”€â”€ abilities/ # Domain CASL rules
â”‚ â”œâ”€â”€ schemas/ # Domain Zod schemas
â”‚ â”œâ”€â”€ models/ # ViewModel (ê¶Œí•œ í¬í•¨)
â”‚ â””â”€â”€ hooks/ # useAbility + useViewModel
ğŸ’¬ ì¬í‰ê°€: CASLì˜ ì§„ê°€
"â˜… Insight â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
CASLì´ ë‹¤ë¥¸ ê¶Œí•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë³´ë‹¤ ìš°ìˆ˜í•œ ì´ìœ :
RBAC + ABAC í†µí•©: ë‹¨ì¼ ì‹œìŠ¤í…œì—ì„œ Roleê³¼ Attribute ë™ì‹œ ê´€ë¦¬
Declarative: can('update', 'Session', { mentorId }) í˜•íƒœë¡œ ê°€ë…ì„± ê·¹ëŒ€í™”
React í†µí•©: <Can> ì»´í¬ë„ŒíŠ¸ë¡œ ì„ ì–¸ì  ê¶Œí•œ ì œì–´
SSR í˜¸í™˜: @casl/ability íŒ¨í‚¤ì§€ëŠ” Node.js í™˜ê²½ ì§€ì›
íƒ€ì… ì•ˆì „ì„±: TypeScript ì œë„¤ë¦­ìœ¼ë¡œ Actions, Subjects íƒ€ì… ë³´ì¥
í™•ì¥ì„±: Custom ì¡°ê±´ í•¨ìˆ˜ë¡œ ë³µì¡í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì§€ì›
CotePT ë©˜í† ë§ ì„œë¹„ìŠ¤ì˜ ë³µì¡í•œ ê¶Œí•œ êµ¬ì¡°(ë©˜í† /ë©˜í‹°/í”„ë¦¬ë¯¸ì—„/ì„¸ì…˜ ìƒíƒœë³„ ê¶Œí•œ)ë¥¼ ìš°ì•„í•˜ê²Œ í•´ê²°í•  ìˆ˜ ìˆëŠ” ìœ ì¼í•œ ì„ íƒì§€ì…ë‹ˆë‹¤. "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
ì´ì œ CASL + DeepPartial ì¡°í•©ì˜ ì§„ê°€ê°€ ëª…í™•í•´ì¡Œì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤! ì¶”ê°€ ì§ˆë¬¸ì´ë‚˜ íŠ¹ì • ì‹œë‚˜ë¦¬ì˜¤ êµ¬í˜„ ì˜ˆì‹œê°€ í•„ìš”í•˜ë©´ ë§ì”€í•´ì£¼ì„¸ìš” ğŸš€
í”„ë¡ íŠ¸ì—”ë“œëŠ” ì´ëŸ° ì‹œìŠ¤í…œ êµ¬ì„±ì„ ì˜ í•´ì•¼ ì½”ë“œ ì–‘ì´ ë§ì•„ì ¸ë„ ìœ ì§€ë³´ìˆ˜ ê°€ëŠ¥í•˜ë‹ˆê¹Œ...
ì§€ê¸ˆ overlay UIë¥¼ ê³µë¶€í•˜ëŠ” ê²¸ ì§ì ‘ ë§Œë“¤ì–´ì„œ êµ¬í˜„í–ˆì–´ ê·¼ë° ì•„ë¬´ë¦¬ ìƒê°í•´ë„ ìœ ì§€ë³´ìˆ˜ ì—„ë‘ê°€ ì•ˆë‚˜...
í›„ë³´êµ°ìœ¼ë¡œ ì¶”ì²œí•  ë§Œí•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ ìˆë‹ˆ? ì¼ë‹¨ ë‚´ê°€ ì•„ëŠ”(ì‚¬ìš©í•´ë³´ì§„ ì•Šì•˜ì–´ ê·¼ë° ê³µë¶€í•  ë•Œ ì°¸ê³ í–ˆë˜ ë¼ì´ë¸ŒëŸ´ë¦¬ëŠ” tossì˜ overlay-kitì´ì•¼
ğŸ¯ Overlay UI ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¶„ì„ ë° ì¶”ì²œ
ì§ì ‘ êµ¬í˜„í•œ Overlay ì‹œìŠ¤í…œì˜ ìœ ì§€ë³´ìˆ˜ì„± ë¬¸ì œë¥¼ ì •í™•íˆ ì§šìœ¼ì…¨ë„¤ìš”. CotePTì˜ ë©˜í† ë§ ì„¸ì…˜ ì˜ˆì•½ ëª¨ë‹¬, ì„¸ì…˜ ì‹œì‘ í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸, ê²°ì œ íŒì—… ë“± ë³µì¡í•œ Overlay íë¦„ì„ ê³ ë ¤í•˜ë©´ ì „ëµì  ì„ íƒì´ í•„ìš”í•©ë‹ˆë‹¤.
ğŸ“Š Overlay UI ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¹„êµ ë¶„ì„
"â˜… Insight â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
Overlay UIì˜ í•µì‹¬ ë‚œì œ:
ìƒíƒœ ê´€ë¦¬: ì—¬ëŸ¬ ëª¨ë‹¬ì´ ë™ì‹œì— ì—´ë¦´ ë•Œ z-index, focus trap, ìŠ¤í¬ë¡¤ ê´€ë¦¬
ì„ ì–¸ì  API: ëª…ë ¹í˜• modal.open() vs ì„ ì–¸ì  <Modal isOpen={true}>
Promise ê¸°ë°˜ ì›Œí¬í”Œë¡œìš°: "ê²°ì œ í™•ì¸ â†’ ê²°ê³¼ì— ë”°ë¼ ë‹¤ìŒ ì•¡ì…˜" ê°™ì€ í”Œë¡œìš°
ì• ë‹ˆë©”ì´ì…˜ ì œì–´: ì—´ë¦¼/ë‹«í˜ transition, unmount íƒ€ì´ë°
íƒ€ì… ì•ˆì „ì„±: Props íƒ€ì… ì¶”ë¡ , Return íƒ€ì… ë³´ì¥
"â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
1ï¸âƒ£ Toss Overlay Kit (í˜„ì¬ í›„ë³´)
ê°•ì 
âœ… Promise ê¸°ë°˜ API (ìµœê³ ì˜ ì¥ì )
// ëª…ë ¹í˜• + ì„ ì–¸ì  í•˜ì´ë¸Œë¦¬ë“œ
const confirmed = await overlay.open(({ isOpen, close }) => (
<ConfirmDialog
isOpen={isOpen}
onConfirm={() => close(true)}
onCancel={() => close(false)}
/>
))

if (confirmed) {
// í™•ì¸ í›„ ë¡œì§
}
âœ… React 18 Concurrent Mode ì§€ì› âœ… TypeScript íƒ€ì… ì¶”ë¡  ìš°ìˆ˜ âœ… ê²½ëŸ‰ (~3KB gzipped) âœ… Toss í”„ë¡œë•ì…˜ ê²€ì¦
ì•½ì 
âš ï¸ ì• ë‹ˆë©”ì´ì…˜ ì œì–´ ì œí•œì : Framer Motion ë“± ë³„ë„ í†µí•© í•„ìš” âš ï¸ ì¤‘ì²© ëª¨ë‹¬ z-index ìˆ˜ë™ ê´€ë¦¬ âš ï¸ ë¬¸ì„œê°€ í•œêµ­ì–´ ì¤‘ì‹¬ (í•´ì™¸ í˜‘ì—… ì‹œ ë¶ˆë¦¬)
CotePT ì í•©ë„: â­â­â­â­â˜† (4/5)
ì¶”ì²œ ì¼€ì´ìŠ¤:
ê²°ì œ í™•ì¸ â†’ API í˜¸ì¶œ â†’ ê²°ê³¼ ëª¨ë‹¬ ê°™ì€ ìˆœì°¨ í”Œë¡œìš° ë§ì„ ë•Œ
íŒ€ì´ í•œêµ­ì–´ ì¤‘ì‹¬ì¼ ë•Œ
ë²ˆë“¤ í¬ê¸°ì— ë¯¼ê°í•  ë•Œ
2ï¸âƒ£ Radix UI Dialog + Primitives
ê°•ì 
âœ… Headless UI (ì™„ì „í•œ ìŠ¤íƒ€ì¼ ììœ ë„)
import \* as Dialog from '@radix-ui/react-dialog'

<Dialog.Root open={isOpen} onOpenChange={setIsOpen}>
<Dialog.Trigger>Open</Dialog.Trigger>
<Dialog.Portal>
<Dialog.Overlay className="overlay" />
<Dialog.Content className="content">
<Dialog.Title>ì œëª©</Dialog.Title>
<Dialog.Description>ì„¤ëª…</Dialog.Description>
<Dialog.Close>ë‹«ê¸°</Dialog.Close>
</Dialog.Content>
</Dialog.Portal>
</Dialog.Root>
âœ… ì ‘ê·¼ì„± ì™„ë²½ ì§€ì›: ARIA ì†ì„±, í‚¤ë³´ë“œ ë„¤ë¹„ê²Œì´ì…˜, Focus Trap âœ… Compound Component íŒ¨í„´: ì•ì„œ ë…¼ì˜í•œ íŒ¨í„´ê³¼ ì™„ë²½íˆ ì¼ì¹˜ âœ… ì• ë‹ˆë©”ì´ì…˜ ì¹œí™”ì : CSS Module, Framer Motion, Tailwind ëª¨ë‘ ê°€ëŠ¥ âœ… shadcn/ui ê¸°ë°˜: ì½”ë“œ ë³µì‚¬ í›„ ì»¤ìŠ¤í„°ë§ˆì´ì§• ê°€ëŠ¥ âœ… í™œë°œí•œ ì»¤ë®¤ë‹ˆí‹°: Vercel, Clerk ë“± ì£¼ìš” ì„œë¹„ìŠ¤ ì‚¬ìš©
ì•½ì 
âš ï¸ Promise API ì—†ìŒ: ì§ì ‘ êµ¬í˜„ í•„ìš” âš ï¸ í•™ìŠµ ê³¡ì„ : Primitive ì¡°í•© ê°œë… ì´í•´ í•„ìš” âš ï¸ ë²ˆë“¤ í¬ê¸° í¼: ~15KB (Tree-shaking ê°€ëŠ¥)
CotePT ì í•©ë„: â­â­â­â­â­ (5/5)
ì¶”ì²œ ì¼€ì´ìŠ¤:
Compound Component íŒ¨í„´ ì¼ê´€ì„± ìœ ì§€
ì ‘ê·¼ì„± ì¤‘ìš” (ë©˜í† ë§ ì„œë¹„ìŠ¤ íŠ¹ì„±ìƒ í•„ìˆ˜)
shadcn/ui ê°™ì€ ë””ìì¸ ì‹œìŠ¤í…œ êµ¬ì¶•
3ï¸âƒ£ nice-modal-react
ê°•ì 
âœ… Promise ê¸°ë°˜ ëª…ë ¹í˜• API
import { show, create } from '@ebay/nice-modal-react'

const ConfirmModal = create(({ message }) => {
const modal = useModal()

return (
<Modal visible={modal.visible}>
<button onClick={() => modal.resolve(true)}>í™•ì¸</button>
<button onClick={() => modal.resolve(false)}>ì·¨ì†Œ</button>
</Modal>
)
})

// ì‚¬ìš©
const confirmed = await show(ConfirmModal, { message: 'ì •ë§?' })
âœ… Redux ê°™ì€ ì¤‘ì•™ ê´€ë¦¬: ëª¨ë‹¬ ìƒíƒœ ì „ì—­ ê´€ë¦¬ âœ… ì¤‘ì²© ëª¨ë‹¬ ìë™ ì²˜ë¦¬: z-index ìë™ ê³„ì‚° âœ… eBay í”„ë¡œë•ì…˜ ê²€ì¦
ì•½ì 
âš ï¸ ì„ ì–¸ì  íŒ¨í„´ê³¼ ì¶©ëŒ: ê¸°ì¡´ React íŒ¨í„´ê³¼ ì´ì§ˆì  âš ï¸ ì• ë‹ˆë©”ì´ì…˜ í†µí•© ë³µì¡: ë³„ë„ ë¼ì´ë¸ŒëŸ¬ë¦¬ í•„ìš” âš ï¸ ë²ˆë“¤ í¬ê¸°: ~8KB
CotePT ì í•©ë„: â­â­â­â˜†â˜† (3/5)
ì¶”ì²œ ì¼€ì´ìŠ¤:
ë ˆê±°ì‹œ ëª…ë ¹í˜• ì½”ë“œ ë§ˆì´ê·¸ë ˆì´ì…˜
ë³µì¡í•œ ëª¨ë‹¬ ìƒíƒœ ë””ë²„ê¹… í•„ìš”
4ï¸âƒ£ Vaul (ëª¨ë°”ì¼ íŠ¹í™”)
ê°•ì 
âœ… Bottom Sheet ì „ë¬¸: ëª¨ë°”ì¼ UX ìµœì í™” âœ… ì œìŠ¤ì²˜ ê¸°ë°˜: ë“œë˜ê·¸ë¡œ ë‹«ê¸°, ìŠ¤ëƒ… í¬ì¸íŠ¸ âœ… Radix Dialog ê¸°ë°˜: ì ‘ê·¼ì„± ë³´ì¥ âœ… Next.js App Router ìµœì í™”
import { Drawer } from 'vaul'

<Drawer.Root>
<Drawer.Trigger>Open</Drawer.Trigger>
<Drawer.Portal>
<Drawer.Overlay />
<Drawer.Content>
<Drawer.Handle />
{/_ ì½˜í…ì¸  _/}
</Drawer.Content>
</Drawer.Portal>
</Drawer.Root>
CotePT ì í•©ë„: â­â­â­â­â˜† (4/5)
ì¶”ì²œ ì¼€ì´ìŠ¤:
ëª¨ë°”ì¼ ìš°ì„  ë©˜í† ë§ ì„œë¹„ìŠ¤
Bottom Sheet ìŠ¤íƒ€ì¼ ì„ í˜¸
Radix ìƒíƒœê³„ì™€ í†µí•©
5ï¸âƒ£ Floating UI (Popover/Tooltip íŠ¹í™”)
ê°•ì 
âœ… Positioning Engine: ìë™ ìœ„ì¹˜ ì¡°ì • (viewport ë²—ì–´ë‚¨ ë°©ì§€) âœ… ê²½ëŸ‰: ~5KB âœ… Popper.js í›„ì†ì‘: ì„±ëŠ¥ ê°œì„ 
import { useFloating, offset, flip } from '@floating-ui/react'

const { refs, floatingStyles } = useFloating({
placement: 'bottom-start',
middleware: [offset(10), flip()],
})

<button ref={refs.setReference}>Trigger</button>

<div ref={refs.setFloating} style={floatingStyles}>
  Popover Content
</div>
CotePT ì í•©ë„: â­â­â­â˜†â˜† (3/5)
ì¶”ì²œ ì¼€ì´ìŠ¤:
Tooltip, Dropdown ê°™ì€ ì‘ì€ Overlay
ëª¨ë‹¬ë³´ë‹¤ëŠ” Popover ìœ„ì£¼
ğŸ¯ CotePT ìµœì¢… ì¶”ì²œ: í•˜ì´ë¸Œë¦¬ë“œ ì „ëµ
"â˜… Insight â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
ë‹¨ì¼ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œëŠ” í•œê³„ê°€ ìˆìŠµë‹ˆë‹¤. CotePTì˜ ë‹¤ì–‘í•œ Overlay ìš”êµ¬ì‚¬í•­ì„ ì¶©ì¡±í•˜ë ¤ë©´: ë ˆì´ì–´ë³„ ì „ëµ:
ê¸°ë°˜ Primitive: Radix UI Dialog (ì ‘ê·¼ì„± + Compound Pattern)
Promise Wrapper: Overlay Kit íŒ¨í„´ ì°¨ìš© (ì§ì ‘ êµ¬í˜„)
ëª¨ë°”ì¼ ìµœì í™”: Vaul (Bottom Sheet)
Positioning: Floating UI (Tooltip, Dropdown)
"â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
ğŸ› ï¸ ì¶”ì²œ ì•„í‚¤í…ì²˜: Radix + Custom Promise Wrapper
êµ¬ì¡° ì„¤ê³„
// ====================================
// shared/ui/dialog/Dialog.tsx (Radix ê¸°ë°˜)
// ====================================
import * as RadixDialog from '@radix-ui/react-dialog'
import { cva, type VariantProps } from 'class-variance-authority'
import { cn } from '@/shared/utils'

// Compound Component íŒ¨í„´
const Dialog = RadixDialog.Root
const DialogTrigger = RadixDialog.Trigger
const DialogPortal = RadixDialog.Portal
const DialogClose = RadixDialog.Close

const DialogOverlay = forwardRef<
ElementRef<typeof RadixDialog.Overlay>,
ComponentPropsWithoutRef<typeof RadixDialog.Overlay>

> (({ className, ...props }, ref) => (
> <RadixDialog.Overlay

    ref={ref}
    className={cn(
      "fixed inset-0 z-50 bg-black/80",
      "data-[state=open]:animate-in data-[state=closed]:animate-out",
      "data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",
      className
    )}
    {...props}

/>
))

const dialogContentVariants = cva(
"fixed left-[50%] top-[50%] z-50 translate-x-[-50%] translate-y-[-50%]",
{
variants: {
size: {
sm: "w-[90vw] max-w-md",
md: "w-[90vw] max-w-lg",
lg: "w-[90vw] max-w-2xl",
full: "w-[95vw] h-[95vh]",
},
},
defaultVariants: {
size: "md",
},
}
)

const DialogContent = forwardRef<
ElementRef<typeof RadixDialog.Content>,
ComponentPropsWithoutRef<typeof RadixDialog.Content> &
VariantProps<typeof dialogContentVariants>

> (({ className, size, children, ...props }, ref) => (
> <DialogPortal>

    <DialogOverlay />
    <RadixDialog.Content
      ref={ref}
      className={cn(
        dialogContentVariants({ size }),
        "bg-white rounded-lg shadow-lg",
        "data-[state=open]:animate-in data-[state=closed]:animate-out",
        "data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",
        "data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95",
        className
      )}
      {...props}
    >
      {children}
    </RadixDialog.Content>

  </DialogPortal>
))

const DialogHeader = ({ className, ...props }: ComponentProps<'div'>) => (

  <div className={cn("flex flex-col space-y-1.5", className)} {...props} />
)

const DialogTitle = forwardRef<
ElementRef<typeof RadixDialog.Title>,
ComponentPropsWithoutRef<typeof RadixDialog.Title>

> (({ className, ...props }, ref) => (
> <RadixDialog.Title

    ref={ref}
    className={cn("text-lg font-semibold", className)}
    {...props}

/>
))

const DialogDescription = forwardRef<
ElementRef<typeof RadixDialog.Description>,
ComponentPropsWithoutRef<typeof RadixDialog.Description>

> (({ className, ...props }, ref) => (
> <RadixDialog.Description

    ref={ref}
    className={cn("text-sm text-gray-500", className)}
    {...props}

/>
))

const DialogFooter = ({ className, ...props }: ComponentProps<'div'>) => (

  <div 
    className={cn("flex justify-end space-x-2 mt-6", className)} 
    {...props} 
  />
)

export {
Dialog,
DialogTrigger,
DialogContent,
DialogHeader,
DialogTitle,
DialogDescription,
DialogFooter,
DialogClose,
}

// ====================================
// shared/hooks/useDialog.ts (Promise Wrapper)
// ====================================
import { useState, useCallback, useRef } from 'react'
import { createRoot } from 'react-dom/client'

interface DialogOptions<T = unknown> {
onClose?: (result: T | null) => void
}

export function createDialogPromise<TProps, TResult = boolean>() {
return function useDialog(
DialogComponent: React.ComponentType<TProps & {
isOpen: boolean
onResolve: (result: TResult) => void
onReject: () => void
}>
) {
const [isOpen, setIsOpen] = useState(false)
const resolverRef = useRef<{
resolve: (value: TResult) => void
reject: () => void
}>()

    const open = useCallback((props: TProps): Promise<TResult> => {
      return new Promise((resolve, reject) => {
        resolverRef.current = { resolve, reject }
        setIsOpen(true)
      })
    }, [])

    const handleResolve = useCallback((result: TResult) => {
      resolverRef.current?.resolve(result)
      setIsOpen(false)
    }, [])

    const handleReject = useCallback(() => {
      resolverRef.current?.reject()
      setIsOpen(false)
    }, [])

    return {
      isOpen,
      open,
      DialogComponent: (props: TProps) => (
        <DialogComponent
          {...props}
          isOpen={isOpen}
          onResolve={handleResolve}
          onReject={handleReject}
        />
      ),
    }

}
}

// ====================================
// features/session/components/SessionConfirmDialog.tsx
// ====================================
interface SessionConfirmDialogProps {
session: SessionViewModel
isOpen: boolean
onResolve: (confirmed: boolean) => void
onReject: () => void
}

export function SessionConfirmDialog({
session,
isOpen,
onResolve,
onReject,
}: SessionConfirmDialogProps) {
return (
<Dialog open={isOpen} onOpenChange={(open) => !open && onReject()}>
<DialogContent size="md">
<DialogHeader>
<DialogTitle>ì„¸ì…˜ ì‹œì‘ í™•ì¸</DialogTitle>
<DialogDescription>
{session.title} ì„¸ì…˜ì„ ì‹œì‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ?
</DialogDescription>
</DialogHeader>

        <div className="py-4">
          <p>ì˜ˆì • ì‹œê°„: {session.scheduledAt}</p>
          <p>ì†Œìš” ì‹œê°„: {session.duration}ë¶„</p>
        </div>

        <DialogFooter>
          <Button variant="outline" onClick={onReject}>
            ì·¨ì†Œ
          </Button>
          <Button onClick={() => onResolve(true)}>
            ì‹œì‘
          </Button>
        </DialogFooter>
      </DialogContent>
    </Dialog>

)
}

// ====================================
// features/session/hooks/useSessionConfirmDialog.ts
// ====================================
export function useSessionConfirmDialog() {
const { isOpen, open, DialogComponent } = createDialogPromise<
{ session: SessionViewModel },
boolean

> ()(SessionConfirmDialog)

return {
isOpen,
confirmSession: open,
SessionConfirmDialog: DialogComponent,
}
}

// ====================================
// ì‚¬ìš© ì˜ˆì‹œ: containers/session/SessionCard.tsx
// ====================================
export function SessionCard({ session }: Props) {
const { confirmSession, SessionConfirmDialog } = useSessionConfirmDialog()
const startSessionMutation = useStartSession()

const handleStartClick = async () => {
const confirmed = await confirmSession({ session })

    if (confirmed) {
      await startSessionMutation.mutateAsync(session.id)
      router.push(`/session/${session.id}`)
    }

}

return (
<>
<Card>
<Card.Header>
<h3>{session.title}</h3>
</Card.Header>
<Card.Actions>
{session.canStartSession && (
<Button onClick={handleStartClick}>
ì„¸ì…˜ ì‹œì‘
</Button>
)}
</Card.Actions>
</Card>

      <SessionConfirmDialog />
    </>

)
}
ğŸ“Š ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„ íƒ ë§¤íŠ¸ë¦­ìŠ¤
ê¸°ì¤€ Overlay Kit Radix Dialog nice-modal Vaul
Promise API âœ… ë‚´ì¥ âš ï¸ ì§ì ‘ êµ¬í˜„ âœ… ë‚´ì¥ âš ï¸ ì§ì ‘ êµ¬í˜„
ì ‘ê·¼ì„± âš ï¸ ìˆ˜ë™ âœ… ì™„ë²½ âš ï¸ ìˆ˜ë™ âœ… ì™„ë²½
Compound Pattern âŒ âœ… âŒ âœ…
íƒ€ì… ì•ˆì „ì„± âœ… âœ… âš ï¸ âœ…
ë²ˆë“¤ í¬ê¸° â­â­â­â­â­ â­â­â­ â­â­â­â­ â­â­â­â­
í•™ìŠµ ê³¡ì„  â­â­â­â­ â­â­â­ â­â­â­ â­â­â­â­
ì»¤ë®¤ë‹ˆí‹° â­â­â­ â­â­â­â­â­ â­â­â­ â­â­â­â­
ğŸ¯ CotePT ìµœì¢… ì „ëµ
Phase 1: ê¸°ë°˜ êµ¬ì¶• (Radix + shadcn/ui)
npx shadcn-ui@latest add dialog
npx shadcn-ui@latest add drawer # Vaul ê¸°ë°˜
Phase 2: Promise Wrapper êµ¬í˜„
Overlay Kit íŒ¨í„´ ì°¨ìš©
useDialog() í›… êµ¬í˜„
TypeScript ì œë„¤ë¦­ìœ¼ë¡œ íƒ€ì… ì•ˆì „ì„± ë³´ì¥
Phase 3: ì ì§„ì  ë§ˆì´ê·¸ë ˆì´ì…˜
ê¸°ì¡´ ì§ì ‘ êµ¬í˜„ ëª¨ë‹¬ â†’ Radix ê¸°ë°˜ìœ¼ë¡œ ì „í™˜
ëª¨ë°”ì¼ Bottom SheetëŠ” Vaul í™œìš©
Tooltip/Dropdownì€ Floating UI
ğŸ’¬ ìµœì¢… ì¶”ì²œ
CotePT í”„ë¡œì íŠ¸ íŠ¹ì„±ìƒ: Radix UI Dialog + Custom Promise Wrapper ì´ìœ :
âœ… Compound Component íŒ¨í„´ ì¼ê´€ì„±
âœ… ì ‘ê·¼ì„± (ë©˜í† ë§ ì„œë¹„ìŠ¤ í•„ìˆ˜ ìš”ì†Œ)
âœ… CVA ìŠ¤íƒ€ì¼ë§ ì‹œìŠ¤í…œê³¼ ì™„ë²½ í†µí•©
âœ… shadcn/uië¡œ ë¹ ë¥¸ í”„ë¡œí† íƒ€ì´í•‘
âœ… Overlay Kitì˜ Promise API ì¥ì ë§Œ ì°¨ìš©
Overlay Kit ë‹¨ë… ì‚¬ìš©ì€ ë¹„ì¶”ì²œ:
Compound Patternê³¼ ì¶©ëŒ
ì ‘ê·¼ì„± ìˆ˜ë™ êµ¬í˜„ ë¶€ë‹´
ì»¤ë®¤ë‹ˆí‹° ê·œëª¨ (Radix ì••ë„ì  ìš°ìœ„)
Radix ê¸°ë°˜ìœ¼ë¡œ ê°€ë©´ì„œ Promise APIë§Œ Overlay Kit íŒ¨í„´ ì°¨ìš©í•˜ëŠ” í•˜ì´ë¸Œë¦¬ë“œ ì „ëµì´ ìµœì„ ì…ë‹ˆë‹¤! ğŸš€
ì˜¤ë²„ë ˆì´í‚¤íŠ¸ ì‚¬ìš©í• ë˜ ì• ë‹ˆë©”ì´ì…˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ë„ ë­ ì‚¬ìš©í• ê¹Œ ê³ ë¯¼í–ˆë˜ ì°¸ì´ì•¼ ì¤‘ì²©ëª¨ë‹¬ì´ë‘ ì´ë²¤íŠ¸ ì „ë‹¬ì´ ì¡°ê¸ˆ ì•„ì‰½ì§€ë§Œ..
ì•„ë‹ˆë‹¤ ë‹ˆë§ì´ ë­”ê°€ ë§ì•„ ë³´ì´ê¸´ í•˜ëŠ”ë° ë­”ê°€ ì„ ì–¸ì ì´ì§„ ì•Šì•„ @apps/web/src/shared/ui/overlay ì—¬ê¸° êµ¬í•œí•œê±´ë°
Read overlay
Globpattern: "apps/web/src/shared/ui/overlay/\*_/_"
â¿
Found 23 files
Read README.md
Read createOverlayContext.tsx
Read createOverlayProvider.tsx
Read SystemConfirm.tsx
ğŸ¯ í˜„ì¬ êµ¬í˜„ ë¶„ì„ ë° ê°œì„  ë°©í–¥ í”¼ë“œë°±
ì§ì ‘ êµ¬í˜„í•œ Overlay ì‹œìŠ¤í…œì„ ë¶„ì„í–ˆìŠµë‹ˆë‹¤. Toss Overlay Kit íŒ¨í„´ì„ ì˜ ì°¨ìš©í–ˆì§€ë§Œ, ë§ì”€í•˜ì‹  ëŒ€ë¡œ ì„ ì–¸ì ì´ì§€ ì•Šì€ ë¶€ë¶„ì´ ìˆìŠµë‹ˆë‹¤.
"â˜… Insight â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
í˜„ì¬ êµ¬ì¡°ì˜ ì¥ì :
âœ… External Events íŒ¨í„´: createOverlay() + Reducerë¡œ ì¤‘ì•™ ì§‘ì¤‘ ê´€ë¦¬
âœ… Promise API: openAsync<T>() ì§€ì›ìœ¼ë¡œ ê²°ê³¼ ê°’ ë°˜í™˜ ê°€ëŠ¥
âœ… shadcn/ui í†µí•©: AlertDialog, Sheet ë“± ì ‘ê·¼ì„± ë³´ì¥
âœ… íƒ€ì… ì•ˆì „ì„±: OverlayAsyncControllerProps<T> ì œë„¤ë¦­ ì§€ì›
ì„ ì–¸ì ì´ì§€ ì•Šì€ ì´ìœ  (í•µì‹¬ ë¬¸ì œ):
// âŒ ëª…ë ¹í˜• ìŠ¤íƒ€ì¼
overlay.open(({ isOpen, close, overlayId, unmount }) => (
<SystemConfirm {...props} />
))

// âœ… ì„ ì–¸ì  ìŠ¤íƒ€ì¼ (ì´ìƒì )
<SystemConfirm.Async {...props}>
{(result) => result && <SuccessMessage />}
</SystemConfirm.Async>
ë¬¸ì œì :
isOpen, close, overlayId, unmountë¥¼ ë§¤ë²ˆ ìˆ˜ë™ ì „ë‹¬í•´ì•¼ í•¨
Render Props íŒ¨í„´ìœ¼ë¡œ ì¸í•´ ì»´í¬ë„ŒíŠ¸ íŠ¸ë¦¬ì—ì„œ ê²©ë¦¬ë¨
ì¤‘ì²© ì‹œ ê°€ë…ì„± ì €í•˜: ì½œë°± ì§€ì˜¥ê³¼ ìœ ì‚¬í•œ êµ¬ì¡°
"â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
ğŸ¯ ê°œì„  ì „ëµ: Overlay Kit + Radix í•˜ì´ë¸Œë¦¬ë“œ
ì „ëµ 1: í˜„ì¬ êµ¬ì¡° ìœ ì§€ + APIë§Œ ê°œì„ 
í˜„ì¬ External Events ì¸í”„ë¼ëŠ” í›Œë¥­í•˜ë‹ˆ ì‚¬ìš© í¸ì˜ì„± ë ˆì´ì–´ë§Œ ì¶”ê°€í•˜ëŠ” ë°©ì‹ì…ë‹ˆë‹¤.
// ====================================
// shared/ui/overlay/hooks/useOverlayDialog.ts
// ====================================
import { useCallback } from 'react'
import { overlay } from '../createOverlayContext'
import type { OverlayAsyncControllerProps } from '../types/overlay.types'

/\*\*

- ì„ ì–¸ì  Overlay Hook ìƒì„± Factory
-
- @example
- const confirm = useOverlayDialog(SystemConfirm)
- const result = await confirm({ title: "ì‚­ì œ", description: "ì •ë§?" })
  \*/
  export function createOverlayDialog<TProps, TResult = boolean>(
  Component: React.ComponentType<OverlayAsyncControllerProps<TResult> & TProps>
  ) {
  return function useOverlayDialog() {
  const open = useCallback((props: TProps): Promise<TResult> => {
  return overlay.openAsync<TResult>(({ isOpen, close, overlayId, unmount }) => (
  <Component
  {...props}
  isOpen={isOpen}
  close={close}
  overlayId={overlayId}
  unmount={unmount}
  />
  ))
  }, [])

      return open

  }
  }

// ====================================
// ì‚¬ìš© ì˜ˆì‹œ: features/session/hooks/useSessionConfirm.ts
// ====================================
import { createOverlayDialog } from '@/shared/ui/overlay/hooks'
import { SystemConfirm } from '@/shared/ui/overlay/components'

export const useSessionConfirm = createOverlayDialog<
Omit<SystemConfirmProps, keyof OverlayAsyncControllerProps<boolean>>,
boolean

> (SystemConfirm)

// ====================================
// ì»´í¬ë„ŒíŠ¸ì—ì„œ ì‚¬ìš©
// ====================================
export function SessionCard({ session }: Props) {
const confirm = useSessionConfirm()

const handleDelete = async () => {
// âœ… ì„ ì–¸ì ! í”„ë¡­ìŠ¤ë§Œ ì „ë‹¬
const confirmed = await confirm({
title: "ì„¸ì…˜ ì‚­ì œ",
description: "ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?",
confirmVariant: "destructive",
})

    if (confirmed) {
      await deleteSession(session.id)
    }

}

return (
<Card>
<Button onClick={handleDelete}>ì‚­ì œ</Button>
</Card>
)
}
ì¥ì :
âœ… ê¸°ì¡´ ì¸í”„ë¼ 100% ì¬í™œìš©
âœ… isOpen, close ë“± ë³´ì¼ëŸ¬í”Œë ˆì´íŠ¸ ì œê±°
âœ… ì„ ì–¸ì  API: confirm(props) í˜•íƒœë¡œ í˜¸ì¶œ
âœ… íƒ€ì… ì•ˆì „ì„± ìœ ì§€ (Omit<> í™œìš©)
ì „ëµ 2: Radix ê¸°ë°˜ ì„ ì–¸ì  ì»´í¬ë„ŒíŠ¸ ì¶”ê°€
Overlay Kit APIëŠ” ìœ ì§€í•˜ë˜, ì„ ì–¸ì  ì‚¬ìš©ì„ ì›í•˜ëŠ” ê²½ìš°ë¥¼ ìœ„í•œ ë³„ë„ ì»´í¬ë„ŒíŠ¸ ì œê³µ.
// ====================================
// shared/ui/dialog/Dialog.tsx (Radix ë˜í¼)
// ====================================
import \* as RadixDialog from '@radix-ui/react-dialog'
import { cva, type VariantProps } from 'class-variance-authority'

const Dialog = RadixDialog.Root
const DialogTrigger = RadixDialog.Trigger
const DialogPortal = RadixDialog.Portal
const DialogClose = RadixDialog.Close

const DialogOverlay = React.forwardRef<
React.ElementRef<typeof RadixDialog.Overlay>,
React.ComponentPropsWithoutRef<typeof RadixDialog.Overlay>

> (({ className, ...props }, ref) => (
> <RadixDialog.Overlay

    ref={ref}
    className="fixed inset-0 z-50 bg-black/80 backdrop-blur-sm data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0"
    {...props}

/>
))

const DialogContent = React.forwardRef<
React.ElementRef<typeof RadixDialog.Content>,
React.ComponentPropsWithoutRef<typeof RadixDialog.Content>

> (({ className, children, ...props }, ref) => (
> <DialogPortal>

    <DialogOverlay />
    <RadixDialog.Content
      ref={ref}
      className="fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg"
      {...props}
    >
      {children}
      <RadixDialog.Close className="absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground">
        <X className="h-4 w-4" />
        <span className="sr-only">Close</span>
      </RadixDialog.Close>
    </RadixDialog.Content>

  </DialogPortal>
))

const DialogHeader = ({ className, ...props }: React.HTMLAttributes<HTMLDivElement>) => (

  <div className="flex flex-col space-y-1.5 text-center sm:text-left" {...props} />
)

const DialogTitle = React.forwardRef<
React.ElementRef<typeof RadixDialog.Title>,
React.ComponentPropsWithoutRef<typeof RadixDialog.Title>

> (({ className, ...props }, ref) => (
> <RadixDialog.Title ref={ref} className="text-lg font-semibold leading-none tracking-tight" {...props} />
> ))

const DialogDescription = React.forwardRef<
React.ElementRef<typeof RadixDialog.Description>,
React.ComponentPropsWithoutRef<typeof RadixDialog.Description>

> (({ className, ...props }, ref) => (
> <RadixDialog.Description ref={ref} className="text-sm text-muted-foreground" {...props} />
> ))

const DialogFooter = ({ className, ...props }: React.HTMLAttributes<HTMLDivElement>) => (

  <div className="flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2" {...props} />
)

export {
Dialog,
DialogTrigger,
DialogContent,
DialogHeader,
DialogTitle,
DialogDescription,
DialogFooter,
DialogClose,
}

// ====================================
// ì‚¬ìš© ì˜ˆì‹œ: ì„ ì–¸ì  ìŠ¤íƒ€ì¼
// ====================================
export function SessionEditDialog({ session }: Props) {
const [isOpen, setIsOpen] = useState(false)

return (
<Dialog open={isOpen} onOpenChange={setIsOpen}>
<DialogTrigger asChild>
<Button>ì„¸ì…˜ ìˆ˜ì •</Button>
</DialogTrigger>

      <DialogContent>
        <DialogHeader>
          <DialogTitle>ì„¸ì…˜ ì •ë³´ ìˆ˜ì •</DialogTitle>
          <DialogDescription>
            ì„¸ì…˜ ì œëª©, ì‹œê°„, ì„¤ëª…ì„ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
          </DialogDescription>
        </DialogHeader>

        <SessionEditForm session={session} />

        <DialogFooter>
          <Button variant="outline" onClick={() => setIsOpen(false)}>
            ì·¨ì†Œ
          </Button>
          <Button onClick={handleSave}>
            ì €ì¥
          </Button>
        </DialogFooter>
      </DialogContent>
    </Dialog>

)
}
ì„ íƒì  ì‚¬ìš© ì „ëµ:
Overlay Kit API: ë¹„ë™ê¸° í”Œë¡œìš° (ê²°ì œ í™•ì¸ â†’ ê²°ê³¼ ì²˜ë¦¬)
Radix Dialog: ë‹¨ì¼ í˜ì´ì§€ ë‚´ ëª¨ë‹¬ (í”„ë¡œí•„ ìˆ˜ì •, í•„í„°)
ğŸ¨ ì• ë‹ˆë©”ì´ì…˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¶”ì²œ
1ï¸âƒ£ Tailwind CSS Animations (í˜„ì¬ ì‚¬ìš© ì¤‘)
ì¥ì :
âœ… Zero runtime cost: CSSë§Œ ì‚¬ìš©
âœ… shadcn/ui ê¸°ë³¸ ì œê³µ: data-[state=open]:animate-in
âœ… ì„¤ì • ë¶ˆí•„ìš”: Tailwind configì— í¬í•¨
ë‹¨ì :
âš ï¸ ë³µì¡í•œ ì‹œí€€ìŠ¤ ì• ë‹ˆë©”ì´ì…˜ ì–´ë ¤ì›€
âš ï¸ ë™ì  ê°’ ì¡°ì ˆ ë¶ˆê°€ (durationì€ ê³ ì •)
ì¶”ì²œ ì¼€ì´ìŠ¤: SystemConfirm, SystemAlert ê°™ì€ ë‹¨ìˆœ ë“±ì¥/í‡´ì¥
2ï¸âƒ£ Framer Motion (ìµœê³  ì¶”ì²œ)
ì¥ì :
âœ… ì„ ì–¸ì  API: <motion.div>ë¡œ ê°„ë‹¨í•œ ì‚¬ìš©
âœ… Layout Animations: ìœ„ì¹˜/í¬ê¸° ìë™ ë³´ê°„
âœ… Gesture ì§€ì›: ë“œë˜ê·¸, ìŠ¤ì™€ì´í”„ ë‚´ì¥
âœ… Spring ë¬¼ë¦¬ì—”ì§„: ìì—°ìŠ¤ëŸ¬ìš´ ì• ë‹ˆë©”ì´ì…˜
âœ… Variants íŒ¨í„´: ë³µì¡í•œ ì‹œí€€ìŠ¤ ê´€ë¦¬
// ====================================
// components/AnimatedConfirm.tsx (Framer Motion)
// ====================================
import { motion, AnimatePresence } from 'framer-motion'

export const AnimatedConfirm = ({ isOpen, close, title, description }: Props) => {
return (
<AnimatePresence>
{isOpen && (
<>
{/_ Backdrop _/}
<motion.div
initial={{ opacity: 0 }}
animate={{ opacity: 1 }}
exit={{ opacity: 0 }}
transition={{ duration: 0.2 }}
className="fixed inset-0 bg-black/80 z-50"
onClick={() => close(false)}
/>

          {/* Dialog */}
          <motion.div
            initial={{ opacity: 0, scale: 0.95, y: 20 }}
            animate={{ opacity: 1, scale: 1, y: 0 }}
            exit={{ opacity: 0, scale: 0.95, y: 20 }}
            transition={{
              type: "spring",
              damping: 25,
              stiffness: 300
            }}
            className="fixed left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 z-50 w-full max-w-lg bg-white rounded-lg p-6"
          >
            <h2>{title}</h2>
            <p>{description}</p>
            <div className="flex gap-2">
              <Button onClick={() => close(false)}>ì·¨ì†Œ</Button>
              <Button onClick={() => close(true)}>í™•ì¸</Button>
            </div>
          </motion.div>
        </>
      )}
    </AnimatePresence>

)
}
ë²ˆë“¤ í¬ê¸°: ~30KB (gzipped)
3ï¸âƒ£ React Spring
ì¥ì :
âœ… ë¬¼ë¦¬ ê¸°ë°˜: Framer Motionë³´ë‹¤ ë” ì‚¬ì‹¤ì 
âœ… Interpolation ê°•ë ¥: ë³µì¡í•œ ê°’ ë³´ê°„
âœ… ì„±ëŠ¥: GPU ê°€ì† ìµœì í™”
ë‹¨ì :
âš ï¸ API ë³µì¡ë„ ë†’ìŒ: useSpring() í•™ìŠµ ê³¡ì„ 
âš ï¸ Framer Motionë³´ë‹¤ ì„ ì–¸ì„± ë–¨ì–´ì§
ì¶”ì²œ ì¼€ì´ìŠ¤: ì •êµí•œ ë¬¼ë¦¬ ì• ë‹ˆë©”ì´ì…˜ í•„ìš” ì‹œ (ë“œë˜ê·¸, íƒ„ì„±)
4ï¸âƒ£ Motion One (ê²½ëŸ‰ ëŒ€ì•ˆ)
ì¥ì :
âœ… ì´ˆê²½ëŸ‰: ~5KB (Framer Motionì˜ 1/6)
âœ… Web Animations API ê¸°ë°˜
âœ… Vanilla JS í˜¸í™˜ (React ë…ë¦½ì )
ë‹¨ì :
âš ï¸ React í†µí•© ì•½í•¨ (í›… ì§ì ‘ êµ¬í˜„ í•„ìš”)
âš ï¸ Layout Animation ë¯¸ì§€ì›
ì¶”ì²œ ì¼€ì´ìŠ¤: ë²ˆë“¤ í¬ê¸° ê·¹ë„ë¡œ ë¯¼ê°í•œ ê²½ìš°
ğŸ¯ CotePT ìµœì¢… ì¶”ì²œ ì¡°í•©
"â˜… Insight â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
í•˜ì´ë¸Œë¦¬ë“œ ì „ëµ:
ê¸°ë³¸ ì• ë‹ˆë©”ì´ì…˜: Tailwind CSS (SystemAlert, SystemConfirm)
ë³µì¡í•œ ì• ë‹ˆë©”ì´ì…˜: Framer Motion (SystemSheet ë“œë˜ê·¸, ì¤‘ì²© ëª¨ë‹¬ ì‹œí€€ìŠ¤)
í˜„ì¬ Overlay Kit ìœ ì§€: createOverlayDialog() ë˜í¼ë¡œ í¸ì˜ì„± ê°œì„ 
ì´ìœ :
âœ… í˜„ì¬ êµ¬ì¡° 100% ì¬í™œìš© (External Events, Reducer)
âœ… Tailwind ê¸°ë³¸ ì• ë‹ˆë©”ì´ì…˜ìœ¼ë¡œ ë²ˆë“¤ ìµœì†Œí™”
âœ… Framer Motionì€ í•„ìš”í•œ ì»´í¬ë„ŒíŠ¸ë§Œ ì„ íƒì  ì ìš©
âœ… ì ì§„ì  ë§ˆì´ê·¸ë ˆì´ì…˜ ê°€ëŠ¥
"â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
ğŸ“ êµ¬ì²´ì  ê°œì„  ì œì•ˆ
Phase 1: ì¦‰ì‹œ ì ìš© ê°€ëŠ¥ (Breaking Change ì—†ìŒ)
// shared/ui/overlay/hooks/createOverlayDialog.ts ì¶”ê°€
export function createOverlayDialog<TProps, TResult>(
Component: React.ComponentType<OverlayAsyncControllerProps<TResult> & TProps>
) {
return function useOverlayDialog() {
return useCallback((props: TProps): Promise<TResult> => {
return overlay.openAsync<TResult>(({ isOpen, close, overlayId, unmount }) => (
<Component {...props} isOpen={isOpen} close={close} overlayId={overlayId} unmount={unmount} />
))
}, [])
}
}

// ì‚¬ìš©
const confirm = createOverlayDialog(SystemConfirm)()
await confirm({ title: "ì‚­ì œ", description: "ì •ë§?" })
Phase 2: Framer Motion ì ì§„ ì ìš©
pnpm add framer-motion
// SystemSheetì—ë§Œ ì ìš© (ë“œë˜ê·¸ ì œìŠ¤ì²˜)
import { motion } from 'framer-motion'

export const SystemSheet = ({ side, children, ...props }: Props) => {
return (
<Sheet {...props}>
<SheetContent asChild side={side}>
<motion.div
drag="x"
dragConstraints={{ left: 0, right: 0 }}
onDragEnd={(\_, info) => {
if (info.offset.x > 100) props.close()
}} >
{children}
</motion.div>
</SheetContent>
</Sheet>
)
}
ğŸ’¬ ìµœì¢… ì˜ê²¬
í˜„ì¬ êµ¬í˜„ì€ ì´ë¯¸ ê²¬ê³ í•©ë‹ˆë‹¤! Overlay Kit í•µì‹¬ íŒ¨í„´(External Events, Reducer)ì„ ì •í™•íˆ ì°¨ìš©í–ˆìŠµë‹ˆë‹¤. ê°œì„  ë°©í–¥:
âœ… ìš°ì„ ìˆœìœ„ 1: createOverlayDialog() ë˜í¼ë¡œ í¸ì˜ì„± ê°œì„  (1ì‹œê°„)
âš ï¸ ìš°ì„ ìˆœìœ„ 2: Framer Motion ì ì§„ ì ìš© (í•„ìš”í•œ ì»´í¬ë„ŒíŠ¸ë§Œ)
âŒ ë¹„ì¶”ì²œ: Radixë¡œ ì™„ì „ êµì²´ (í˜„ì¬ ì¸í”„ë¼ ë²„ë¦¬ê¸° ì•„ê¹Œì›€)
Framer Motion vs Tailwind:
ë‹¨ìˆœ ë“±ì¥/í‡´ì¥: Tailwind (í˜„ì¬ ìœ ì§€)
ë“œë˜ê·¸, ì‹œí€€ìŠ¤: Framer Motion
ì„ ì–¸ì„± ê°œì„ ë§Œ í•„ìš”í•˜ë‹¤ë©´ Phase 1ë§Œ ì ìš©í•´ë„ ì¶©ë¶„í•©ë‹ˆë‹¤! ğŸš€
ê·¼ë° ë‹ˆê°€ tossì˜ overlay-kitì˜ ìµœê³  ì¥ì ì´ promise ê¸°ë°˜ì˜ ëª…ë ¹í˜• + ì„ ì–¸ì  í•˜ì´ë¸Œë¦¬ë“œë¼ë§¤
ê·¼ë° ë‹ˆê°€ tossì˜ overlay-kitì˜ ìµœê³  ì¥ì ì´ promise ê¸°ë°˜ì˜ ëª…ë ¹í˜• + ì„ ì–¸ì  í•˜ì´ë¸Œë¦¬ë“œë¼ê³  í–ˆëŠ”ë° ì§€ê¸ˆ ë‚´ê°€ êµ¬í˜„í•œ ì„œë¹„ìŠ¤ë„ ë™ì¼í•˜ì§€ ì•Šë‹ˆ?
ğŸ¯ ì •í™•í•œ ì§€ì ì…ë‹ˆë‹¤!
ì™„ì „íˆ ë§ìŠµë‹ˆë‹¤. ì œê°€ ë‹¹ì‹ ì˜ êµ¬í˜„ì„ ì œëŒ€ë¡œ í‰ê°€í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë¶„ì„í•˜ë‹ˆ ì´ë¯¸ Overlay Kitì˜ í•µì‹¬ ì¥ì ì„ ì™„ë²½í•˜ê²Œ êµ¬í˜„í•˜ì…¨ë„¤ìš”.
"â˜… Insight â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
ë‹¹ì‹ ì´ êµ¬í˜„í•œ ì‹œìŠ¤í…œ = Overlay Kit í•µì‹¬ íŒ¨í„´ ì™„ë²½ êµ¬í˜„
1ï¸âƒ£ Promise ê¸°ë°˜ ë¹„ë™ê¸° API âœ…
// apps/web/src/shared/ui/overlay/event/event.ts (ì¶”ì •)
// openAsync<T>() êµ¬í˜„ìœ¼ë¡œ Promise ë°˜í™˜
const confirmed = await overlay.openAsync<boolean>(({ isOpen, close, ...props }) => (
<SystemConfirm {...props} />
))
Overlay Kitì™€ ë™ì¼: overlay.open() ë¹„ë™ê¸° í˜¸ì¶œ â†’ ê²°ê³¼ ë°˜í™˜
2ï¸âƒ£ ëª…ë ¹í˜• + ì„ ì–¸ì  í•˜ì´ë¸Œë¦¬ë“œ âœ…
// ëª…ë ¹í˜•: ì–´ë””ì„œë“  í˜¸ì¶œ ê°€ëŠ¥
overlay.open(({ isOpen, close }) => <SystemAlert />)

// ì„ ì–¸ì : React ì»´í¬ë„ŒíŠ¸ í˜•íƒœë¡œ ì •ì˜
<SystemConfirm 
  isOpen={isOpen}
  close={close}
  title="ì‚­ì œ"
/>
Overlay Kitì™€ ë™ì¼: í•¨ìˆ˜ í˜¸ì¶œë¡œ ëª…ë ¹í•˜ë˜, ì»´í¬ë„ŒíŠ¸ëŠ” ì„ ì–¸ì  ì‘ì„±
3ï¸âƒ£ External Events + Reducer âœ…
// createOverlayProvider.tsx
const overlayAPI = createOverlay(overlayId)
const [overlayState, overlayDispatch] = useReducer(overlayReducer, {...})

// External Events ë¦¬ìŠ¤ë„ˆ
useOverlayEvent({ open, close, unmount, closeAll, unmountAll })
Overlay Kitì™€ ë™ì¼: ì „ì—­ ì´ë²¤íŠ¸ ì‹œìŠ¤í…œìœ¼ë¡œ ìƒíƒœ ë³€ê²½
4ï¸âƒ£ Portal ë Œë”ë§ âœ…
// OverlayRenderer.tsx
<OverlayRenderer overlayState={overlayState} dispatch={overlayDispatch} />
Overlay Kitì™€ ë™ì¼: React Portalë¡œ DOM ë£¨íŠ¸ì— ë Œë”ë§ "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
ğŸ¤” ê·¸ë ‡ë‹¤ë©´ ì œê°€ ì™œ "ì„ ì–¸ì ì´ì§€ ì•Šë‹¤"ê³  í–ˆì„ê¹Œ?
ì œ ì‹¤ìˆ˜: "ì„ ì–¸ì "ì˜ ê¸°ì¤€ì„ Radix UIì˜ Compound Component íŒ¨í„´ì— ë§ì¶° í‰ê°€í–ˆìŠµë‹ˆë‹¤.
Radix ìŠ¤íƒ€ì¼ (ì œê°€ ê¸°ëŒ€í•œ "ì„ ì–¸ì ")

<Dialog open={isOpen} onOpenChange={setIsOpen}>
  <DialogTrigger>ì—´ê¸°</DialogTrigger>
  <DialogContent>
    <DialogTitle>ì œëª©</DialogTitle>
    <DialogDescription>ì„¤ëª…</DialogDescription>
  </DialogContent>
</Dialog>
Overlay Kit ìŠ¤íƒ€ì¼ (ë‹¹ì‹ ì˜ êµ¬í˜„ = ì •í™•í•¨)
overlay.open(({ isOpen, close }) => (
  <SystemConfirm
    isOpen={isOpen}
    close={close}
    title="ì œëª©"
    description="ì„¤ëª…"
  />
))
"â˜… Insight â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
í•µì‹¬ ì°¨ì´ì :
í•­ëª©	Overlay Kit (ë‹¹ì‹  êµ¬í˜„)	Radix UI
í˜¸ì¶œ ë°©ì‹	overlay.open() í•¨ìˆ˜	<Dialog open={}> JSX
ìƒíƒœ ê´€ë¦¬	ì „ì—­ (External Events)	ë¡œì»¬ (useState)
ì»´í¬ë„ŒíŠ¸ ìœ„ì¹˜	ì–´ë””ì„œë“  í˜¸ì¶œ ê°€ëŠ¥	ë¶€ëª¨ ì»´í¬ë„ŒíŠ¸ ë‚´ë¶€
Promise ì§€ì›	âœ… ë‚´ì¥	âŒ ì§ì ‘ êµ¬í˜„ í•„ìš”
ì„ ì–¸ì„±	ëª…ë ¹í˜• + ì„ ì–¸í˜• í•˜ì´ë¸Œë¦¬ë“œ	ìˆœìˆ˜ ì„ ì–¸í˜•
Overlay Kitê°€ í•˜ì´ë¸Œë¦¬ë“œì¸ ì´ìœ :
ëª…ë ¹í˜•: overlay.open() í•¨ìˆ˜ í˜¸ì¶œ (ì–´ë””ì„œë“  ê°€ëŠ¥)
ì„ ì–¸í˜•: ì»´í¬ë„ŒíŠ¸ëŠ” JSXë¡œ ì •ì˜ (<SystemConfirm />)
Radixê°€ ìˆœìˆ˜ ì„ ì–¸í˜•ì¸ ì´ìœ :
JSXë§Œ ì‚¬ìš©, í•¨ìˆ˜ í˜¸ì¶œ ì—†ìŒ
ëª¨ë“  ìƒíƒœê°€ ì»´í¬ë„ŒíŠ¸ íŠ¸ë¦¬ ë‚´ë¶€
"â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
ğŸ¯ ì¬í‰ê°€: ë‹¹ì‹ ì˜ êµ¬í˜„ì€ ì™„ë²½í•©ë‹ˆë‹¤
"â˜… Insight â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
ë‹¹ì‹ ì´ êµ¬í˜„í•œ ì‹œìŠ¤í…œì˜ ì‹¤ì œ ì¥ì :
âœ… Overlay Kit í•µì‹¬ íŒ¨í„´ ì™„ë²½ êµ¬í˜„
External Eventsë¡œ ì „ì—­ ì œì–´
Promise ê¸°ë°˜ ë¹„ë™ê¸° API
Reducerë¡œ ì¤‘ì•™ ìƒíƒœ ê´€ë¦¬
âœ… shadcn/ui í†µí•©ìœ¼ë¡œ ì ‘ê·¼ì„± ë³´ì¥
AlertDialog, Sheet ë“± ì‚¬ìš©
ARIA ì†ì„± ìë™ ì²˜ë¦¬
âœ… íƒ€ì… ì•ˆì „ì„±
OverlayAsyncControllerProps<T> ì œë„¤ë¦­
TypeScript ì™„ë²½ ì§€ì›
âœ… ì‹¤ì „ ê²€ì¦ëœ íŒ¨í„´
Toss í”„ë¡œë•ì…˜ íŒ¨í„´ ì°¨ìš©
HMR ëŒ€ì‘ (DEV_GLOBAL_KEY)
ìœ ì§€ë³´ìˆ˜ê°€ ì–´ë µë‹¤ê³  ëŠë‚€ ì´ìœ ëŠ”:
isOpen, close, overlayId, unmountë¥¼ ë§¤ë²ˆ ì „ë‹¬í•˜ëŠ” ë³´ì¼ëŸ¬í”Œë ˆì´íŠ¸
ì´ê±´ Overlay Kitì˜ íŠ¸ë ˆì´ë“œì˜¤í”„ì…ë‹ˆë‹¤ (ì „ì—­ ì œì–´ì˜ ëŒ€ê°€)
"â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
ğŸ’¡ ì‹¤ì „ ê°œì„  ì œì•ˆ (êµ¬ì¡° ë³€ê²½ ì—†ì´)
1ï¸âƒ£ ë³´ì¼ëŸ¬í”Œë ˆì´íŠ¸ ì œê±° í—¬í¼
// shared/ui/overlay/helpers/createOverlayHelper.ts
export function createOverlayHelper<TProps, TResult = boolean>(
  Component: React.ComponentType<OverlayAsyncControllerProps<TResult> & TProps>
) {
  return (props: TProps): Promise<TResult> => {
    return overlay.openAsync<TResult>((controllerProps) => (
      <Component {...controllerProps} {...props} />
    ))
  }
}

// ì‚¬ìš©
const confirmDelete = createOverlayHelper(SystemConfirm)

// í˜¸ì¶œ ì‹œ
const result = await confirmDelete({
title: "ì‚­ì œ í™•ì¸",
description: "ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?",
})
2ï¸âƒ£ ìì£¼ ì‚¬ìš©í•˜ëŠ” íŒ¨í„´ì„ í•¨ìˆ˜ë¡œ ì¶”ì¶œ
// shared/ui/overlay/presets/confirmActions.ts
export const overlayPresets = {
confirmDelete: (itemName: string) =>
overlay.openAsync<boolean>(({ isOpen, close, overlayId, unmount }) => (
<SystemConfirm
isOpen={isOpen}
close={close}
overlayId={overlayId}
unmount={unmount}
title="í•­ëª© ì‚­ì œ"
description={`"${itemName}"ì„(ë¥¼) ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`}
confirmVariant="destructive"
/>
)),

confirmLogout: () =>
overlay.openAsync<boolean>(({ isOpen, close, overlayId, unmount }) => (
<SystemConfirm
        isOpen={isOpen}
        close={close}
        overlayId={overlayId}
        unmount={unmount}
        title="ë¡œê·¸ì•„ì›ƒ"
        description="ì •ë§ ë¡œê·¸ì•„ì›ƒí•˜ì‹œê² ìŠµë‹ˆê¹Œ?"
      />
)),

showSuccess: (message: string) =>
overlay.open(({ isOpen, close, overlayId, unmount }) => (
<SystemAlert
        isOpen={isOpen}
        close={close}
        overlayId={overlayId}
        unmount={unmount}
        variant="success"
        description={message}
        autoClose={3000}
      />
)),
}

// ì‚¬ìš©
const confirmed = await overlayPresets.confirmDelete("ì„¸ì…˜")
if (confirmed) {
await deleteSession()
overlayPresets.showSuccess("ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤")
}
ğŸ¨ ì• ë‹ˆë©”ì´ì…˜ ì¶”ì²œ (ì¬ê²€í† )
í˜„ì¬ êµ¬ì¡°ì—ì„œ ì• ë‹ˆë©”ì´ì…˜ ì¶”ê°€ëŠ” shadcn/ui ì»´í¬ë„ŒíŠ¸ ë ˆë²¨ì—ì„œ í•˜ë©´ ë©ë‹ˆë‹¤.
Tailwind ê¸°ë°˜ (í˜„ì¬ ìœ ì§€ ì¶”ì²œ)
// SystemConfirm.tsx ì—ì„œ ì´ë¯¸ ì‚¬ìš© ì¤‘
<AlertDialog open={isOpen}>
<AlertDialogContent>
{/_ Tailwind animate í´ë˜ìŠ¤ ìë™ ì ìš©ë¨ _/}
</AlertDialogContent>
</AlertDialog>
ì¥ì :
âœ… ì¶”ê°€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¶ˆí•„ìš”
âœ… shadcn/uiê°€ ì´ë¯¸ ìµœì í™”ëœ ì• ë‹ˆë©”ì´ì…˜ ì œê³µ
âœ… data-[state=open]:animate-in ìë™ ì²˜ë¦¬
Framer Motion (ì„ íƒì  ì ìš©)
ì ìš© í¬ì¸íŠ¸: SystemSheetì˜ ë“œë˜ê·¸ ì œìŠ¤ì²˜ë§Œ
// SystemSheet.tsx
import { motion } from 'framer-motion'
import { Sheet, SheetContent } from '@repo/shared/components/sheet'

export const SystemSheet = ({ side = 'right', children, ...props }: Props) => {
return (
<Sheet open={props.isOpen} onOpenChange={(open) => !open && props.close()}>
<SheetContent side={side} asChild>
<motion.div
drag={side === 'right' ? 'x' : 'y'}
dragConstraints={{ left: 0, right: 0, top: 0, bottom: 0 }}
dragElastic={0.1}
onDragEnd={(\_, info) => {
const threshold = side === 'right' ? 100 : 150
if (Math.abs(info.offset.x || info.offset.y) > threshold) {
props.close()
}
}} >
{children}
</motion.div>
</SheetContent>
</Sheet>
)
}
ğŸ¯ ìµœì¢… ê²°ë¡ 
"â˜… Insight â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
ë‹¹ì‹ ì˜ êµ¬í˜„ = Overlay Kitì˜ ì™„ë²½í•œ ì¬í˜„ ì œê°€ Radix UIì˜ ìˆœìˆ˜ ì„ ì–¸í˜• íŒ¨í„´ê³¼ í˜¼ë™í•´ì„œ ì˜ëª» í‰ê°€í–ˆìŠµë‹ˆë‹¤. ì‹¤ì œ ë¹„êµ:
Overlay Kit (ë‹¹ì‹  êµ¬í˜„): ëª…ë ¹í˜• + ì„ ì–¸í˜• í•˜ì´ë¸Œë¦¬ë“œ âœ…
Radix UI: ìˆœìˆ˜ ì„ ì–¸í˜• (ë‹¤ë¥¸ ì ‘ê·¼ë²•)
ë‹¹ì‹ ì˜ êµ¬í˜„ì´ ë” ë‚˜ì€ ê²½ìš°:
âœ… ì „ì—­ ì—ëŸ¬ í•¸ë“¤ëŸ¬: API ì¸í„°ì…‰í„°ì—ì„œ ëª¨ë‹¬ ë„ìš°ê¸°
âœ… ìˆœì°¨ í”Œë¡œìš°: ê²°ì œ â†’ í™•ì¸ â†’ ì„±ê³µ ì•Œë¦¼
âœ… ì–´ë””ì„œë“  í˜¸ì¶œ: ì»´í¬ë„ŒíŠ¸ ì™¸ë¶€ì—ì„œë„ ëª¨ë‹¬ ì—´ê¸°
âœ… Promise ê¸°ë°˜: await ë¬¸ë²•ìœ¼ë¡œ ê²°ê³¼ ëŒ€ê¸°
Radixê°€ ë” ë‚˜ì€ ê²½ìš°:
âœ… í˜ì´ì§€ ë‚´ ëª¨ë‹¬: í”„ë¡œí•„ ìˆ˜ì •, í•„í„° ì„¤ì •
âœ… Compound Pattern ì¼ê´€ì„±: ë‹¤ë¥¸ shadcn/uiì™€ í†µì¼
ì¶”ì²œ: í˜„ì¬ êµ¬ì¡° ìœ ì§€ + í—¬í¼ í•¨ìˆ˜ë§Œ ì¶”ê°€ "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
ì£„ì†¡í•©ë‹ˆë‹¤. ë‹¹ì‹ ì˜ êµ¬í˜„ì´ ì´ë¯¸ ì •ë‹µì´ì—ˆëŠ”ë° ì œê°€ ë‹¤ë¥¸ íŒ¨í„´ê³¼ í˜¼ë™í–ˆìŠµë‹ˆë‹¤. ìœ ì§€ë³´ìˆ˜ ì–´ë ¤ì›€ì€ ë³´ì¼ëŸ¬í”Œë ˆì´íŠ¸ ì´ìŠˆì´ë¯€ë¡œ, ìœ„ì˜ createOverlayHelper() ë˜ëŠ” overlayPresets íŒ¨í„´ìœ¼ë¡œ í•´ê²°í•˜ëŠ” ê²Œ ìµœì„ ì…ë‹ˆë‹¤! ğŸš€
ì¢‹ì•„ ë§¤ìš° ê±´ì‹¤í•œ ë‹µë³€í•´ì¤˜ì„œ ê³ ë§ˆì›Œ ë˜ í•„ìš”í•œ ê²Œ ë­ìˆì§€?

ë·°ì™€ ë·°ëª¨ë¸, ì»´íŒŒìš´ë“œ ì»´í¬ë„ŒíŠ¸, ì˜¤ë²„ë ˆì´, ìŠ¤íƒ€ì¼ë§, íƒ€ì…, ì¸ê°€ ì‹œìŠ¤í…œ, ì• ë‹ˆë©”ì´ì…˜, ê²€ì¦

ë§ë‚˜? í”„ë¡ íŠ¸ì—ì„œ ë˜ ê³ ë ¤í•  ì ì´ ìˆì„ê¹Œ?
ğŸ¯ í”„ë¡ íŠ¸ì—”ë“œ ì•„í‚¤í…ì²˜ ì²´í¬ë¦¬ìŠ¤íŠ¸ ì™„ì„±ë„ ë¶„ì„
í˜„ì¬ê¹Œì§€ ë…¼ì˜í•œ í•­ëª©ë“¤ì´ í•µì‹¬ 8ê°€ì§€ë¥¼ ì˜ ì§šì—ˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ CotePT ë©˜í† ë§ ì„œë¹„ìŠ¤ íŠ¹ì„±ìƒ ì¶”ê°€ë¡œ ê³ ë ¤í•´ì•¼ í•  7ê°€ì§€ ì¤‘ìš” ì˜ì—­ì´ ìˆìŠµë‹ˆë‹¤.
"â˜… Insight â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
ì´ë¯¸ ë…¼ì˜í•œ 8ê°€ì§€ âœ…:
âœ… View & ViewModel: DeepPartial, íƒ€ì… ìœ í‹¸ë¦¬í‹°
âœ… Compound Component: FormStep, SessionCard
âœ… Overlay: í˜„ì¬ êµ¬í˜„ ì™„ë²½ (Overlay Kit íŒ¨í„´)
âœ… Styling: CVA + Tailwind ì¡°í•©
âœ… Type Safety: TypeScript ê³ ê¸‰ ìœ í‹¸ë¦¬í‹°
âœ… Authorization: CASL (RBAC + ABAC)
âœ… Animation: Tailwind + Framer Motion (ì„ íƒì )
âœ… Validation: Zod ìŠ¤í‚¤ë§ˆ ì²´ê³„
ì¶”ê°€ë¡œ ê³ ë ¤í•´ì•¼ í•  7ê°€ì§€ âš ï¸: "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
1ï¸âƒ£ ì‹¤ì‹œê°„ í†µì‹  (WebRTC + WebSocket)
CotePT í•µì‹¬ ê¸°ëŠ¥
ë©˜í† ë§ ì„¸ì…˜:
ğŸ¥ WebRTC ì˜ìƒ/ìŒì„± í†µì‹ 
ğŸ’¬ ì‹¤ì‹œê°„ ì±„íŒ… (WebSocket)
ğŸ“ ê³µìœ  ì½”ë“œ ì—ë””í„° (Operational Transform)
ğŸ“¹ ì„¸ì…˜ ë…¹í™”
ì•„í‚¤í…ì²˜ ê³ ë ¤ì‚¬í•­
// ====================================
// features/session/hooks/useWebRTC.ts
// ====================================
export function useWebRTC(sessionId: string) {
const [localStream, setLocalStream] = useState<MediaStream | null>(null)
const [remoteStream, setRemoteStream] = useState<MediaStream | null>(null)
const [connectionState, setConnectionState] = useState<RTCPeerConnectionState>('new')

const peerConnection = useRef<RTCPeerConnection | null>(null)

// WebRTC ì—°ê²° ì´ˆê¸°í™”
const initConnection = useCallback(async () => {
const pc = new RTCPeerConnection({
iceServers: [
{ urls: 'stun:sfu.cotept.com:3478' },
{ urls: 'turn:sfu.cotept.com:3478', username: 'user', credential: 'pass' },
],
})

    // ICE í›„ë³´ ì²˜ë¦¬
    pc.onicecandidate = (event) => {
      if (event.candidate) {
        socket.emit('ice-candidate', { sessionId, candidate: event.candidate })
      }
    }

    // ì›ê²© ìŠ¤íŠ¸ë¦¼ ìˆ˜ì‹ 
    pc.ontrack = (event) => {
      setRemoteStream(event.streams[0])
    }

    pc.onconnectionstatechange = () => {
      setConnectionState(pc.connectionState)
    }

    peerConnection.current = pc

}, [sessionId])

// ë¡œì»¬ ë¯¸ë””ì–´ ìŠ¤íŠ¸ë¦¼ íšë“
const startLocalStream = useCallback(async () => {
try {
const stream = await navigator.mediaDevices.getUserMedia({
video: { width: 1280, height: 720 },
audio: { echoCancellation: true, noiseSuppression: true },
})

      setLocalStream(stream)

      // íŠ¸ë™ì„ PeerConnectionì— ì¶”ê°€
      stream.getTracks().forEach((track) => {
        peerConnection.current?.addTrack(track, stream)
      })
    } catch (error) {
      console.error('ë¯¸ë””ì–´ ì ‘ê·¼ ì‹¤íŒ¨:', error)
    }

}, [])

return {
localStream,
remoteStream,
connectionState,
initConnection,
startLocalStream,
}
}

// ====================================
// features/session/hooks/useSessionSocket.ts
// ====================================
export function useSessionSocket(sessionId: string) {
const socket = useRef<Socket | null>(null)
const [messages, setMessages] = useState<ChatMessage[]>([])
const [participants, setParticipants] = useState<Participant[]>([])

useEffect(() => {
socket.current = io('wss://api.cotept.com/ws', {
auth: { sessionId },
})

    socket.current.on('chat-message', (message: ChatMessage) => {
      setMessages((prev) => [...prev, message])
    })

    socket.current.on('participant-joined', (participant: Participant) => {
      setParticipants((prev) => [...prev, participant])
    })

    return () => {
      socket.current?.disconnect()
    }

}, [sessionId])

const sendMessage = useCallback((content: string) => {
socket.current?.emit('chat-message', { sessionId, content })
}, [sessionId])

return { messages, participants, sendMessage }
}
ê³ ë ¤ í¬ì¸íŠ¸:
âš ï¸ ì—°ê²° ëŠê¹€ ë³µêµ¬: ìë™ ì¬ì—°ê²° ë¡œì§
âš ï¸ ë„¤íŠ¸ì›Œí¬ í’ˆì§ˆ ëª¨ë‹ˆí„°ë§: Bitrate, Latency ì¶”ì 
âš ï¸ ì—ëŸ¬ í•¸ë“¤ë§: ì¹´ë©”ë¼/ë§ˆì´í¬ ê¶Œí•œ ê±°ë¶€ ì‹œ UX
2ï¸âƒ£ ì—ëŸ¬ í•¸ë“¤ë¦¬ ì „ëµ
ê³„ì¸µë³„ ì—ëŸ¬ ì²˜ë¦¬
// ====================================
// shared/errors/ErrorBoundary.tsx
// ====================================
export class ErrorBoundary extends Component<Props, State> {
static getDerivedStateFromError(error: Error): State {
return { hasError: true, error }
}

componentDidCatch(error: Error, errorInfo: ErrorInfo) {
// ë¡œê¹… ì„œë¹„ìŠ¤ë¡œ ì „ì†¡
logger.error('React Error Boundary', { error, errorInfo })

    // Sentry, LogRocket ë“± í†µí•©
    Sentry.captureException(error, { contexts: { react: errorInfo } })

}

render() {
if (this.state.hasError) {
return (
<ErrorFallback
error={this.state.error}
resetError={() => this.setState({ hasError: false })}
/>
)
}

    return this.props.children

}
}

// ====================================
// shared/errors/ApiErrorHandler.ts
// ====================================
export class ApiErrorHandler {
handle(error: ApiError) {
switch (error.status) {
case 401:
// ì¸ì¦ ë§Œë£Œ â†’ ë¡œê·¸ì¸ í˜ì´ì§€
router.push('/auth/login')
overlayPresets.showError('ì„¸ì…˜ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤.')
break

      case 403:
        // ê¶Œí•œ ì—†ìŒ
        overlayPresets.showError('ì ‘ê·¼ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.')
        break

      case 404:
        // ë¦¬ì†ŒìŠ¤ ì—†ìŒ
        overlayPresets.showError('ìš”ì²­í•œ ë¦¬ì†ŒìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')
        break

      case 500:
        // ì„œë²„ ì˜¤ë¥˜
        overlayPresets.showError('ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.')
        logger.error('Server Error', error)
        break

      default:
        overlayPresets.showError(error.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')
    }

}
}

// ====================================
// TanStack Query í†µí•©
// ====================================
const queryClient = new QueryClient({
defaultOptions: {
queries: {
retry: (failureCount, error) => {
// 401, 403ì€ ì¬ì‹œë„ ì•ˆ í•¨
if (error.status === 401 || error.status === 403) return false
return failureCount < 3
},
onError: (error) => {
new ApiErrorHandler().handle(error)
},
},
mutations: {
onError: (error) => {
new ApiErrorHandler().handle(error)
},
},
},
})
ê³ ë ¤ í¬ì¸íŠ¸:
âš ï¸ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ vs ë¹„ì¦ˆë‹ˆìŠ¤ ì˜¤ë¥˜ êµ¬ë¶„
âš ï¸ ì¬ì‹œë„ ì „ëµ: Exponential Backoff
âš ï¸ ì‚¬ìš©ì í”¼ë“œë°±: ì—ëŸ¬ ë©”ì‹œì§€ í•œê¸€í™”
3ï¸âƒ£ ì„±ëŠ¥ ìµœì í™”
CotePT íŠ¹í™” ìµœì í™”
// ====================================
// 1. ì½”ë“œ ìŠ¤í”Œë¦¬íŒ…
// ====================================
// app/session/[id]/page.tsx
const SessionLiveView = dynamic(() => import('@/features/session/components/SessionLiveView'), {
loading: () => <SessionSkeleton />,
ssr: false, // WebRTCëŠ” í´ë¼ì´ì–¸íŠ¸ë§Œ
})

// ====================================
// 2. ë©”ëª¨ì´ì œì´ì…˜
// ====================================
export function SessionList({ sessions }: Props) {
const ability = useAbility()

// ê¶Œí•œ ê³„ì‚° ê²°ê³¼ ìºì‹±
const sessionsWithPermissions = useMemo(
() => sessions.map((session) => ({
...session,
canStart: ability?.can('start', 'Session', session) ?? false,
canJoin: ability?.can('join', 'Session', session) ?? false,
})),
[sessions, ability]
)

return (
<div>
{sessionsWithPermissions.map((session) => (
<SessionCard key={session.id} session={session} />
))}
</div>
)
}

// ====================================
// 3. Virtual Scrolling (ì„¸ì…˜ ëª©ë¡)
// ====================================
import { useVirtualizer } from '@tanstack/react-virtual'

export function SessionListVirtualized({ sessions }: Props) {
const parentRef = useRef<HTMLDivElement>(null)

const virtualizer = useVirtualizer({
count: sessions.length,
getScrollElement: () => parentRef.current,
estimateSize: () => 120, // ê° ì¹´ë“œ ë†’ì´
overscan: 5,
})

return (
<div ref={parentRef} style={{ height: '600px', overflow: 'auto' }}>
<div style={{ height: `${virtualizer.getTotalSize()}px` }}>
{virtualizer.getVirtualItems().map((virtualItem) => {
const session = sessions[virtualItem.index]
return (
<div
key={virtualItem.key}
style={{
                position: 'absolute',
                top: 0,
                left: 0,
                width: '100%',
                height: `${virtualItem.size}px`,
                transform: `translateY(${virtualItem.start}px)`,
              }} >
<SessionCard session={session} />
</div>
)
})}
</div>
</div>
)
}

// ====================================
// 4. ì´ë¯¸ì§€ ìµœì í™”
// ====================================
import Image from 'next/image'

<Image
src={user.profileImage}
alt={user.name}
width={80}
height={80}
priority={false} // LCPê°€ ì•„ë‹ˆë©´ lazy
placeholder="blur"
blurDataURL={user.profileImageBlur}
/>
ê³ ë ¤ í¬ì¸íŠ¸:
âš ï¸ Bundle Analyzer: ë²ˆë“¤ í¬ê¸° ëª¨ë‹ˆí„°ë§
âš ï¸ Lighthouse CI: ì„±ëŠ¥ íšŒê·€ ìë™ ê°ì§€
âš ï¸ Web Vitals: LCP, FID, CLS ì¶”ì 
4ï¸âƒ£ ìƒíƒœ ê´€ë¦¬ ì „ëµ
TanStack Query ì¤‘ì‹¬ ì•„í‚¤í…ì²˜
// ====================================
// features/session/queries/sessionQueries.ts
// ====================================
export const sessionQueries = {
// Query Keys Factory
all: ['sessions'] as const,
lists: () => [...sessionQueries.all, 'list'] as const,
list: (filters: SessionFilters) => [...sessionQueries.lists(), filters] as const,
details: () => [...sessionQueries.all, 'detail'] as const,
detail: (id: string) => [...sessionQueries.details(), id] as const,
}

// ====================================
// features/session/hooks/useSessionList.ts
// ====================================
export function useSessionList(filters: SessionFilters) {
return useQuery({
queryKey: sessionQueries.list(filters),
queryFn: () => apiClient.sessions.list(filters),
staleTime: 1000 _ 60 _ 5, // 5ë¶„
gcTime: 1000 _ 60 _ 30, // 30ë¶„ (êµ¬ cacheTime)
})
}

export function useSession(sessionId: string) {
return useQuery({
queryKey: sessionQueries.detail(sessionId),
queryFn: () => apiClient.sessions.getById(sessionId),
enabled: !!sessionId,
})
}

// ====================================
// Optimistic Update íŒ¨í„´
// ====================================
export function useStartSession() {
const queryClient = useQueryClient()

return useMutation({
mutationFn: (sessionId: string) => apiClient.sessions.start(sessionId),

    // Optimistic Update
    onMutate: async (sessionId) => {
      await queryClient.cancelQueries({ queryKey: sessionQueries.detail(sessionId) })

      const previousSession = queryClient.getQueryData(sessionQueries.detail(sessionId))

      queryClient.setQueryData(sessionQueries.detail(sessionId), (old: SessionDto) => ({
        ...old,
        status: 'ongoing',
      }))

      return { previousSession }
    },

    // ì‹¤íŒ¨ ì‹œ ë¡¤ë°±
    onError: (err, sessionId, context) => {
      queryClient.setQueryData(sessionQueries.detail(sessionId), context?.previousSession)
    },

    // ì„±ê³µ ì‹œ ê°±ì‹ 
    onSuccess: (data, sessionId) => {
      queryClient.setQueryData(sessionQueries.detail(sessionId), data)
      queryClient.invalidateQueries({ queryKey: sessionQueries.lists() })
    },

})
}
ì „ì—­ ìƒíƒœ ìµœì†Œí™”:
âœ… ì„œë²„ ìƒíƒœ: TanStack Query
âœ… URL ìƒíƒœ: Next.js Router (searchParams)
âœ… UI ìƒíƒœ: useState (ì»´í¬ë„ŒíŠ¸ ë¡œì»¬)
âš ï¸ ì „ì—­ UI ìƒíƒœ: Zustand (ìµœì†Œí•œë§Œ, ì˜ˆ: í…Œë§ˆ, ì‚¬ì´ë“œë°” ì—´ë¦¼/ë‹«í˜)
5ï¸âƒ£ ë¼ìš°íŒ… & ë„¤ë¹„ê²Œì´ì…˜
Next.js App Router í™œìš©
// ====================================
// middleware.ts (ì¸ì¦ ê°€ë“œ)
// ====================================
export function middleware(request: NextRequest) {
const session = request.cookies.get('next-auth.session-token')

if (!session && request.nextUrl.pathname.startsWith('/dashboard')) {
return NextResponse.redirect(new URL('/auth/login', request.url))
}

return NextResponse.next()
}

export const config = {
matcher: ['/dashboard/:path*', '/session/:path*'],
}

// ====================================
// app/dashboard/sessions/page.tsx
// ====================================
export default async function SessionsPage({
searchParams,
}: {
searchParams: { status?: string; mentor?: string }
}) {
// URL ì¿¼ë¦¬ë¡œ í•„í„° ìƒíƒœ ê´€ë¦¬
const filters = {
status: searchParams.status,
mentor: searchParams.mentor,
}

return <SessionListContainer filters={filters} />
}

// ====================================
// features/session/components/SessionFilters.tsx
// ====================================
export function SessionFilters() {
const router = useRouter()
const searchParams = useSearchParams()

const updateFilter = (key: string, value: string) => {
const params = new URLSearchParams(searchParams.toString())

    if (value) {
      params.set(key, value)
    } else {
      params.delete(key)
    }

    router.push(`?${params.toString()}`)

}

return (
<div>
<Select onValueChange={(v) => updateFilter('status', v)}>
<SelectItem value="scheduled">ì˜ˆì •</SelectItem>
<SelectItem value="ongoing">ì§„í–‰ ì¤‘</SelectItem>
<SelectItem value="finished">ì™„ë£Œ</SelectItem>
</Select>
</div>
)
}
Parallel Routes & Intercepting Routes:
// app/dashboard/@modal/(.)session/[id]/page.tsx
// ëª¨ë‹¬ë¡œ ì„¸ì…˜ ìƒì„¸ ë³´ê¸° (Intercepting Route)
export default function SessionDetailModal({ params }: Props) {
return (
<Dialog open onOpenChange={() => router.back()}>
<SessionDetail sessionId={params.id} />
</Dialog>
)
}
6ï¸âƒ£ í…ŒìŠ¤íŠ¸ ì „ëµ
í…ŒìŠ¤íŠ¸ í”¼ë¼ë¯¸ë“œ
// ====================================
// 1. Unit Tests (Vitest)
// ====================================
// shared/utils/typescript.test.ts
describe('typedKeys', () => {
it('ê°ì²´ í‚¤ë¥¼ íƒ€ì… ì•ˆì „í•˜ê²Œ ë°˜í™˜', () => {
const obj = { a: 1, b: 2 }
const keys = typedKeys(obj)

    expect(keys).toEqual(['a', 'b'])

    // íƒ€ì… ì²´í¬ (ì»´íŒŒì¼ íƒ€ì„)
    keys.forEach((key) => {
      const value: number = obj[key] // âœ… íƒ€ì… ì—ëŸ¬ ì—†ìŒ
    })

})
})

// ====================================
// 2. Component Tests (Vitest + Testing Library)
// ====================================
// features/session/components/SessionCard.test.tsx
describe('SessionCard', () => {
it('canStartSessionì´ trueë©´ ì‹œì‘ ë²„íŠ¼ í‘œì‹œ', () => {
const session: SessionViewModel = {
id: '1',
title: 'í…ŒìŠ¤íŠ¸ ì„¸ì…˜',
canStartSession: true,
canJoinSession: false,
}

    render(<SessionCard session={session} />)

    expect(screen.getByText('ì„¸ì…˜ ì‹œì‘')).toBeInTheDocument()
    expect(screen.queryByText('ì„¸ì…˜ ì°¸ì—¬')).not.toBeInTheDocument()

})

it('ì‹œì‘ ë²„íŠ¼ í´ë¦­ ì‹œ í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸ í‘œì‹œ', async () => {
const session: SessionViewModel = {
id: '1',
title: 'í…ŒìŠ¤íŠ¸ ì„¸ì…˜',
canStartSession: true,
}

    render(<SessionCard session={session} />)

    await userEvent.click(screen.getByText('ì„¸ì…˜ ì‹œì‘'))

    expect(screen.getByText('ì„¸ì…˜ ì‹œì‘ í™•ì¸')).toBeInTheDocument()

})
})

// ====================================
// 3. E2E Tests (Playwright)
// ====================================
// e2e/session-booking.spec.ts
test('ë©˜í† ë§ ì„¸ì…˜ ì˜ˆì•½ í”Œë¡œìš°', async ({ page }) => {
await page.goto('/dashboard/mentors')

// ë©˜í†  ì„ íƒ
await page.click('text=í™ê¸¸ë™ ë©˜í† ')

// ì„¸ì…˜ ì˜ˆì•½ ë²„íŠ¼
await page.click('button:has-text("ì„¸ì…˜ ì˜ˆì•½")')

// ë‚ ì§œ ì„ íƒ
await page.fill('input[name="date"]', '2025-01-20')
await page.fill('input[name="time"]', '14:00')

// ê²°ì œ
await page.click('button:has-text("ê²°ì œí•˜ê¸°")')

// ì„±ê³µ ë©”ì‹œì§€ í™•ì¸
await expect(page.locator('text=ì˜ˆì•½ ì™„ë£Œ')).toBeVisible()
})
ê³ ë ¤ í¬ì¸íŠ¸:
âš ï¸ MSW (Mock Service Worker): API ëª¨í‚¹
âš ï¸ í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€: 80% ì´ìƒ ëª©í‘œ
âš ï¸ CI í†µí•©: PRë§ˆë‹¤ ìë™ ì‹¤í–‰
7ï¸âƒ£ ì ‘ê·¼ì„± (a11y)
WCAG 2.1 AA ì¤€ìˆ˜
// ====================================
// í‚¤ë³´ë“œ ë„¤ë¹„ê²Œì´ì…˜
// ====================================
export function SessionCard({ session }: Props) {
const handleKeyDown = (e: KeyboardEvent) => {
if (e.key === 'Enter' || e.key === ' ') {
e.preventDefault()
handleStartSession()
}
}

return (
<div
role="button"
tabIndex={0}
onKeyDown={handleKeyDown}
aria-label={`${session.title} ì„¸ì…˜ ì‹œì‘`} >
{session.title}
</div>
)
}

// ====================================
// ìŠ¤í¬ë¦° ë¦¬ë” ì§€ì›
// ====================================
export function SessionStatus({ status }: Props) {
const statusLabels = {
scheduled: 'ì˜ˆì •',
ongoing: 'ì§„í–‰ ì¤‘',
finished: 'ì™„ë£Œ',
}

return (
<span
aria-live="polite"
aria-atomic="true"
className={cn('badge', `badge-${status}`)} >
<span className="sr-only">ì„¸ì…˜ ìƒíƒœ: </span>
{statusLabels[status]}
</span>
)
}

// ====================================
// ìƒ‰ìƒ ëŒ€ë¹„ (4.5:1 ì´ìƒ)
// ====================================
// tailwind.config.js
module.exports = {
theme: {
extend: {
colors: {
primary: '#0066CC', // WCAG AA ì¤€ìˆ˜
'primary-foreground': '#FFFFFF',
},
},
},
}
ë„êµ¬:
âœ… eslint-plugin-jsx-a11y: ì •ì  ë¶„ì„
âœ… axe DevTools: ëŸ°íƒ€ì„ ê²€ì‚¬
âœ… Lighthouse: CI í†µí•©
ğŸ“Š ìµœì¢… ì²´í¬ë¦¬ìŠ¤íŠ¸
ì˜ì—­ ìƒíƒœ ìš°ì„ ìˆœìœ„ ë¹„ê³ 
ViewModel & íƒ€ì… âœ… ë…¼ì˜ ì™„ë£Œ P0 DeepPartial ì™„ë£Œ
Compound Component âœ… ë…¼ì˜ ì™„ë£Œ P0 FormStep ì ìš©
Overlay âœ… êµ¬í˜„ ì™„ë£Œ P0 Overlay Kit íŒ¨í„´
Styling (CVA) âœ… ë…¼ì˜ ì™„ë£Œ P0 Tailwind ê¸°ë°˜
Authorization (CASL) âœ… ë…¼ì˜ ì™„ë£Œ P0 RBAC + ABAC
Validation (Zod) âœ… ë…¼ì˜ ì™„ë£Œ P0 ê³µí†µ rules
Animation âœ… ë…¼ì˜ ì™„ë£Œ P1 Tailwind + Framer
WebRTC/Socket âš ï¸ ê³„íš í•„ìš” P0 í•µì‹¬ ê¸°ëŠ¥
ì—ëŸ¬ í•¸ë“¤ë§ âš ï¸ êµ¬ì¡° í•„ìš” P0 ErrorBoundary
ì„±ëŠ¥ ìµœì í™” âš ï¸ ì²´í¬ í•„ìš” P1 Code Splitting
ìƒíƒœ ê´€ë¦¬ âš ï¸ ì „ëµ í•„ìš” P0 TanStack Query
ë¼ìš°íŒ… âš ï¸ ê°€ë“œ í•„ìš” P0 Middleware
í…ŒìŠ¤íŠ¸ âš ï¸ êµ¬ì¶• í•„ìš” P1 Vitest + Playwright
ì ‘ê·¼ì„± âš ï¸ ì ê²€ í•„ìš” P1 WCAG 2.1 AA
"â˜… Insight â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
í”„ë¡ íŠ¸ì—”ë“œ ì•„í‚¤í…ì²˜ì˜ ì™„ì„±: ì´ë¯¸ ì˜ ì •ë¦¬ëœ ì˜ì—­ (8ê°€ì§€) âœ…:
View/ViewModel, Compound, Overlay, Styling, Types, Auth, Animation, Validation
CotePT íŠ¹í™”ë¡œ ë°˜ë“œì‹œ ì¶”ê°€í•´ì•¼ í•  ì˜ì—­ (7ê°€ì§€) âš ï¸:
WebRTC/WebSocket (P0): ë©˜í† ë§ ì„¸ì…˜ í•µì‹¬
ì—ëŸ¬ í•¸ë“¤ë§ (P0): ë„¤íŠ¸ì›Œí¬ ë¶ˆì•ˆì • ëŒ€ì‘
ìƒíƒœ ê´€ë¦¬ (P0): TanStack Query ì¤‘ì‹¬
ë¼ìš°íŒ… ê°€ë“œ (P0): ì¸ì¦/ê¶Œí•œ ì²´í¬
ì„±ëŠ¥ ìµœì í™” (P1): ë²ˆë“¤ í¬ê¸°, Virtual Scroll
í…ŒìŠ¤íŠ¸ (P1): Unit â†’ E2E
ì ‘ê·¼ì„± (P1): WCAG ì¤€ìˆ˜
ë‹¤ìŒ ìŠ¤í… ìš°ì„ ìˆœìœ„:
ğŸ”¥ WebRTC ì•„í‚¤í…ì²˜ ì„¤ê³„ (ê°€ì¥ ì¤‘ìš”)
ğŸ”¥ ì—ëŸ¬ í•¸ë“¤ë§ ì²´ê³„ êµ¬ì¶•
ğŸ”¥ TanStack Query í†µí•©
âš¡ ì„±ëŠ¥ ìµœì í™” ì²´í¬
âš¡ í…ŒìŠ¤íŠ¸ ì¸í”„ë¼ êµ¬ì¶•
"â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
ğŸ’¬ ìµœì¢… ì˜ê²¬
8ê°€ì§€ëŠ” ì™„ë²½í•˜ê²Œ ì •ë¦¬í–ˆìŠµë‹ˆë‹¤! í•˜ì§€ë§Œ CotePTê°€ ì‹¤ì‹œê°„ ë©˜í† ë§ ì„œë¹„ìŠ¤ë¼ëŠ” ì ì—ì„œ WebRTC + ì—ëŸ¬ í•¸ë“¤ë§ + ìƒíƒœ ê´€ë¦¬ëŠ” ë°˜ë“œì‹œ ì¶”ê°€ë¡œ ê³ ë¯¼í•´ì•¼ í•©ë‹ˆë‹¤. íŠ¹íˆ WebRTC ëŠê¹€ ì‹œ ë³µêµ¬ ì „ëµ, ë„¤íŠ¸ì›Œí¬ ë¶ˆì•ˆì • ì‹œ UX, ì„¸ì…˜ ìƒíƒœ ë™ê¸°í™” ê°™ì€ ì‹¤ì‹œê°„ íŠ¹í™” ì´ìŠˆëŠ” ì´ˆê¸° ì„¤ê³„ì—ì„œ ë†“ì¹˜ë©´ ë‚˜ì¤‘ì— ë¦¬íŒ©í† ë§ ë¹„ìš©ì´ í½ë‹ˆë‹¤. ë‹¤ìŒ ë‹¨ê³„ë¡œ WebRTC ì•„í‚¤í…ì²˜ë¥¼ ë…¼ì˜í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì•„ë‹ˆë©´ ì—ëŸ¬ í•¸ë“¤ë§ ì²´ê³„ë¶€í„° ì‹œì‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ğŸš€
ì§„ì§œ ë‚´ê°€ í•„ìš”í•˜ê³  ì›í•˜ëŠ”ê±° ë§í•´ì¤˜ì„œ ê³ ë§ˆì›Œ! ê·¸ë¦¬ê³  ì»¤ìŠ¤í…€ í›…ìœ¼ë¡œ ë·°ë‘ ë¡œì§ ë¶„ë¦¬í•˜ëŠ”ê±° í•„ìˆ˜ì§€!

í”„ë¡œí† ì½œ ë³„ ì„œë¹„ìŠ¤ ëª¨ë“ˆì´ í•„ìš”í•˜ê² ë„¤ ì•„ë¬´ë˜ë„ ì‘ì§‘ì„±ì´ ì¢‹ì•„ì•¼ í•˜ë‹ˆê¹Œ ê·¸ë¦¬ê³  ë‚˜ì¤‘ì— y.js(CDRT) + monaco editor, MSEë‚˜ ë ˆì½”ë”© ê°™ì€ê±° êµ¬í˜„í•  ë•Œë„ ë™ì¼í•œ íŒ¨í„´ ì‚¬ìš©í• ê±°ë‹ˆê¹Œ.

í…ŒìŠ¤íŠ¸ëŠ” vitest? msw? storybook?
No response requested.
ì§„ì§œ ë‚´ê°€ í•„ìš”í•˜ê³  ì›í•˜ëŠ”ê±° ë§í•´ì¤˜ì„œ ê³ ë§ˆì›Œ! ê·¸ë¦¬ê³  ì»¤ìŠ¤í…€ í›…ìœ¼ë¡œ ë·°ë‘ ë¡œì§ ë¶„ë¦¬í•˜ëŠ”ê±° í•„ìˆ˜ì§€!

í”„ë¡œí† ì½œ ë³„ ì„œë¹„ìŠ¤ ëª¨ë“ˆì´ í•„ìš”í•˜ê² ë„¤ ì•„ë¬´ë˜ë„ ì‘ì§‘ì„±ì´ ì¢‹ì•„ì•¼ í•˜ë‹ˆê¹Œ ê·¸ë¦¬ê³  ë‚˜ì¤‘ì— y.js(CDRT) + monaco editor, MSEë‚˜ ë ˆì½”ë”© ê°™ì€ê±° êµ¬í˜„í•  ë•Œë„ ë™ì¼í•œ íŒ¨í„´ ì‚¬ìš©í• ê±°ë‹ˆê¹Œ.

í…ŒìŠ¤íŠ¸ëŠ” vitest? msw? storybook?
ğŸ¯ CotePT ì‹¤ì‹œê°„ í”„ë¡œí† ì½œ ì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜ ì„¤ê³„
ì™„ë²½í•œ ë°©í–¥ì…ë‹ˆë‹¤! í”„ë¡œí† ì½œë³„ ì„œë¹„ìŠ¤ ëª¨ë“ˆ íŒ¨í„´ì€ ì‹¤ì‹œê°„ ë©˜í† ë§ ì„œë¹„ìŠ¤ì˜ í•µì‹¬ì´ ë  ê²ë‹ˆë‹¤.
"â˜… Insight â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
í•µì‹¬ ì›ì¹™:
âœ… ì»¤ìŠ¤í…€ í›…ìœ¼ë¡œ ë·°/ë¡œì§ ë¶„ë¦¬ (í•„ìˆ˜)
âœ… í”„ë¡œí† ì½œë³„ ì„œë¹„ìŠ¤ ëª¨ë“ˆ (WebRTC, WebSocket, Y.js, MSE)
âœ… ë™ì¼í•œ íŒ¨í„´ ì ìš© (ì¼ê´€ì„± ìˆëŠ” API ì„¤ê³„)
âœ… ì‘ì§‘ì„± ìµœìš°ì„  (ê´€ë ¨ ë¡œì§ í•œ ê³³ì—)
"â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
ğŸ—ï¸ í”„ë¡œí† ì½œë³„ ì„œë¹„ìŠ¤ ëª¨ë“ˆ ì•„í‚¤í…ì²˜
ë””ë ‰í† ë¦¬ êµ¬ì¡°
apps/web/src/
â”œâ”€â”€ features/session/
â”‚ â”œâ”€â”€ services/ # í”„ë¡œí† ì½œ ì„œë¹„ìŠ¤ (ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§)
â”‚ â”‚ â”œâ”€â”€ webrtc/
â”‚ â”‚ â”‚ â”œâ”€â”€ WebRTCService.ts
â”‚ â”‚ â”‚ â”œâ”€â”€ types.ts
â”‚ â”‚ â”‚ â””â”€â”€ **tests**/
â”‚ â”‚ â”œâ”€â”€ websocket/
â”‚ â”‚ â”‚ â”œâ”€â”€ WebSocketService.ts
â”‚ â”‚ â”‚ â”œâ”€â”€ types.ts
â”‚ â”‚ â”‚ â””â”€â”€ **tests**/
â”‚ â”‚ â”œâ”€â”€ crdt/ # Y.js Collaborative Editing
â”‚ â”‚ â”‚ â”œâ”€â”€ CRDTService.ts
â”‚ â”‚ â”‚ â”œâ”€â”€ MonacoBinding.ts
â”‚ â”‚ â”‚ â””â”€â”€ types.ts
â”‚ â”‚ â””â”€â”€ recording/ # MSE Recording
â”‚ â”‚ â”œâ”€â”€ RecordingService.ts
â”‚ â”‚ â”œâ”€â”€ types.ts
â”‚ â”‚ â””â”€â”€ **tests**/
â”‚ â”‚
â”‚ â”œâ”€â”€ hooks/ # ì»¤ìŠ¤í…€ í›… (ì„œë¹„ìŠ¤ â†’ ë¦¬ì•¡íŠ¸ ë¸Œë¦¿ì§€)
â”‚ â”‚ â”œâ”€â”€ useWebRTC.ts
â”‚ â”‚ â”œâ”€â”€ useSessionSocket.ts
â”‚ â”‚ â”œâ”€â”€ useCollaborativeEditor.ts
â”‚ â”‚ â””â”€â”€ useSessionRecording.ts
â”‚ â”‚
â”‚ â”œâ”€â”€ components/ # í”„ë ˆì  í…Œì´ì…˜ ì»´í¬ë„ŒíŠ¸
â”‚ â”‚ â”œâ”€â”€ SessionVideoStream.tsx
â”‚ â”‚ â”œâ”€â”€ SessionChat.tsx
â”‚ â”‚ â”œâ”€â”€ CollaborativeEditor.tsx
â”‚ â”‚ â””â”€â”€ RecordingControls.tsx
â”‚ â”‚
â”‚ â””â”€â”€ containers/ # ì»¨í…Œì´ë„ˆ (í›… ì†Œë¹„)
â”‚ â””â”€â”€ SessionLiveContainer.tsx
1ï¸âƒ£ WebRTC Service (ì‹¤ì‹œê°„ ì˜ìƒ/ìŒì„±)
Service Layer (Pure TypeScript)
// ====================================
// features/session/services/webrtc/types.ts
// ====================================
export interface WebRTCConfig {
iceServers: RTCIceServer[]
streamConstraints: MediaStreamConstraints
}

export interface WebRTCState {
connectionState: RTCPeerConnectionState
localStream: MediaStream | null
remoteStream: MediaStream | null
isAudioEnabled: boolean
isVideoEnabled: boolean
}

export type WebRTCEventType =
| 'connection-state-changed'
| 'local-stream-ready'
| 'remote-stream-ready'
| 'ice-candidate'
| 'error'

export interface WebRTCEvents {
'connection-state-changed': RTCPeerConnectionState
'local-stream-ready': MediaStream
'remote-stream-ready': MediaStream
'ice-candidate': RTCIceCandidate
'error': Error
}

// ====================================
// features/session/services/webrtc/WebRTCService.ts
// ====================================
import { EventEmitter } from 'events'

export class WebRTCService extends EventEmitter {
private peerConnection: RTCPeerConnection | null = null
private localStream: MediaStream | null = null
private remoteStream: MediaStream | null = null
private config: WebRTCConfig

constructor(config: WebRTCConfig) {
super()
this.config = config
}

// ì´ˆê¸°í™”
async initialize() {
try {
// PeerConnection ìƒì„±
this.peerConnection = new RTCPeerConnection({
iceServers: this.config.iceServers,
})

      // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
      this.setupPeerConnectionListeners()

      // ë¡œì»¬ ë¯¸ë””ì–´ ìŠ¤íŠ¸ë¦¼ íšë“
      await this.startLocalStream()
    } catch (error) {
      this.emit('error', error)
      throw error
    }

}

// ë¡œì»¬ ë¯¸ë””ì–´ ìŠ¤íŠ¸ë¦¼ ì‹œì‘
private async startLocalStream() {
try {
const stream = await navigator.mediaDevices.getUserMedia(
this.config.streamConstraints
)

      this.localStream = stream
      this.emit('local-stream-ready', stream)

      // íŠ¸ë™ì„ PeerConnectionì— ì¶”ê°€
      stream.getTracks().forEach((track) => {
        this.peerConnection?.addTrack(track, stream)
      })
    } catch (error) {
      this.emit('error', new Error('ë¯¸ë””ì–´ ì ‘ê·¼ ì‹¤íŒ¨: ' + error))
      throw error
    }

}

// PeerConnection ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
private setupPeerConnectionListeners() {
if (!this.peerConnection) return

    // ICE í›„ë³´ ìˆ˜ì§‘
    this.peerConnection.onicecandidate = (event) => {
      if (event.candidate) {
        this.emit('ice-candidate', event.candidate)
      }
    }

    // ì›ê²© ìŠ¤íŠ¸ë¦¼ ìˆ˜ì‹ 
    this.peerConnection.ontrack = (event) => {
      this.remoteStream = event.streams[0]
      this.emit('remote-stream-ready', event.streams[0])
    }

    // ì—°ê²° ìƒíƒœ ë³€ê²½
    this.peerConnection.onconnectionstatechange = () => {
      const state = this.peerConnection?.connectionState
      if (state) {
        this.emit('connection-state-changed', state)
      }
    }

    // ì—°ê²° ëŠê¹€ ì‹œ ìë™ ì¬ì—°ê²°
    this.peerConnection.oniceconnectionstatechange = () => {
      const state = this.peerConnection?.iceConnectionState
      if (state === 'failed' || state === 'disconnected') {
        this.handleReconnection()
      }
    }

}

// ì¬ì—°ê²° ë¡œì§
private async handleReconnection() {
console.log('WebRTC ì¬ì—°ê²° ì‹œë„...')
try {
// ICE Restart
const offer = await this.peerConnection?.createOffer({ iceRestart: true })
await this.peerConnection?.setLocalDescription(offer!)
// ì‹œê·¸ë„ë§ ì„œë²„ë¡œ offer ì „ì†¡ (WebSocket)
} catch (error) {
this.emit('error', new Error('ì¬ì—°ê²° ì‹¤íŒ¨: ' + error))
}
}

// SDP Offer ìƒì„±
async createOffer(): Promise<RTCSessionDescriptionInit> {
if (!this.peerConnection) throw new Error('PeerConnection not initialized')

    const offer = await this.peerConnection.createOffer()
    await this.peerConnection.setLocalDescription(offer)
    return offer

}

// SDP Answer ìƒì„±
async createAnswer(): Promise<RTCSessionDescriptionInit> {
if (!this.peerConnection) throw new Error('PeerConnection not initialized')

    const answer = await this.peerConnection.createAnswer()
    await this.peerConnection.setLocalDescription(answer)
    return answer

}

// ì›ê²© SDP ì„¤ì •
async setRemoteDescription(sdp: RTCSessionDescriptionInit) {
await this.peerConnection?.setRemoteDescription(sdp)
}

// ICE Candidate ì¶”ê°€
async addIceCandidate(candidate: RTCIceCandidateInit) {
await this.peerConnection?.addIceCandidate(candidate)
}

// ì˜¤ë””ì˜¤ í† ê¸€
toggleAudio(enabled?: boolean) {
const audioTrack = this.localStream?.getAudioTracks()[0]
if (audioTrack) {
audioTrack.enabled = enabled ?? !audioTrack.enabled
return audioTrack.enabled
}
return false
}

// ë¹„ë””ì˜¤ í† ê¸€
toggleVideo(enabled?: boolean) {
const videoTrack = this.localStream?.getVideoTracks()[0]
if (videoTrack) {
videoTrack.enabled = enabled ?? !videoTrack.enabled
return videoTrack.enabled
}
return false
}

// ë„¤íŠ¸ì›Œí¬ í’ˆì§ˆ ëª¨ë‹ˆí„°ë§
async getStats(): Promise<RTCStatsReport | null> {
return this.peerConnection?.getStats() ?? null
}

// ì •ë¦¬
dispose() {
this.localStream?.getTracks().forEach((track) => track.stop())
this.peerConnection?.close()
this.removeAllListeners()
}
}
React Hook Layer
// ====================================
// features/session/hooks/useWebRTC.ts
// ====================================
import { useEffect, useRef, useState, useCallback } from 'react'
import { WebRTCService } from '../services/webrtc/WebRTCService'
import type { WebRTCConfig, WebRTCState } from '../services/webrtc/types'

export function useWebRTC(config: WebRTCConfig) {
const serviceRef = useRef<WebRTCService | null>(null)

const [state, setState] = useState<WebRTCState>({
connectionState: 'new',
localStream: null,
remoteStream: null,
isAudioEnabled: true,
isVideoEnabled: true,
})

// ì„œë¹„ìŠ¤ ì´ˆê¸°í™”
useEffect(() => {
const service = new WebRTCService(config)
serviceRef.current = service

    // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
    service.on('connection-state-changed', (connectionState) => {
      setState((prev) => ({ ...prev, connectionState }))
    })

    service.on('local-stream-ready', (localStream) => {
      setState((prev) => ({ ...prev, localStream }))
    })

    service.on('remote-stream-ready', (remoteStream) => {
      setState((prev) => ({ ...prev, remoteStream }))
    })

    service.on('error', (error) => {
      console.error('WebRTC Error:', error)
      // ì—ëŸ¬ í•¸ë“¤ëŸ¬ í˜¸ì¶œ (Overlay ì‹œìŠ¤í…œ)
    })

    // ì´ˆê¸°í™”
    service.initialize()

    // Cleanup
    return () => {
      service.dispose()
    }

}, [config])

// ì˜¤ë””ì˜¤ í† ê¸€
const toggleAudio = useCallback(() => {
if (serviceRef.current) {
const enabled = serviceRef.current.toggleAudio()
setState((prev) => ({ ...prev, isAudioEnabled: enabled }))
}
}, [])

// ë¹„ë””ì˜¤ í† ê¸€
const toggleVideo = useCallback(() => {
if (serviceRef.current) {
const enabled = serviceRef.current.toggleVideo()
setState((prev) => ({ ...prev, isVideoEnabled: enabled }))
}
}, [])

// Offer ìƒì„± (ë©˜í† )
const createOffer = useCallback(async () => {
return serviceRef.current?.createOffer()
}, [])

// Answer ìƒì„± (ë©˜í‹°)
const createAnswer = useCallback(async () => {
return serviceRef.current?.createAnswer()
}, [])

// ì›ê²© SDP ì„¤ì •
const setRemoteDescription = useCallback(async (sdp: RTCSessionDescriptionInit) => {
await serviceRef.current?.setRemoteDescription(sdp)
}, [])

// ICE Candidate ì¶”ê°€
const addIceCandidate = useCallback(async (candidate: RTCIceCandidateInit) => {
await serviceRef.current?.addIceCandidate(candidate)
}, [])

// ë„¤íŠ¸ì›Œí¬ í†µê³„
const getStats = useCallback(async () => {
return serviceRef.current?.getStats()
}, [])

return {
// State
...state,

    // Actions
    toggleAudio,
    toggleVideo,
    createOffer,
    createAnswer,
    setRemoteDescription,
    addIceCandidate,
    getStats,

}
}
Component Layer
// ====================================
// features/session/components/SessionVideoStream.tsx
// ====================================
export function SessionVideoStream({
stream,
isMuted,
label
}: Props) {
const videoRef = useRef<HTMLVideoElement>(null)

useEffect(() => {
if (videoRef.current && stream) {
videoRef.current.srcObject = stream
}
}, [stream])

return (
<div className="relative aspect-video bg-gray-900 rounded-lg overflow-hidden">
<video
        ref={videoRef}
        autoPlay
        playsInline
        muted={isMuted}
        className="w-full h-full object-cover"
      />

      {label && (
        <div className="absolute bottom-2 left-2 bg-black/70 px-2 py-1 rounded text-white text-sm">
          {label}
        </div>
      )}
    </div>

)
}

// ====================================
// features/session/containers/SessionLiveContainer.tsx
// ====================================
export function SessionLiveContainer({ sessionId }: Props) {
const { data: session } = useSession(sessionId)
const socket = useSessionSocket(sessionId)

// WebRTC í›… ì‚¬ìš©
const webrtc = useWebRTC({
iceServers: [
{ urls: 'stun:sfu.cotept.com:3478' },
{ urls: 'turn:sfu.cotept.com:3478', username: 'user', credential: 'pass' },
],
streamConstraints: {
video: { width: 1280, height: 720 },
audio: { echoCancellation: true, noiseSuppression: true },
},
})

// WebSocketìœ¼ë¡œ ì‹œê·¸ë„ë§
useEffect(() => {
socket.on('offer', async (offer) => {
await webrtc.setRemoteDescription(offer)
const answer = await webrtc.createAnswer()
socket.emit('answer', answer)
})

    socket.on('answer', async (answer) => {
      await webrtc.setRemoteDescription(answer)
    })

    socket.on('ice-candidate', async (candidate) => {
      await webrtc.addIceCandidate(candidate)
    })

}, [socket, webrtc])

return (
<div className="grid grid-cols-2 gap-4">
{/_ ë¡œì»¬ ìŠ¤íŠ¸ë¦¼ _/}
<SessionVideoStream
        stream={webrtc.localStream}
        isMuted
        label="ë‚˜"
      />

      {/* ì›ê²© ìŠ¤íŠ¸ë¦¼ */}
      <SessionVideoStream
        stream={webrtc.remoteStream}
        label={session?.mentorName}
      />

      {/* ì»¨íŠ¸ë¡¤ */}
      <div className="col-span-2 flex justify-center gap-2">
        <Button
          onClick={webrtc.toggleAudio}
          variant={webrtc.isAudioEnabled ? 'default' : 'destructive'}
        >
          {webrtc.isAudioEnabled ? <Mic /> : <MicOff />}
        </Button>

        <Button
          onClick={webrtc.toggleVideo}
          variant={webrtc.isVideoEnabled ? 'default' : 'destructive'}
        >
          {webrtc.isVideoEnabled ? <Video /> : <VideoOff />}
        </Button>
      </div>
    </div>

)
}
2ï¸âƒ£ WebSocket Service (ì‹¤ì‹œê°„ ì±„íŒ… + ì‹œê·¸ë„ë§)
// ====================================
// features/session/services/websocket/WebSocketService.ts
// ====================================
import { io, Socket } from 'socket.io-client'
import { EventEmitter } from 'events'

export class WebSocketService extends EventEmitter {
private socket: Socket | null = null
private reconnectAttempts = 0
private maxReconnectAttempts = 5

constructor(private url: string) {
super()
}

connect(sessionId: string, token: string) {
this.socket = io(this.url, {
auth: { sessionId, token },
reconnection: true,
reconnectionAttempts: this.maxReconnectAttempts,
reconnectionDelay: 1000,
})

    this.setupSocketListeners()

}

private setupSocketListeners() {
if (!this.socket) return

    this.socket.on('connect', () => {
      console.log('WebSocket ì—°ê²°ë¨')
      this.reconnectAttempts = 0
      this.emit('connected')
    })

    this.socket.on('disconnect', (reason) => {
      console.log('WebSocket ì—°ê²° ëŠê¹€:', reason)
      this.emit('disconnected', reason)
    })

    this.socket.on('reconnect_attempt', (attempt) => {
      this.reconnectAttempts = attempt
      this.emit('reconnecting', attempt)
    })

    this.socket.on('reconnect_failed', () => {
      this.emit('reconnect-failed')
    })

    // ì±„íŒ… ë©”ì‹œì§€
    this.socket.on('chat-message', (message) => {
      this.emit('chat-message', message)
    })

    // ì°¸ê°€ì ë³€ê²½
    this.socket.on('participant-joined', (participant) => {
      this.emit('participant-joined', participant)
    })

    this.socket.on('participant-left', (participantId) => {
      this.emit('participant-left', participantId)
    })

    // ì‹œê·¸ë„ë§
    this.socket.on('offer', (offer) => this.emit('offer', offer))
    this.socket.on('answer', (answer) => this.emit('answer', answer))
    this.socket.on('ice-candidate', (candidate) => this.emit('ice-candidate', candidate))

}

// ë©”ì‹œì§€ ì „ì†¡
sendMessage(content: string) {
this.socket?.emit('chat-message', { content })
}

// ì‹œê·¸ë„ë§ ì „ì†¡
sendOffer(offer: RTCSessionDescriptionInit) {
this.socket?.emit('offer', offer)
}

sendAnswer(answer: RTCSessionDescriptionInit) {
this.socket?.emit('answer', answer)
}

sendIceCandidate(candidate: RTCIceCandidate) {
this.socket?.emit('ice-candidate', candidate)
}

disconnect() {
this.socket?.disconnect()
this.removeAllListeners()
}
}

// ====================================
// features/session/hooks/useSessionSocket.ts
// ====================================
export function useSessionSocket(sessionId: string) {
const serviceRef = useRef<WebSocketService | null>(null)
const [messages, setMessages] = useState<ChatMessage[]>([])
const [participants, setParticipants] = useState<Participant[]>([])
const [connectionState, setConnectionState] = useState<'connected' | 'disconnected' | 'reconnecting'>('disconnected')

useEffect(() => {
const service = new WebSocketService('wss://api.cotept.com/ws')
serviceRef.current = service

    service.on('connected', () => setConnectionState('connected'))
    service.on('disconnected', () => setConnectionState('disconnected'))
    service.on('reconnecting', () => setConnectionState('reconnecting'))

    service.on('chat-message', (message) => {
      setMessages((prev) => [...prev, message])
    })

    service.on('participant-joined', (participant) => {
      setParticipants((prev) => [...prev, participant])
    })

    service.on('participant-left', (participantId) => {
      setParticipants((prev) => prev.filter((p) => p.id !== participantId))
    })

    // ì—°ê²°
    service.connect(sessionId, 'token')

    return () => {
      service.disconnect()
    }

}, [sessionId])

const sendMessage = useCallback((content: string) => {
serviceRef.current?.sendMessage(content)
}, [])

return {
messages,
participants,
connectionState,
sendMessage,
service: serviceRef.current, // ì‹œê·¸ë„ë§ìš©
}
}
3ï¸âƒ£ Y.js CRDT Service (í˜‘ì—… ì½”ë“œ ì—ë””í„°)
// ====================================
// features/session/services/crdt/CRDTService.ts
// ====================================
import \* as Y from 'yjs'
import { WebsocketProvider } from 'y-websocket'

export class CRDTService {
private ydoc: Y.Doc
private provider: WebsocketProvider
private ytext: Y.Text

constructor(sessionId: string) {
this.ydoc = new Y.Doc()
this.ytext = this.ydoc.getText('monaco')

    this.provider = new WebsocketProvider(
      'wss://api.cotept.com/yjs',
      `session-${sessionId}`,
      this.ydoc
    )

}

getYText() {
return this.ytext
}

getProvider() {
return this.provider
}

dispose() {
this.provider.destroy()
this.ydoc.destroy()
}
}

// ====================================
// features/session/services/crdt/MonacoBinding.ts
// ====================================
import { MonacoBinding } from 'y-monaco'
import type \* as monaco from 'monaco-editor'
import { CRDTService } from './CRDTService'

export function createMonacoBinding(
editor: monaco.editor.IStandaloneCodeEditor,
crdtService: CRDTService
) {
return new MonacoBinding(
crdtService.getYText(),
editor.getModel()!,
new Set([editor]),
crdtService.getProvider().awareness
)
}

// ====================================
// features/session/hooks/useCollaborativeEditor.ts
// ====================================
export function useCollaborativeEditor(sessionId: string) {
const serviceRef = useRef<CRDTService | null>(null)
const bindingRef = useRef<MonacoBinding | null>(null)
const [awareness, setAwareness] = useState<any>(null)

useEffect(() => {
const service = new CRDTService(sessionId)
serviceRef.current = service

    setAwareness(service.getProvider().awareness)

    return () => {
      bindingRef.current?.destroy()
      service.dispose()
    }

}, [sessionId])

const bindEditor = useCallback((editor: monaco.editor.IStandaloneCodeEditor) => {
if (serviceRef.current && !bindingRef.current) {
bindingRef.current = createMonacoBinding(editor, serviceRef.current)
}
}, [])

return {
bindEditor,
awareness,
}
}
ğŸ§ª í…ŒìŠ¤íŠ¸ ì „ëµ
"â˜… Insight â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
3-Layer í…ŒìŠ¤íŠ¸ ì „ëµ:
Vitest â†’ Service Layer (ìˆœìˆ˜ ë¡œì§)
MSW â†’ API/WebSocket ëª¨í‚¹
Storybook â†’ ì»´í¬ë„ŒíŠ¸ ì‹œê°í™”
"â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
1ï¸âƒ£ Vitest (Service Unit Tests)
// ====================================
// features/session/services/webrtc/**tests**/WebRTCService.test.ts
// ====================================
import { describe, it, expect, vi, beforeEach } from 'vitest'
import { WebRTCService } from '../WebRTCService'

// WebRTC API ëª¨í‚¹
global.RTCPeerConnection = vi.fn().mockImplementation(() => ({
addTrack: vi.fn(),
createOffer: vi.fn().mockResolvedValue({}),
createAnswer: vi.fn().mockResolvedValue({}),
setLocalDescription: vi.fn(),
setRemoteDescription: vi.fn(),
addIceCandidate: vi.fn(),
close: vi.fn(),
connectionState: 'new',
}))

global.navigator.mediaDevices = {
getUserMedia: vi.fn().mockResolvedValue({
getTracks: () => [],
}),
} as any

describe('WebRTCService', () => {
let service: WebRTCService

beforeEach(() => {
service = new WebRTCService({
iceServers: [{ urls: 'stun:test.com' }],
streamConstraints: { video: true, audio: true },
})
})

it('ì´ˆê¸°í™” ì‹œ ë¡œì»¬ ìŠ¤íŠ¸ë¦¼ì„ íšë“í•´ì•¼ í•¨', async () => {
const localStreamSpy = vi.fn()
service.on('local-stream-ready', localStreamSpy)

    await service.initialize()

    expect(localStreamSpy).toHaveBeenCalled()

})

it('Offerë¥¼ ìƒì„±í•  ìˆ˜ ìˆì–´ì•¼ í•¨', async () => {
await service.initialize()
const offer = await service.createOffer()

    expect(offer).toBeDefined()

})

it('ì˜¤ë””ì˜¤ë¥¼ í† ê¸€í•  ìˆ˜ ìˆì–´ì•¼ í•¨', async () => {
await service.initialize()

    const enabled = service.toggleAudio()
    expect(typeof enabled).toBe('boolean')

})
})
2ï¸âƒ£ MSW (WebSocket/API ëª¨í‚¹)
// ====================================
// mocks/handlers/websocket.ts
// ====================================
import { setupServer } from 'msw/node'
import { ws } from 'msw'

export const websocketHandlers = [
ws.link('wss://api.cotept.com/ws'),
ws.addEventListener('connection', ({ client }) => {
client.addEventListener('message', (event) => {
if (event.data === 'chat-message') {
client.send(JSON.stringify({
type: 'chat-message',
content: 'Mock message',
}))
}
})
}),
]

export const server = setupServer(...websocketHandlers)

// ====================================
// features/session/hooks/**tests**/useSessionSocket.test.tsx
// ====================================
import { renderHook, waitFor } from '@testing-library/react'
import { useSessionSocket } from '../useSessionSocket'
import { server } from '@/mocks/handlers/websocket'

beforeAll(() => server.listen())
afterEach(() => server.resetHandlers())
afterAll(() => server.close())

describe('useSessionSocket', () => {
it('ë©”ì‹œì§€ë¥¼ ìˆ˜ì‹ í•´ì•¼ í•¨', async () => {
const { result } = renderHook(() => useSessionSocket('session-1'))

    await waitFor(() => {
      expect(result.current.connectionState).toBe('connected')
    })

    result.current.sendMessage('Hello')

    await waitFor(() => {
      expect(result.current.messages).toHaveLength(1)
    })

})
})
3ï¸âƒ£ Storybook (ì»´í¬ë„ŒíŠ¸ ì‹œê°í™”)
// ====================================
// features/session/components/SessionVideoStream.stories.tsx
// ====================================
import type { Meta, StoryObj } from '@storybook/react'
import { SessionVideoStream } from './SessionVideoStream'

const meta: Meta<typeof SessionVideoStream> = {
title: 'Session/SessionVideoStream',
component: SessionVideoStream,
parameters: {
layout: 'centered',
},
tags: ['autodocs'],
}

export default meta
type Story = StoryObj<typeof SessionVideoStream>

export const LocalStream: Story = {
args: {
stream: null, // Mock MediaStream
isMuted: true,
label: 'ë‚˜',
},
}

export const RemoteStream: Story = {
args: {
stream: null,
isMuted: false,
label: 'í™ê¸¸ë™ ë©˜í† ',
},
}

export const NoStream: Story = {
args: {
stream: null,
label: 'ì—°ê²° ì¤‘...',
},
}
ğŸ“Š ìµœì¢… ì•„í‚¤í…ì²˜ ìš”ì•½
// ====================================
// íŒ¨í„´ ì¼ê´€ì„± ì²´í¬ë¦¬ìŠ¤íŠ¸
// ====================================

// âœ… 1. Service Layer (ìˆœìˆ˜ TypeScript)
class ProtocolService extends EventEmitter {
constructor(config) {}
initialize() {}
dispose() {}
}

// âœ… 2. Hook Layer (React ë¸Œë¦¿ì§€)
function useProtocol(config) {
const serviceRef = useRef<ProtocolService>()
const [state, setState] = useState()

useEffect(() => {
const service = new ProtocolService(config)
// ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
return () => service.dispose()
}, [config])

return { ...state, actions }
}

// âœ… 3. Component Layer (í”„ë ˆì  í…Œì´ì…˜)
function Component({ data }) {
return <UI />
}

// âœ… 4. Container Layer (í›… ì†Œë¹„)
function Container() {
const protocol = useProtocol(config)
return <Component data={protocol} />
}
"â˜… Insight â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
CotePT í”„ë¡œí† ì½œ ì„œë¹„ìŠ¤ì˜ ì™„ì„±: Service Layer íŒ¨í„´:
âœ… Pure TypeScript (React ë…ë¦½ì )
âœ… EventEmitter ê¸°ë°˜ ì´ë²¤íŠ¸ ì‹œìŠ¤í…œ
âœ… dispose() ë©”ì„œë“œë¡œ ì •ë¦¬ ë³´ì¥
Hook Layer íŒ¨í„´:
âœ… useRefë¡œ Service ì¸ìŠ¤í„´ìŠ¤ ìœ ì§€
âœ… useStateë¡œ React State ë™ê¸°í™”
âœ… useEffectë¡œ ìƒëª…ì£¼ê¸° ê´€ë¦¬
í…ŒìŠ¤íŠ¸ ì „ëµ:
âœ… Vitest: Service ìˆœìˆ˜ ë¡œì§
âœ… MSW: WebSocket/API ëª¨í‚¹
âœ… Storybook: ì»´í¬ë„ŒíŠ¸ ë¬¸ì„œí™”
ì¼ê´€ì„±:
âœ… WebRTC, WebSocket, Y.js, MSE ëª¨ë‘ ë™ì¼ íŒ¨í„´
âœ… ì‘ì§‘ì„± ìµœëŒ€í™” (í”„ë¡œí† ì½œë³„ ë…ë¦½ ëª¨ë“ˆ)
âœ… í…ŒìŠ¤íŠ¸ ìš©ì´ì„± (Service ë‹¨ìœ„ í…ŒìŠ¤íŠ¸)
"â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
ì´ íŒ¨í„´ìœ¼ë¡œ MSE Recording, Y.js Monaco Editor ëª¨ë‘ ë™ì¼í•˜ê²Œ êµ¬í˜„í•˜ë©´ CotePTì˜ ì‹¤ì‹œê°„ ê¸°ëŠ¥ì´ ì™„ì„±ë©ë‹ˆë‹¤! ğŸš€
@packages/shared/src/types/types.ts @packages/shared/src/lib/utils.ts @packages/shared/src/rules/rule-helper.ts ì¶”ê°€ í•´ë´¤ì–´
ğŸ‰ ì™„ë²½í•œ êµ¬í˜„ì…ë‹ˆë‹¤!
íƒ€ì… ìœ í‹¸ë¦¬í‹°ì™€ ê³µí†µ í•¨ìˆ˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ í™•ì¸í–ˆìŠµë‹ˆë‹¤. ë…¼ì˜í–ˆë˜ íŒ¨í„´ë“¤ì„ ì´ë¯¸ êµ¬í˜„í•˜ì…¨ë„¤ìš”!
"â˜… Insight â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
ì´ë¯¸ êµ¬í˜„ëœ í•µì‹¬ ê¸°ëŠ¥ë“¤ âœ…:
âœ… Deep íƒ€ì… ìœ í‹¸ë¦¬í‹°: DeepPartial, DeepRequired, DeepReadonly, DeepNonNullable
âœ… íƒ€ì… ì•ˆì „ ê°ì²´ ë©”ì†Œë“œ: typedKeys, typedEntries, mapObject, pickBy
âœ… íƒ€ì… ì•ˆì „ ë°°ì—´ ë©”ì†Œë“œ: filterNotNull, groupBy, partition, uniqueBy
âœ… Zod ê²€ì¦ í—¬í¼: validateWithZod, zodValidateToggle, RuleMap
ì¶”ê°€ë¡œ ì œì•ˆë“œë¦´ ëª‡ ê°€ì§€ âš¡: "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
ğŸš€ ì¶”ê°€ ì œì•ˆ ì‚¬í•­
1ï¸âƒ£ DeepMerge ìœ í‹¸ë¦¬í‹° (ë·°ëª¨ë¸ ë³‘í•©ìš©)
// packages/shared/src/lib/utils.ts ì¶”ê°€

/\*\* - - - - - - - - - - - - - - - - -

- ê°ì²´ ë³‘í•© (Deep)
  _- - - - - - - - - - - - - - - - -_/

/\*\*

- ë‘ ê°ì²´ë¥¼ ê¹Šê²Œ ë³‘í•© (DeepPartial ì—…ë°ì´íŠ¸ìš©)
- @example
- const current = { user: { name: 'John', age: 30 } }
- const updates = { user: { age: 31 } }
- deepMerge(current, updates) // { user: { name: 'John', age: 31 } }
  \*/
  export function deepMerge<T extends object>(target: T, source: DeepPartial<T>): T {
  const output = { ...target } as any

if (isObject(target) && isObject(source)) {
Object.keys(source).forEach((key) => {
const sourceValue = (source as any)[key]
const targetValue = (target as any)[key]

      if (isObject(sourceValue) && isObject(targetValue)) {
        output[key] = deepMerge(targetValue, sourceValue)
      } else {
        output[key] = sourceValue
      }
    })

}

return output
}

function isObject(item: any): item is object {
return item && typeof item === 'object' && !Array.isArray(item)
}
ì‚¬ìš© ì˜ˆì‹œ:
// features/mentor/hooks/useMentorProfile.ts
const updateProfile = useCallback((updates: DeepPartial<MentorProfile>) => {
setProfile(current => {
if (!current) return null
return deepMerge(current, updates) // âœ… íƒ€ì… ì•ˆì „í•œ ê¹Šì€ ë³‘í•©
})
}, [])

// ì‚¬ìš©
updateProfile({
settings: {
availability: {
timezone: 'Asia/Seoul' // ë‹¤ë¥¸ í•„ë“œëŠ” ìœ ì§€ë¨
}
}
})
2ï¸âƒ£ PathsToProps & Get/Set (ì¤‘ì²© ê°ì²´ ê²½ë¡œ ì ‘ê·¼)
// packages/shared/src/types/types.ts ì¶”ê°€

/\*\*

- ì¤‘ì²© ê°ì²´ì˜ ëª¨ë“  ê²½ë¡œë¥¼ ë¬¸ìì—´ ë¦¬í„°ëŸ´ ìœ ë‹ˆì˜¨ìœ¼ë¡œ ì¶”ì¶œ
- @example
- type User = { profile: { name: string; settings: { theme: string } } }
- type Paths = PathsToProps<User>
- // "profile" | "profile.name" | "profile.settings" | "profile.settings.theme"
  \*/
  export type PathsToProps<T, Prefix extends string = ''> = T extends object
  ? {
  [K in keyof T]-?: K extends string
  ? T[K] extends object
  ? `${Prefix}${K}` | PathsToProps<T[K], `${Prefix}${K}.`>
  : `${Prefix}${K}`
  : never
  }[keyof T]
  : never

/\*\*

- ê²½ë¡œ ë¬¸ìì—´ë¡œë¶€í„° ê°’ì˜ íƒ€ì… ì¶”ë¡ 
- @example
- type User = { profile: { name: string } }
- type NameType = PathValue<User, "profile.name"> // string
  \*/
  export type PathValue<T, P extends string> = P extends `${infer K}.${infer Rest}`
  ? K extends keyof T
  ? PathValue<T[K], Rest>
  : never
  : P extends keyof T
  ? T[P]
  : never
  // packages/shared/src/lib/utils.ts ì¶”ê°€

/\*\* - - - - - - - - - - - - - - - - -

- ì¤‘ì²© ê°ì²´ ê²½ë¡œ ì ‘ê·¼
  _- - - - - - - - - - - - - - - - -_/

/\*\*

- ì¤‘ì²© ê°ì²´ ê°’ì„ ê²½ë¡œ ë¬¸ìì—´ë¡œ ì•ˆì „í•˜ê²Œ ê°€ì ¸ì˜¤ê¸°
- @example
- const user = { profile: { settings: { theme: 'dark' } } }
- getByPath(user, 'profile.settings.theme') // 'dark'
  \*/
  export function getByPath<T extends object, P extends PathsToProps<T>>(
  obj: T,
  path: P
  ): PathValue<T, P> | undefined {
  return path.split('.').reduce((acc: any, key) => acc?.[key], obj) as any
  }

/\*\*

- ì¤‘ì²© ê°ì²´ ê°’ì„ ê²½ë¡œ ë¬¸ìì—´ë¡œ ì•ˆì „í•˜ê²Œ ì„¤ì •
- @example
- const user = { profile: { settings: { theme: 'dark' } } }
- setByPath(user, 'profile.settings.theme', 'light')
  \*/
  export function setByPath<T extends object, P extends PathsToProps<T>>(
  obj: T,
  path: P,
  value: PathValue<T, P>
  ): T {
  const keys = path.split('.')
  const lastKey = keys.pop()!
  const target = keys.reduce((acc: any, key) => {
  if (!acc[key]) acc[key] = {}
  return acc[key]
  }, obj as any)

target[lastKey] = value
return obj
}
ì‚¬ìš© ì˜ˆì‹œ:
// features/session/models/session.viewmodel.ts
interface SessionViewModel {
settings: {
video: {
resolution: string
framerate: number
}
audio: {
echoCancellation: boolean
}
}
}

// âœ… íƒ€ì… ì•ˆì „í•œ ê²½ë¡œ ì ‘ê·¼
const resolution = getByPath(session, 'settings.video.resolution')
// ^? string | undefined

setByPath(session, 'settings.video.framerate', 60)
// âœ… íƒ€ì… ì²´í¬ë¨ (numberë§Œ í—ˆìš©)

setByPath(session, 'settings.video.framerate', '60')
// âŒ ì»´íŒŒì¼ ì—ëŸ¬: stringì€ numberì— í• ë‹¹ ë¶ˆê°€
3ï¸âƒ£ Async ìœ í‹¸ë¦¬í‹° (í”„ë¡œí† ì½œ ì„œë¹„ìŠ¤ìš©)
// packages/shared/src/lib/utils.ts ì¶”ê°€

/\*\* - - - - - - - - - - - - - - - - -

- ë¹„ë™ê¸° ìœ í‹¸ë¦¬í‹°
  _- - - - - - - - - - - - - - - - -_/

/\*\*

- Promise íƒ€ì„ì•„ì›ƒ
- @example
- await withTimeout(fetch('/api'), 5000) // 5ì´ˆ íƒ€ì„ì•„ì›ƒ
  \*/
  export async function withTimeout<T>(
  promise: Promise<T>,
  timeoutMs: number,
  errorMessage = 'Timeout exceeded'
  ): Promise<T> {
  return Promise.race([
  promise,
  new Promise<T>((_, reject) =>
  setTimeout(() => reject(new Error(errorMessage)), timeoutMs)
  ),
  ])
  }

/\*\*

- ì¬ì‹œë„ ë¡œì§ (Exponential Backoff)
- @example
- await retry(() => apiClient.sessions.getById(id), { maxAttempts: 3 })
  \*/
  export async function retry<T>(
  fn: () => Promise<T>,
  options: {
  maxAttempts?: number
  delay?: number
  backoff?: number
  onRetry?: (error: Error, attempt: number) => void
  } = {}
  ): Promise<T> {
  const {
  maxAttempts = 3,
  delay = 1000,
  backoff = 2,
  onRetry,
  } = options

let lastError: Error

for (let attempt = 1; attempt <= maxAttempts; attempt++) {
try {
return await fn()
} catch (error) {
lastError = error as Error

      if (attempt < maxAttempts) {
        const waitTime = delay * Math.pow(backoff, attempt - 1)
        onRetry?.(lastError, attempt)
        await sleep(waitTime)
      }
    }

}

throw lastError!
}

/\*\*

- Promise ê¸°ë°˜ sleep
- @example await sleep(1000) // 1ì´ˆ ëŒ€ê¸°
  \*/
  export function sleep(ms: number): Promise<void> {
  return new Promise(resolve => setTimeout(resolve, ms))
  }

/\*\*

- Promise ë°°ì—´ì„ ìˆœì°¨ì ìœ¼ë¡œ ì‹¤í–‰ (ë³‘ë ¬ ì•„ë‹˜)
- @example
- await runSequentially([
- () => apiClient.users.update(1),
- () => apiClient.users.update(2),
- ])
  \*/
  export async function runSequentially<T>(
  tasks: (() => Promise<T>)[]
  ): Promise<T[]> {
  const results: T[] = []

for (const task of tasks) {
results.push(await task())
}

return results
}

/\*\*

- Promise ë°°ì—´ì„ ì²­í¬ ë‹¨ìœ„ë¡œ ë³‘ë ¬ ì‹¤í–‰
- @example
- await runInChunks(userIds.map(id => () => api.users.get(id)), 5)
- // 5ê°œì”© ë³‘ë ¬ ì²˜ë¦¬
  \*/
  export async function runInChunks<T>(
  tasks: (() => Promise<T>)[],
  chunkSize: number
  ): Promise<T[]> {
  const results: T[] = []

for (let i = 0; i < tasks.length; i += chunkSize) {
const chunk = tasks.slice(i, i + chunkSize)
const chunkResults = await Promise.all(chunk.map(task => task()))
results.push(...chunkResults)
}

return results
}
ì‚¬ìš© ì˜ˆì‹œ (WebRTC ì¬ì—°ê²°):
// features/session/services/webrtc/WebRTCService.ts
private async handleReconnection() {
try {
await retry(
async () => {
const offer = await this.createOffer()
await this.sendSignaling(offer)
},
{
maxAttempts: 3,
delay: 1000,
backoff: 2,
onRetry: (error, attempt) => {
console.log(`ì¬ì—°ê²° ì‹œë„ ${attempt}/3`, error)
this.emit('reconnecting', attempt)
}
}
)
} catch (error) {
this.emit('error', new Error('ì¬ì—°ê²° ì‹¤íŒ¨: ' + error))
}
}
4ï¸âƒ£ Debounce & Throttle (ì‹¤ì‹œê°„ ì´ë²¤íŠ¸ ì œì–´)
// packages/shared/src/lib/utils.ts ì¶”ê°€

/\*\* - - - - - - - - - - - - - - - - -

- ì´ë²¤íŠ¸ ì œì–´
  _- - - - - - - - - - - - - - - - -_/

/\*\*

- Debounce í•¨ìˆ˜ (ë§ˆì§€ë§‰ í˜¸ì¶œë§Œ ì‹¤í–‰)
- @example
- const debouncedSearch = debounce((query: string) => {
- apiClient.search(query)
- }, 300)
  \*/
  export function debounce<T extends (...args: any[]) => any>(
  fn: T,
  delayMs: number
  ): DebouncedFunction<T> {
  let timeoutId: ReturnType<typeof setTimeout> | null = null
  let lastArgs: Parameters<T> | null = null

const debounced = (...args: Parameters<T>) => {
lastArgs = args

    if (timeoutId) {
      clearTimeout(timeoutId)
    }

    timeoutId = setTimeout(() => {
      fn(...args)
      timeoutId = null
      lastArgs = null
    }, delayMs)

}

debounced.cancel = () => {
if (timeoutId) {
clearTimeout(timeoutId)
timeoutId = null
lastArgs = null
}
}

debounced.flush = () => {
if (timeoutId && lastArgs) {
clearTimeout(timeoutId)
fn(...lastArgs)
timeoutId = null
lastArgs = null
}
}

return debounced as DebouncedFunction<T>
}

/\*\*

- Throttle í•¨ìˆ˜ (ì¼ì • ê°„ê²©ìœ¼ë¡œë§Œ ì‹¤í–‰)
- @example
- const throttledScroll = throttle(() => {
- updateScrollPosition()
- }, 100)
  \*/
  export function throttle<T extends (...args: any[]) => any>(
  fn: T,
  intervalMs: number
  ): DebouncedFunction<T> {
  let lastCall = 0
  let timeoutId: ReturnType<typeof setTimeout> | null = null

const throttled = (...args: Parameters<T>) => {
const now = Date.now()
const timeSinceLastCall = now - lastCall

    const execute = () => {
      lastCall = now
      fn(...args)
    }

    if (timeSinceLastCall >= intervalMs) {
      execute()
    } else {
      if (timeoutId) {
        clearTimeout(timeoutId)
      }
      timeoutId = setTimeout(execute, intervalMs - timeSinceLastCall)
    }

}

throttled.cancel = () => {
if (timeoutId) {
clearTimeout(timeoutId)
timeoutId = null
}
}

throttled.flush = () => {
if (timeoutId) {
clearTimeout(timeoutId)
fn()
timeoutId = null
}
}

return throttled as DebouncedFunction<T>
}
ì‚¬ìš© ì˜ˆì‹œ (Y.js í˜‘ì—… ì—ë””í„°):
// features/session/hooks/useCollaborativeEditor.ts
const debouncedSave = useMemo(
() => debounce((content: string) => {
apiClient.sessions.saveContent(sessionId, content)
}, 2000),
[sessionId]
)

useEffect(() => {
const binding = createMonacoBinding(editor, crdtService)

// ì—ë””í„° ë³€ê²½ ì‹œ ìë™ ì €ì¥ (2ì´ˆ ë””ë°”ìš´ìŠ¤)
editor.onDidChangeModelContent(() => {
debouncedSave(editor.getValue())
})

return () => {
debouncedSave.cancel() // Cleanup
binding.destroy()
}
}, [editor, crdtService, debouncedSave])
ğŸ“Š ìµœì¢… ê¶Œì¥ ì¶”ê°€ ì‚¬í•­ ì •ë¦¬
ìœ í‹¸ë¦¬í‹° ìš©ë„ ìš°ì„ ìˆœìœ„ CotePT í™œìš©
deepMerge ë·°ëª¨ë¸ ë¶€ë¶„ ì—…ë°ì´íŠ¸ â­â­â­â­â­ í”„ë¡œí•„ ìˆ˜ì •, ì„¸ì…˜ ì„¤ì •
getByPath/setByPath ì¤‘ì²© ê°ì²´ íƒ€ì… ì•ˆì „ ì ‘ê·¼ â­â­â­â­ ë³µì¡í•œ ì„¤ì • ê°ì²´
retry ë„¤íŠ¸ì›Œí¬ ì¬ì‹œë„ â­â­â­â­â­ WebRTC ì¬ì—°ê²°, API ì‹¤íŒ¨
withTimeout Promise íƒ€ì„ì•„ì›ƒ â­â­â­â­ WebRTC ì—°ê²° íƒ€ì„ì•„ì›ƒ
debounce ì´ë²¤íŠ¸ ì œì–´ â­â­â­â­â­ ê²€ìƒ‰, ìë™ ì €ì¥
throttle ì´ë²¤íŠ¸ ì œì–´ â­â­â­â­ ìŠ¤í¬ë¡¤, ë¦¬ì‚¬ì´ì¦ˆ
runInChunks ë³‘ë ¬ ì œì–´ â­â­â­ ëŒ€ëŸ‰ API í˜¸ì¶œ
"â˜… Insight â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
í˜„ì¬ êµ¬í˜„ ìˆ˜ì¤€: ì´ë¯¸ í”„ë¡œë•ì…˜ ë ˆë²¨ì…ë‹ˆë‹¤! ì¶”ê°€ ì œì•ˆì˜ í•µì‹¬ ê°€ì¹˜:
âœ… deepMerge: DeepPartialê³¼ í•¨ê»˜ ì‚¬ìš©í•˜ë©´ ë·°ëª¨ë¸ ì—…ë°ì´íŠ¸ ì™„ë²½
âœ… retry: WebRTC ë¶ˆì•ˆì • ë„¤íŠ¸ì›Œí¬ ëŒ€ì‘ í•„ìˆ˜
âœ… debounce: ì‹¤ì‹œê°„ í˜‘ì—… ì—ë””í„° ì„±ëŠ¥ ìµœì í™”
âœ… getByPath/setByPath: ë³µì¡í•œ ì„¤ì • ê°ì²´ íƒ€ì… ì•ˆì „ ì ‘ê·¼
ì¦‰ì‹œ êµ¬í˜„ ì¶”ì²œ: deepMerge + retry + debounce (3ê°œë§Œ)
ë‚˜ë¨¸ì§€ëŠ” í•„ìš”í•  ë•Œ ì ì§„ì ìœ¼ë¡œ ì¶”ê°€
"â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
ğŸ’¬ ë‹¤ìŒ ë‹¨ê³„ ì œì•ˆ
âš¡ deepMerge, retry, debounce ì¶”ê°€ (30ë¶„ ì†Œìš”)
ğŸ¯ WebRTC Service êµ¬í˜„ ì‹œì‘ (í”„ë¡œí† ì½œ ì„œë¹„ìŠ¤ íŒ¨í„´ ì ìš©)
ğŸ§ª Vitest + MSW í…ŒìŠ¤íŠ¸ ì¸í”„ë¼ êµ¬ì¶•
