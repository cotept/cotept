# 멘토 시스템 테이블 설계 명세서

## 개요
CotePT 온보딩 시스템의 멘토 프로필 관리를 위한 테이블 설계 문서입니다.
Oracle Database 19c 환경에서 운영됩니다.

## 테이블 목록

### 1. MENTOR_TAGS (멘토 태그 마스터)
멘토의 직무, 연차, 회사 정보를 관리하는 마스터 데이터 테이블

```sql
CREATE TABLE MENTOR_TAGS (
  IDX           NUMBER(19)        NOT NULL,
  NAME          VARCHAR2(50)      NOT NULL,
  CATEGORY      VARCHAR2(20)      NOT NULL,
  DISPLAY_ORDER NUMBER(10)        DEFAULT 0,
  IS_ACTIVE     NUMBER(1)         DEFAULT 1,
  CREATED_AT    TIMESTAMP         DEFAULT CURRENT_TIMESTAMP,
  UPDATED_AT    TIMESTAMP         DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT PK_MENTOR_TAGS PRIMARY KEY (IDX),
  CONSTRAINT CK_MENTOR_TAGS_CATEGORY CHECK (CATEGORY IN ('job', 'experience', 'company')),
  CONSTRAINT CK_MENTOR_TAGS_IS_ACTIVE CHECK (IS_ACTIVE IN (0, 1))
);

-- 인덱스
CREATE INDEX IDX_MENTOR_TAGS_CATEGORY_ACTIVE ON MENTOR_TAGS (CATEGORY, IS_ACTIVE);
CREATE INDEX IDX_MENTOR_TAGS_DISPLAY_ORDER ON MENTOR_TAGS (DISPLAY_ORDER);

-- 시퀀스
CREATE SEQUENCE SEQ_MENTOR_TAGS_IDX START WITH 1 INCREMENT BY 1;

-- 트리거 (자동 IDX 생성 및 UPDATED_AT 갱신)
CREATE OR REPLACE TRIGGER TRG_MENTOR_TAGS_BI
  BEFORE INSERT ON MENTOR_TAGS
  FOR EACH ROW
BEGIN
  IF :NEW.IDX IS NULL THEN
    :NEW.IDX := SEQ_MENTOR_TAGS_IDX.NEXTVAL;
  END IF;
END;

CREATE OR REPLACE TRIGGER TRG_MENTOR_TAGS_BU
  BEFORE UPDATE ON MENTOR_TAGS
  FOR EACH ROW
BEGIN
  :NEW.UPDATED_AT := CURRENT_TIMESTAMP;
END;
```

**컬럼 설명:**
- `IDX`: 기본키 (자동 생성)
- `NAME`: 태그명 (예: "React", "3년차", "카카오")
- `CATEGORY`: 태그 분류 (job: 직무, experience: 연차, company: 회사)
- `DISPLAY_ORDER`: 화면 표시 순서
- `IS_ACTIVE`: 활성화 상태 (1: 활성, 0: 비활성)

### 2. MENTOR_PROFILES (멘토 프로필)
멘토의 상세 프로필 정보를 저장하는 테이블

```sql
CREATE TABLE MENTOR_PROFILES (
  IDX                     NUMBER(19)        NOT NULL,
  USER_ID                 NUMBER(19)        NOT NULL,
  COTEPT_USER_ID          VARCHAR2(36)      NOT NULL,
  INTRODUCTION_TITLE      VARCHAR2(100),
  INTRODUCTION_CONTENT    CLOB,
  BAEKJOON_TIER_DISPLAY   NUMBER(1)         DEFAULT 1,
  MENTORING_COUNT         NUMBER(10)        DEFAULT 0,
  TOTAL_REVIEW_COUNT      NUMBER(10)        DEFAULT 0,
  AVERAGE_RATING          NUMBER(3,2)       DEFAULT 0.00,
  IS_VERIFIED             NUMBER(1)         DEFAULT 0,
  IS_ACTIVE               NUMBER(1)         DEFAULT 1,
  PROFILE_COMPLETION      NUMBER(3)         DEFAULT 0,
  CREATED_AT              TIMESTAMP         DEFAULT CURRENT_TIMESTAMP,
  UPDATED_AT              TIMESTAMP         DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT PK_MENTOR_PROFILES PRIMARY KEY (IDX),
  CONSTRAINT FK_MENTOR_PROFILES_USER FOREIGN KEY (USER_ID) REFERENCES USERS(IDX) ON DELETE CASCADE,
  CONSTRAINT UK_MENTOR_PROFILES_USER_ID UNIQUE (USER_ID),
  CONSTRAINT UK_MENTOR_PROFILES_COTEPT_USER_ID UNIQUE (COTEPT_USER_ID),
  CONSTRAINT CK_MENTOR_PROFILES_TIER_DISPLAY CHECK (BAEKJOON_TIER_DISPLAY IN (0, 1)),
  CONSTRAINT CK_MENTOR_PROFILES_IS_VERIFIED CHECK (IS_VERIFIED IN (0, 1)),
  CONSTRAINT CK_MENTOR_PROFILES_IS_ACTIVE CHECK (IS_ACTIVE IN (0, 1)),
  CONSTRAINT CK_MENTOR_PROFILES_RATING CHECK (AVERAGE_RATING >= 0.00 AND AVERAGE_RATING <= 5.00),
  CONSTRAINT CK_MENTOR_PROFILES_COMPLETION CHECK (PROFILE_COMPLETION >= 0 AND PROFILE_COMPLETION <= 100)
);

-- 인덱스
CREATE INDEX IDX_MENTOR_PROFILES_USER_ID ON MENTOR_PROFILES (USER_ID);
CREATE INDEX IDX_MENTOR_PROFILES_COTEPT_USER_ID ON MENTOR_PROFILES (COTEPT_USER_ID);
CREATE INDEX IDX_MENTOR_PROFILES_ACTIVE ON MENTOR_PROFILES (IS_ACTIVE);
CREATE INDEX IDX_MENTOR_PROFILES_VERIFIED ON MENTOR_PROFILES (IS_VERIFIED);
CREATE INDEX IDX_MENTOR_PROFILES_RATING ON MENTOR_PROFILES (AVERAGE_RATING DESC);

-- 시퀀스
CREATE SEQUENCE SEQ_MENTOR_PROFILES_IDX START WITH 1 INCREMENT BY 1;

-- 트리거
CREATE OR REPLACE TRIGGER TRG_MENTOR_PROFILES_BI
  BEFORE INSERT ON MENTOR_PROFILES
  FOR EACH ROW
BEGIN
  IF :NEW.IDX IS NULL THEN
    :NEW.IDX := SEQ_MENTOR_PROFILES_IDX.NEXTVAL;
  END IF;
END;

CREATE OR REPLACE TRIGGER TRG_MENTOR_PROFILES_BU
  BEFORE UPDATE ON MENTOR_PROFILES
  FOR EACH ROW
BEGIN
  :NEW.UPDATED_AT := CURRENT_TIMESTAMP;
END;
```

**컬럼 설명:**
- `IDX`: 기본키 (자동 생성)
- `USER_ID`: USERS 테이블 외래키 (CASCADE DELETE)
- `COTEPT_USER_ID`: NoSQL 연계용 사용자 ID
- `INTRODUCTION_TITLE`: 멘토링 소개 제목
- `INTRODUCTION_CONTENT`: 멘토링 소개 내용 (마크다운 형식)
- `BAEKJOON_TIER_DISPLAY`: 백준 티어 표시 여부
- `MENTORING_COUNT`: 총 멘토링 횟수
- `TOTAL_REVIEW_COUNT`: 총 리뷰 개수
- `AVERAGE_RATING`: 평균 평점 (0.00 ~ 5.00)
- `IS_VERIFIED`: 멘토 인증 상태
- `IS_ACTIVE`: 멘토 활동 상태
- `PROFILE_COMPLETION`: 프로필 완성도 (0 ~ 100%)

### 3. MENTOR_PROFILE_TAGS (멘토 프로필 태그 매핑)
멘토 프로필과 태그의 다대다 관계를 관리하는 중간 테이블

```sql
CREATE TABLE MENTOR_PROFILE_TAGS (
  IDX               NUMBER(19)        NOT NULL,
  MENTOR_PROFILE_ID NUMBER(19)        NOT NULL,
  MENTOR_TAG_ID     NUMBER(19)        NOT NULL,
  CREATED_AT        TIMESTAMP         DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT PK_MENTOR_PROFILE_TAGS PRIMARY KEY (IDX),
  CONSTRAINT FK_MPT_MENTOR_PROFILE FOREIGN KEY (MENTOR_PROFILE_ID) REFERENCES MENTOR_PROFILES(IDX) ON DELETE CASCADE,
  CONSTRAINT FK_MPT_MENTOR_TAG FOREIGN KEY (MENTOR_TAG_ID) REFERENCES MENTOR_TAGS(IDX) ON DELETE CASCADE,
  CONSTRAINT UK_MENTOR_PROFILE_TAGS UNIQUE (MENTOR_PROFILE_ID, MENTOR_TAG_ID)
);

-- 인덱스
CREATE INDEX IDX_MPT_MENTOR_PROFILE_ID ON MENTOR_PROFILE_TAGS (MENTOR_PROFILE_ID);
CREATE INDEX IDX_MPT_MENTOR_TAG_ID ON MENTOR_PROFILE_TAGS (MENTOR_TAG_ID);

-- 시퀀스
CREATE SEQUENCE SEQ_MENTOR_PROFILE_TAGS_IDX START WITH 1 INCREMENT BY 1;

-- 트리거
CREATE OR REPLACE TRIGGER TRG_MENTOR_PROFILE_TAGS_BI
  BEFORE INSERT ON MENTOR_PROFILE_TAGS
  FOR EACH ROW
BEGIN
  IF :NEW.IDX IS NULL THEN
    :NEW.IDX := SEQ_MENTOR_PROFILE_TAGS_IDX.NEXTVAL;
  END IF;
END;
```

## 테이블 관계도

```
USERS (1) ←→ (1) MENTOR_PROFILES (1) ←→ (N) MENTOR_PROFILE_TAGS (N) ←→ (1) MENTOR_TAGS
```

## 초기 데이터 (MENTOR_TAGS)

### 직무 태그 (job)
```sql
INSERT INTO MENTOR_TAGS (NAME, CATEGORY, DISPLAY_ORDER) VALUES ('프론트엔드', 'job', 1);
INSERT INTO MENTOR_TAGS (NAME, CATEGORY, DISPLAY_ORDER) VALUES ('백엔드', 'job', 2);
INSERT INTO MENTOR_TAGS (NAME, CATEGORY, DISPLAY_ORDER) VALUES ('풀스택', 'job', 3);
INSERT INTO MENTOR_TAGS (NAME, CATEGORY, DISPLAY_ORDER) VALUES ('DevOps', 'job', 4);
INSERT INTO MENTOR_TAGS (NAME, CATEGORY, DISPLAY_ORDER) VALUES ('데이터 엔지니어', 'job', 5);
INSERT INTO MENTOR_TAGS (NAME, CATEGORY, DISPLAY_ORDER) VALUES ('머신러닝', 'job', 6);
INSERT INTO MENTOR_TAGS (NAME, CATEGORY, DISPLAY_ORDER) VALUES ('모바일', 'job', 7);
INSERT INTO MENTOR_TAGS (NAME, CATEGORY, DISPLAY_ORDER) VALUES ('게임 개발', 'job', 8);
```

### 연차 태그 (experience)
```sql
INSERT INTO MENTOR_TAGS (NAME, CATEGORY, DISPLAY_ORDER) VALUES ('1년차', 'experience', 1);
INSERT INTO MENTOR_TAGS (NAME, CATEGORY, DISPLAY_ORDER) VALUES ('2년차', 'experience', 2);
INSERT INTO MENTOR_TAGS (NAME, CATEGORY, DISPLAY_ORDER) VALUES ('3년차', 'experience', 3);
INSERT INTO MENTOR_TAGS (NAME, CATEGORY, DISPLAY_ORDER) VALUES ('4년차', 'experience', 4);
INSERT INTO MENTOR_TAGS (NAME, CATEGORY, DISPLAY_ORDER) VALUES ('5년차', 'experience', 5);
INSERT INTO MENTOR_TAGS (NAME, CATEGORY, DISPLAY_ORDER) VALUES ('6년차 이상', 'experience', 6);
INSERT INTO MENTOR_TAGS (NAME, CATEGORY, DISPLAY_ORDER) VALUES ('10년차 이상', 'experience', 7);
```

### 회사 태그 (company)
```sql
INSERT INTO MENTOR_TAGS (NAME, CATEGORY, DISPLAY_ORDER) VALUES ('카카오', 'company', 1);
INSERT INTO MENTOR_TAGS (NAME, CATEGORY, DISPLAY_ORDER) VALUES ('네이버', 'company', 2);
INSERT INTO MENTOR_TAGS (NAME, CATEGORY, DISPLAY_ORDER) VALUES ('라인', 'company', 3);
INSERT INTO MENTOR_TAGS (NAME, CATEGORY, DISPLAY_ORDER) VALUES ('쿠팡', 'company', 4);
INSERT INTO MENTOR_TAGS (NAME, CATEGORY, DISPLAY_ORDER) VALUES ('토스', 'company', 5);
INSERT INTO MENTOR_TAGS (NAME, CATEGORY, DISPLAY_ORDER) VALUES ('당근', 'company', 6);
INSERT INTO MENTOR_TAGS (NAME, CATEGORY, DISPLAY_ORDER) VALUES ('우아한형제들', 'company', 7);
INSERT INTO MENTOR_TAGS (NAME, CATEGORY, DISPLAY_ORDER) VALUES ('NC소프트', 'company', 8);
INSERT INTO MENTOR_TAGS (NAME, CATEGORY, DISPLAY_ORDER) VALUES ('NHN', 'company', 9);
INSERT INTO MENTOR_TAGS (NAME, CATEGORY, DISPLAY_ORDER) VALUES ('스타트업', 'company', 10);
INSERT INTO MENTOR_TAGS (NAME, CATEGORY, DISPLAY_ORDER) VALUES ('외국계', 'company', 11);
INSERT INTO MENTOR_TAGS (NAME, CATEGORY, DISPLAY_ORDER) VALUES ('대기업', 'company', 12);
```

## Oracle 19c 특화 고려사항

### 1. 데이터 타입
- `VARCHAR2`: Oracle 전용 가변길이 문자열 (4000바이트 제한)
- `NUMBER(19)`: 64비트 정수 호환 (TypeORM bigint)
- `NUMBER(3,2)`: 소수점 2자리 평점 (0.00 ~ 5.00)
- `CLOB`: 대용량 텍스트 (멘토링 소개글용)
- `TIMESTAMP`: Oracle 표준 시간 타입

### 2. 제약조건
- `CHECK` 제약조건으로 enum 값 검증
- `UNIQUE` 제약조건으로 중복 방지
- `FOREIGN KEY CASCADE DELETE`로 참조 무결성 보장

### 3. 성능 최적화
- 복합 인덱스로 쿼리 성능 향상
- 시퀀스와 트리거로 자동 ID 생성
- CLOB 컬럼 분리로 일반 조회 성능 향상

### 4. 운영 고려사항
- 모든 테이블에 `CREATED_AT`, `UPDATED_AT` 표준화
- 논리 삭제를 위한 `IS_ACTIVE` 플래그
- 트리거를 통한 자동 `UPDATED_AT` 갱신

## 마이그레이션 순서
1. `MENTOR_TAGS` 테이블 생성 및 초기 데이터 입력
2. `MENTOR_PROFILES` 테이블 생성
3. `MENTOR_PROFILE_TAGS` 중간 테이블 생성
4. 인덱스 및 시퀀스 생성
5. 트리거 생성

이 설계는 확장성과 성능을 고려하여 Oracle 19c 환경에 최적화되었습니다.